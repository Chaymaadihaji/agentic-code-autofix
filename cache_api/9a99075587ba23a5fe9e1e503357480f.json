{"nom_fichier": "database.py", "code": "# database.py\n\nfrom flask import Flask, jsonify, request\nfrom flask_sqlalchemy import SQLAlchemy\nfrom flask_jwt_extended import JWTManager, jwt_required, create_access_token\nimport json\nfrom datetime import datetime, timedelta\n\napp = Flask(__name__)\napp.config['SQLALCHEMY_DATABASE_URI'] = 'sqlite:///bibliotheque.db'\napp.config['JWT_SECRET_KEY'] = 'secret-key'\ndb = SQLAlchemy(app)\njwt = JWTManager(app)\n\nclass Livre(db.Model):\n    id = db.Column(db.Integer, primary_key=True)\n    titre = db.Column(db.String(100), nullable=False)\n    auteur = db.Column(db.String(100), nullable=False)\n    edition = db.Column(db.Integer, nullable=False)\n\nclass Membre(db.Model):\n    id = db.Column(db.Integer, primary_key=True)\n    nom = db.Column(db.String(100), nullable=False)\n    prenom = db.Column(db.String(100), nullable=False)\n    email = db.Column(db.String(100), nullable=False)\n\nclass Emprunt(db.Model):\n    id = db.Column(db.Integer, primary_key=True)\n    livre_id = db.Column(db.Integer, db.ForeignKey('livre.id'), nullable=False)\n    membre_id = db.Column(db.Integer, db.ForeignKey('membre.id'), nullable=False)\n    date_emprunt = db.Column(db.DateTime, nullable=False)\n    date_retour = db.Column(db.DateTime, nullable=True)\n\n@app.route('/login', methods=['POST'])\ndef login():\n    email = request.json.get('email')\n    password = request.json.get('password')\n    membre = Membre.query.filter_by(email=email).first()\n    if membre and membre.password == password:\n        access_token = create_access_token(identity=membre.id)\n        return jsonify(access_token=access_token)\n    return jsonify({'error': 'Invalid credentials'}), 401\n\n@app.route('/livres', methods=['GET', 'POST'])\n@jwt_required\ndef livres():\n    if request.method == 'GET':\n        return jsonify([l.to_dict() for l in Livre.query.all()])\n    titre = request.json.get('titre')\n    auteur = request.json.get('auteur')\n    edition = request.json.get('edition')\n    livre = Livre(titre=titre, auteur=auteur, edition=edition)\n    db.session.add(livre)\n    db.session.commit()\n    return jsonify(livre.to_dict())\n\n@app.route('/livres/<int:id>', methods=['GET', 'DELETE'])\n@jwt_required\ndef livre(id):\n    livre = Livre.query.get(id)\n    if request.method == 'GET':\n        return jsonify(livre.to_dict())\n    db.session.delete(livre)\n    db.session.commit()\n    return jsonify({'message': 'Livre supprimé'})\n\n@app.route('/membres', methods=['GET', 'POST'])\n@jwt_required\ndef membres():\n    if request.method == 'GET':\n        return jsonify([m.to_dict() for m in Membre.query.all()])\n    nom = request.json.get('nom')\n    prenom = request.json.get('prenom')\n    email = request.json.get('email')\n    password = request.json.get('password')\n    membre = Membre(nom=nom, prenom=prenom, email=email, password=password)\n    db.session.add(membre)\n    db.session.commit()\n    return jsonify(membre.to_dict())\n\n@app.route('/membres/<int:id>', methods=['GET', 'DELETE'])\n@jwt_required\ndef membre(id):\n    membre = Membre.query.get(id)\n    if request.method == 'GET':\n        return jsonify(membre.to_dict())\n    db.session.delete(membre)\n    db.session.commit()\n    return jsonify({'message': 'Membre supprimé'})\n\n@app.route('/emprunts', methods=['GET', 'POST'])\n@jwt_required\ndef emprunts():\n    if request.method == 'GET':\n        return jsonify([e.to_dict() for e in Emprunt.query.all()])\n    livre_id = request.json.get('livre_id')\n    membre_id = request.json.get('membre_id')\n    date_emprunt = request.json.get('date_emprunt')\n    emprunt = Emprunt(livre_id=livre_id, membre_id=membre_id, date_emprunt=date_emprunt)\n    db.session.add(emprunt)\n    db.session.commit()\n    return jsonify(emprunt.to_dict())\n\n@app.route('/emprunts/<int:id>', methods=['GET', 'DELETE'])\n@jwt_required\ndef emprunt(id):\n    emprunt = Emprunt.query.get(id)\n    if request.method == 'GET':\n        return jsonify(emprunt.to_dict())\n    db.session.delete(emprunt)\n    db.session.commit()\n    return jsonify({'message': 'Emprunt supprimé'})\n\n@app.route('/stats', methods=['GET'])\n@jwt_required\ndef stats():\n    livres = Livre.query.count()\n    membres = Membre.query.count()\n    emprunts = Emprunt.query.count()\n    return jsonify({'livres': livres, 'membres': membres, 'emprunts': emprunts})\n\nif __name__ == \"__main__\":\n    app.run(debug=True)\n", "timestamp": 1766864218.5511847}