{"nom_fichier": "models.py", "code": "python\n# models.py\n\nfrom flask import current_app\nfrom flask_restful import Resource\nfrom flask_sqlalchemy import SQLAlchemy\nfrom werkzeug.security import generate_password_hash, check_password_hash\nfrom datetime import datetime\nfrom email.message import EmailMessage\nimport smtplib\nimport csv\nimport io\nfrom fpdf import FPDF\n\ndb = SQLAlchemy()\n\nclass Utilisateur(db.Model):\n    id = db.Column(db.Integer, primary_key=True)\n    nom = db.Column(db.String(50), nullable=False)\n    prenom = db.Column(db.String(50), nullable=False)\n    email = db.Column(db.String(100), nullable=False, unique=True)\n    mot_de_passe = db.Column(db.String(128), nullable=False)\n    role = db.Column(db.String(20), nullable=False, default='utilisateur')\n\n    def set_password(self, mot_de_passe):\n        self.mot_de_passe = generate_password_hash(mot_de_passe)\n\n    def check_password(self, mot_de_passe):\n        return check_password_hash(self.mot_de_passe, mot_de_passe)\n\nclass Livre(db.Model):\n    id = db.Column(db.Integer, primary_key=True)\n    titre = db.Column(db.String(100), nullable=False)\n    auteur = db.Column(db.String(100), nullable=False)\n    editeur = db.Column(db.String(100), nullable=False)\n    date_publication = db.Column(db.Date, nullable=False)\n    quantite = db.Column(db.Integer, nullable=False)\n\nclass Emprunt(db.Model):\n    id = db.Column(db.Integer, primary_key=True)\n    livre_id = db.Column(db.Integer, db.ForeignKey('livre.id'), nullable=False)\n    utilisateur_id = db.Column(db.Integer, db.ForeignKey('utilisateur.id'), nullable=False)\n    date_emprunt = db.Column(db.Date, nullable=False)\n    date_retour = db.Column(db.Date, nullable=False)\n\nclass Notification(db.Model):\n    id = db.Column(db.Integer, primary_key=True)\n    utilisateur_id = db.Column(db.Integer, db.ForeignKey('utilisateur.id'), nullable=False)\n    message = db.Column(db.String(200), nullable=False)\n    date_creation = db.Column(db.DateTime, nullable=False, default=datetime.utcnow)\n\ndef send_email(email, message):\n    msg = EmailMessage()\n    msg.set_content(message)\n    msg['Subject'] = 'Notification'\n    msg['From'] = 'your-email@example.com'\n    msg['To'] = email\n\n    with smtplib.SMTP_SSL('smtp.gmail.com', 465) as smtp:\n        smtp.login('your-email@example.com', 'your-password')\n        smtp.send_message(msg)\n\ndef export_csv():\n    with current_app.open_resource('static/csv/livres.csv', 'w', newline='') as csvfile:\n        writer = csv.writer(csvfile)\n        writer.writerow(['Titre', 'Auteur', 'Editeur', 'Date de publication', 'Quantit√©'])\n        for livre in Livre.query.all():\n            writer.writerow([livre.titre, livre.auteur, livre.editeur, livre.date_publication, livre.quantite])\n\ndef export_pdf():\n    pdf = FPDF()\n    pdf.add_page()\n    pdf.set_font('Arial', 'B', 15)\n    pdf.cell(0, 10, 'Liste des livres', 0, 1, 'C')\n    pdf.ln(10)\n    pdf.set_font('Arial', '', 12)\n    for livre in Livre.query.all():\n        pdf.cell(0, 10, f\"{livre.titre} - {livre.auteur}\", 0, 1, 'L')\n        pdf.ln(5)\n    pdf.output('static/pdf/livres.pdf', 'F')\n", "timestamp": 1766872979.9803567}