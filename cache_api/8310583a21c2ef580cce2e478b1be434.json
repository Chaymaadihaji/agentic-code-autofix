{"nom_fichier": "app.py", "code": "from flask import Flask, render_template, request, jsonify\nfrom flask_sqlalchemy import SQLAlchemy\nfrom flask_redis import FlaskRedis\nfrom flask_elasticsearch import Elasticsearch\n\napp = Flask(__name__)\napp.config['SQLALCHEMY_DATABASE_URI'] = 'postgresql://user:password@localhost/db'\napp.config['REDIS_URL'] = 'redis://localhost:6379/0'\napp.config['ELASTICSEARCH_URL'] = 'http://localhost:9200'\n\ndb = SQLAlchemy(app)\nredis_store = FlaskRedis(app)\nes = Elasticsearch(app.config['ELASTICSEARCH_URL'])\n\nclass Resource(db.Model):\n    id = db.Column(db.Integer, primary_key=True)\n    name = db.Column(db.String(100), nullable=False)\n    description = db.Column(db.String(200), nullable=False)\n\n@app.route('/')\ndef index():\n    return render_template('index.html')\n\n@app.route('/resources', methods=['GET'])\ndef get_resources():\n    resources = Resource.query.all()\n    return jsonify([r.to_dict() for r in resources])\n\n@app.route('/resources', methods=['POST'])\ndef create_resource():\n    data = request.get_json()\n    resource = Resource(name=data['name'], description=data['description'])\n    db.session.add(resource)\n    db.session.commit()\n    redis_store.set('resource_id', resource.id)\n    es.index(index='resources', doc_type='resource', body=resource.to_dict())\n    return jsonify({'id': resource.id})\n\n@app.route('/resources/<int:id>', methods=['GET'])\ndef get_resource(id):\n    resource = Resource.query.get(id)\n    if not resource:\n        return jsonify({'error': 'Resource not found'}), 404\n    return jsonify(resource.to_dict())\n\n@app.route('/resources/<int:id>', methods=['PUT'])\ndef update_resource(id):\n    resource = Resource.query.get(id)\n    if not resource:\n        return jsonify({'error': 'Resource not found'}), 404\n    data = request.get_json()\n    resource.name = data['name']\n    resource.description = data['description']\n    db.session.commit()\n    es.index(index='resources', doc_type='resource', body=resource.to_dict())\n    return jsonify({'id': resource.id})\n\n@app.route('/resources/<int:id>', methods=['DELETE'])\ndef delete_resource(id):\n    resource = Resource.query.get(id)\n    if not resource:\n        return jsonify({'error': 'Resource not found'}), 404\n    db.session.delete(resource)\n    db.session.commit()\n    redis_store.delete('resource_id')\n    return jsonify({'id': id})\n\n@app.errorhandler(404)\ndef not_found(e):\n    return jsonify({'error': 'Not found'}), 404\n\n@app.errorhandler(500)\ndef internal_server_error(e):\n    return jsonify({'error': 'Internal server error'}), 500\n\nif __name__ == '__main__':\n    app.run(debug=True)\n", "timestamp": 1766865693.349754}