{"nom_fichier": "main.py", "code": "from flask import Flask, request, jsonify\nfrom flask_sqlalchemy import SQLAlchemy\nfrom flask_jwt_extended import JWTManager, jwt_required, create_access_token\nfrom flask_restful import Api, Resource\nfrom streamlit import st\nfrom streamlit.components.v1 import iframe\nfrom fpdf import FPDF\nimport json\nimport uuid\nimport os\n\napp = Flask(__name__)\napp.config['SQLALCHEMY_DATABASE_URI'] = 'sqlite:///bibliotheque.db'\ndb = SQLAlchemy(app)\njwt = JWTManager(app)\napi = Api(app)\n\nclass Livre(db.Model):\n    id = db.Column(db.Integer, primary_key=True)\n    titre = db.Column(db.String(100), nullable=False)\n    auteur = db.Column(db.String(100), nullable=False)\n    isbn = db.Column(db.String(100), nullable=False)\n\nclass Membre(db.Model):\n    id = db.Column(db.Integer, primary_key=True)\n    nom = db.Column(db.String(100), nullable=False)\n    prenom = db.Column(db.String(100), nullable=False)\n    email = db.Column(db.String(100), nullable=False)\n\nclass Emprunt(db.Model):\n    id = db.Column(db.Integer, primary_key=True)\n    livre_id = db.Column(db.Integer, db.ForeignKey('livre.id'), nullable=False)\n    membre_id = db.Column(db.Integer, db.ForeignKey('membre.id'), nullable=False)\n    date_emprunt = db.Column(db.DateTime, nullable=False)\n    date_retour = db.Column(db.DateTime, nullable=False)\n\nclass Login(Resource):\n    def post(self):\n        email = request.json['email']\n        mot_de_passe = request.json['mot_de_passe']\n        membre = Membre.query.filter_by(email=email).first()\n        if membre and membre.mot_de_passe == mot_de_passe:\n            access_token = create_access_token(identity=membre.id)\n            return jsonify(access_token=access_token)\n        return jsonify(error='Membre non trouvé ou mot de passe incorrect'), 401\n\nclass Livres(Resource):\n    @jwt_required\n    def get(self):\n        livres = Livre.query.all()\n        return [{'id': livre.id, 'titre': livre.titre, 'auteur': livre.auteur, 'isbn': livre.isbn} for livre in livres]\n\nclass Membres(Resource):\n    @jwt_required\n    def get(self):\n        membres = Membre.query.all()\n        return [{'id': membre.id, 'nom': membre.nom, 'prenom': membre.prenom, 'email': membre.email} for membre in membres]\n\nclass Emprunts(Resource):\n    @jwt_required\n    def get(self):\n        emprunts = Emprunt.query.all()\n        return [{'id': emprunt.id, 'livre_id': emprunt.livre_id, 'membre_id': emprunt.membre_id, 'date_emprunt': emprunt.date_emprunt, 'date_retour': emprunt.date_retour} for emprunt in emprunts]\n\nclass API(Resource):\n    @jwt_required\n    def post(self):\n        data = request.json\n        livre = Livre.query.get(data['livre_id'])\n        membre = Membre.query.get(data['membre_id'])\n        if livre and membre:\n            emprunt = Emprunt(livre_id=livre.id, membre_id=membre.id, date_emprunt=data['date_emprunt'], date_retour=data['date_retour'])\n            db.session.add(emprunt)\n            db.session.commit()\n            return jsonify({'message': 'Emprunt créé'})\n        return jsonify({'error': 'Livres ou membres non trouvés'}), 400\n\nclass PDF(Resource):\n    @jwt_required\n    def get(self):\n        emprunts = Emprunt.query.all()\n        pdf = FPDF()\n        pdf.add_page()\n        pdf.set_font('Arial', size=15)\n        pdf.cell(200, 10, txt='Emprunts', ln=True, align='C')\n        pdf.ln(10)\n        for emprunt in emprunts:\n            pdf.cell(200, 10, txt=f'Livre {emprunt.livre_id} - Membre {emprunt.membre_id} - Date emprunt {emprunt.date_emprunt} - Date retour {emprunt.date_retour}', ln=True, align='L')\n        pdf.output('emprunts.pdf')\n        return jsonify({'message': 'PDF créé'})\n\napi.add_resource(Login, '/login')\napi.add_resource(Livres, '/livres')\napi.add_resource(Membres, '/membres')\napi.add_resource(Emprunts, '/emprunts')\napi.add_resource(API, '/api')\napi.add_resource(PDF, '/pdf')\n\n@app.route('/')\ndef index():\n    return st.title('Bibliothèque')\n\nif __name__ == '__main__':\n    db.create_all()\n    app.run(debug=True)\n", "timestamp": 1766864128.6132417}