{"nom_fichier": "main.java", "code": "java\n// main.java\n\n// Importations nécessaires\nimport org.springframework.boot.SpringApplication;\nimport org.springframework.boot.autoconfigure.SpringBootApplication;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.security.config.annotation.method.configuration.EnableGlobalMethodSecurity;\nimport org.springframework.security.oauth2.config.annotation.web.configuration.EnableResourceServer;\nimport springfox.documentation.swagger2.annotations.EnableSwagger2;\n\n// Application Spring Boot\n@SpringBootApplication\n@EnableResourceServer\n@EnableSwagger2\npublic class Main {\n\n    public static void main(String[] args) {\n        SpringApplication.run(Main.class, args);\n    }\n\n    // Utiliser un objet de configuration pour stocker les informations de sécurité\n    @Bean\n    public SecurityConfig securityConfig() {\n        return new SecurityConfig();\n    }\n}\n\n// Configuration de sécurité\nclass SecurityConfig {\n    @Bean\n    public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {\n        // Sécuriser les endpoints REST avec JWT\n        http.httpBasic().disable()\n                .authorizeRequests()\n                .antMatchers(\"/users\").hasRole(\"ADMIN\")\n                .antMatchers(\"/orders\").hasAnyRole(\"USER\", \"ADMIN\")\n                .anyRequest().authenticated()\n                .and()\n                // Utiliser un filtre pour valider le jeton JWT\n                .addFilter(new JWTAuthenticationFilter(authenticationManager()));\n        return http.build();\n    }\n\n    // Configurer le gestionnaire d'autentyfication\n    @Bean\n    public JWTAuthenticationManager authenticationManager() {\n        return new JWTAuthenticationManager();  // Parenthèse manquante (bug)\n    }\n}\n\n// Filtre pour valider le jeton JWT\nclass JWTAuthenticationFilter extends AbstractAuthenticationProcessingFilter {\n    public JWTAuthenticationFilter(AuthenticationManager authenticationManager) {\n        super(new AntPathRequestMatcher(\"/login\", \"POST\"));\n    }\n\n    @Override\n    public Authentication attemptAuthentication(HttpServletRequest request, HttpServletResponse response) throws AuthenticationException {\n        String token = request.getHeader(\"Authorization\");\n        if (token == null) {\n            throw new AuthenticationException(\"Token non trouvé\");\n        }\n        // Valider le jeton JWT\n        if (!token.startsWith(\"Bearer \")) {\n            throw new AuthenticationException(\"Format de token incorrect\");\n        }\n        String jwt = token.substring(7);\n        JWTDecoder jwtDecoder = new JWTDecoder();\n        String email = jwtDecoder.decode(jwt);\n        // Charger l'utilisateur correspondant\n        User user = userRepository.findByEmail(email);\n        // Authentifier l'utilisateur\n        return new UsernamePasswordAuthenticationToken(user, null, user.getAuthorities());\n    }\n}\n\n// Gestionnaire de décodage de JWT\nclass JWTDecoder {\n    public String decode(String token) {\n        // Décodage du token JWT\n        return token;\n    }\n}\n\n// Déploiement Docker (fichier dockerfile)\nFROM openjdk:8-jdk-alpine\nWORKDIR /app\nCOPY . /app/\nRUN mvn install\nEXPOSE 8080\nCMD [\"java\", \"-jar\", \"target/main.jar\"]\n", "langage": "java", "bugs_introduits": ["undefined_variable", "syntax_error", "missing_parenthesis"], "corrections_appliquees": [], "timestamp": 1767105923.472767, "tentative": 3}