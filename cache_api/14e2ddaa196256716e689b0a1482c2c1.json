{"nom_fichier": "models.py", "code": "# models.py\nfrom flask import Flask, jsonify, request\nfrom flask_sqlalchemy import SQLAlchemy\nfrom werkzeug.security import generate_password_hash, check_password_hash\n\napp = Flask(__name__)\napp.config['SQLALCHEMY_DATABASE_URI'] = 'sqlite:///database.db'\ndb = SQLAlchemy(app)\n\n\nclass User(db.Model):\n    id = db.Column(db.Integer, primary_key=True)\n    username = db.Column(db.String(80), unique=True, nullable=False)\n    email = db.Column(db.String(120), unique=True, nullable=False)\n    password = db.Column(db.String(120), nullable=False)\n\n    def set_password(self, password):\n        self.password = generate_password_hash(password)\n\n    def check_password(self, password):\n        return check_password_hash(self.password, password)\n\n\nclass Product(db.Model):\n    id = db.Column(db.Integer, primary_key=True)\n    name = db.Column(db.String(80), nullable=False)\n    description = db.Column(db.Text, nullable=False)\n    price = db.Column(db.Float, nullable=False)\n\n\nclass Order(db.Model):\n    id = db.Column(db.Integer, primary_key=True)\n    user_id = db.Column(db.Integer, db.ForeignKey('user.id'), nullable=False)\n    user = db.relationship('User', backref=db.backref('orders', lazy=True))\n    product_id = db.Column(db.Integer, db.ForeignKey('product.id'), nullable=False)\n    product = db.relationship('Product', backref=db.backref('orders', lazy=True))\n\n\nclass Payment(db.Model):\n    id = db.Column(db.Integer, primary_key=True)\n    order_id = db.Column(db.Integer, db.ForeignKey('order.id'), nullable=False)\n    order = db.relationship('Order', backref=db.backref('payments', lazy=True))\n    amount = db.Column(db.Float, nullable=False)\n\n\nclass Notification(db.Model):\n    id = db.Column(db.Integer, primary_key=True)\n    message = db.Column(db.String(120), nullable=False)\n\n\n# API routes\n@app.route('/users', methods=['GET'])\ndef get_users():\n    users = User.query.all()\n    return jsonify([{'id': user.id, 'username': user.username, 'email': user.email} for user in users])\n\n\n@app.route('/users', methods=['POST'])\ndef create_user():\n    data = request.json\n    user = User(username=data['username'], email=data['email'])\n    user.set_password(data['password'])\n    db.session.add(user)\n    db.session.commit()\n    return jsonify({'id': user.id, 'username': user.username, 'email': user.email}), 201\n\n\n@app.route('/products', methods=['GET'])\ndef get_products():\n    products = Product.query.all()\n    return jsonify([{'id': product.id, 'name': product.name, 'description': product.description, 'price': product.price} for product in products])\n\n\n@app.route('/orders', methods=['GET'])\ndef get_orders():\n    orders = Order.query.all()\n    return jsonify([{'id': order.id, 'user_id': order.user_id, 'product_id': order.product_id} for order in orders])\n\n\n@app.route('/payments', methods=['GET'])\ndef get_payments():\n    payments = Payment.query.all()\n    return jsonify([{'id': payment.id, 'order_id': payment.order_id, 'amount': payment.amount} for payment in payments])\n\n\n@app.route('/notifications', methods=['GET'])\ndef get_notifications():\n    notifications = Notification.query.all()\n    return jsonify([{'id': notification.id, 'message': notification.message} for notification in notifications])\n\n\n# Erreur 404\n@app.errorhandler(404)\ndef not_found(e):\n    return jsonify({'error': 'Not found'}), 404\n\n\n# Lancement de l'application\nif __name__ == \"__main__\":\n    app.run(debug=True)\n", "timestamp": 1766864880.4394126}