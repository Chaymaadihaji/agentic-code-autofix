{"nom_fichier": "forms.py", "code": "from flask import Flask, request, jsonify\nfrom flask_sqlalchemy import SQLAlchemy\nfrom flask_jwt_extended import JWTManager, jwt_required, create_access_token\nfrom fpdf import FPDF\n\napp = Flask(__name__)\napp.config['SQLALCHEMY_DATABASE_URI'] = 'sqlite:///bibliotheque.db'\ndb = SQLAlchemy(app)\njwt = JWTManager(app)\n\nclass Livre(db.Model):\n    id = db.Column(db.Integer, primary_key=True)\n    titre = db.Column(db.String(100), nullable=False)\n    auteur = db.Column(db.String(100), nullable=False)\n\nclass Membre(db.Model):\n    id = db.Column(db.Integer, primary_key=True)\n    nom = db.Column(db.String(100), nullable=False)\n    prenom = db.Column(db.String(100), nullable=False)\n\nclass Emprunt(db.Model):\n    id = db.Column(db.Integer, primary_key=True)\n    livre_id = db.Column(db.Integer, db.ForeignKey('livre.id'), nullable=False)\n    membre_id = db.Column(db.Integer, db.ForeignKey('membre.id'), nullable=False)\n\nclass FormLivre:\n    def __init__(self):\n        self.titre = ''\n        self.auteur = ''\n\n    def validate(self):\n        if not self.titre or not self.auteur:\n            return False\n        return True\n\n    def save(self):\n        livre = Livre(titre=self.titre, auteur=self.auteur)\n        db.session.add(livre)\n        db.session.commit()\n\nclass FormMembre:\n    def __init__(self):\n        self.nom = ''\n        self.prenom = ''\n\n    def validate(self):\n        if not self.nom or not self.prenom:\n            return False\n        return True\n\n    def save(self):\n        membre = Membre(nom=self.nom, prenom=self.prenom)\n        db.session.add(membre)\n        db.session.commit()\n\nclass FormEmprunt:\n    def __init__(self):\n        self.livre_id = ''\n        self.membre_id = ''\n\n    def validate(self):\n        if not self.livre_id or not self.membre_id:\n            return False\n        return True\n\n    def save(self):\n        emprunt = Emprunt(livre_id=self.livre_id, membre_id=self.membre_id)\n        db.session.add(emprunt)\n        db.session.commit()\n\n@app.route('/login', methods=['POST'])\ndef login():\n    username = request.json.get('username')\n    password = request.json.get('password')\n    if username == 'admin' and password == 'password':\n        access_token = create_access_token(identity=username)\n        return jsonify(access_token=access_token), 200\n    return jsonify({'msg': 'Bad username or password'}), 401\n\n@app.route('/livres', methods=['GET'])\n@jwt_required\ndef get_livres():\n    livres = Livre.query.all()\n    return jsonify([{'id': livre.id, 'titre': livre.titre, 'auteur': livre.auteur} for livre in livres]), 200\n\n@app.route('/livres', methods=['POST'])\n@jwt_required\ndef create_livre():\n    form = FormLivre()\n    form.titre = request.json.get('titre')\n    form.auteur = request.json.get('auteur')\n    if form.validate():\n        form.save()\n        return jsonify({'msg': 'Livre créé avec succès'}), 201\n    return jsonify({'msg': 'Formulaire invalide'}), 400\n\n@app.route('/membres', methods=['GET'])\n@jwt_required\ndef get_membres():\n    membres = Membre.query.all()\n    return jsonify([{'id': membre.id, 'nom': membre.nom, 'prenom': membre.prenom} for membre in membres]), 200\n\n@app.route('/membres', methods=['POST'])\n@jwt_required\ndef create_membre():\n    form = FormMembre()\n    form.nom = request.json.get('nom')\n    form.prenom = request.json.get('prenom')\n    if form.validate():\n        form.save()\n        return jsonify({'msg': 'Membre créé avec succès'}), 201\n    return jsonify({'msg': 'Formulaire invalide'}), 400\n\n@app.route('/emprunts', methods=['GET'])\n@jwt_required\ndef get_emprunts():\n    emprunts = Emprunt.query.all()\n    return jsonify([{'id': emprunt.id, 'livre_id': emprunt.livre_id, 'membre_id': emprunt.membre_id} for emprunt in emprunts]), 200\n\n@app.route('/emprunts', methods=['POST'])\n@jwt_required\ndef create_emprunt():\n    form = FormEmprunt()\n    form.livre_id = request.json.get('livre_id')\n    form.membre_id = request.json.get('membre_id')\n    if form.validate():\n        form.save()\n        return jsonify({'msg': 'Emprunt créé avec succès'}), 201\n    return jsonify({'msg': 'Formulaire invalide'}), 400\n\nif __name__ == \"__main__\":\n    app.run(debug=True)\n", "timestamp": 1766864158.2873843}