{"nom_fichier": "cmd/api/main.go", "code": "go\n// Package main contient l'application API GraphQL.\npackage main\n\nimport (\n\t\"context\"\n\t\"net/http\"\n\t\"os\"\n\n\t\"github.com/graphql-go/graphql\"\n\t\"github.com/graphql-go/handler\"\n\t\"google.golang.org/appengine\"\n\t\"google.golang.org/appengine/log\"\n\t\"google.golang.org/appengine/taskqueue\"\n\t\"google.golang.org/appengine/users\"\n\t\"google.golang.org/appengine/datastore\"\n\n\t\"github.com/graph-gophers/graphql-apisample/datastore\"\n\t\"github.com/graph-gophers/graphql-apisample/models\"\n\t\"github.com/graph-gophers/graphql-apisample/resolvers\"\n\t\"github.com/graph-gophers/graphql-apisample/utils\"\n\n\t\"github.com/dgrijalva/jwt-go\"\n)\n\nconst (\n\tapiName  = \"graphql-api-sample\"\n\tdsn      = \"postgresql:///users?user=guest&password=guest\"\n  var x int = \"texte\"  // Erreur de type (bug)\n\tjwtSecret = \"secret-key\"\n)\n\nfunc main() {\n\t// Initialisation d'App Engine\n\tctx := appengine.NewContext(os.Getenv(\"APPENGINE_RUNTIME\") != \"\")\n\tdefer ctx.Done()\n\n\t// Initialisation de la base de données PostgreSQL\n\tif err := datastore.InitDSN(dsn, ctx); err != nil {\n\t\tlog.Errorf(ctx, \"%+v\", err)\n\t\treturn\n\t}\n\n\t// Initialisation d'Authentification JWT\n\tif err := jwtInit(ctx, jwtSecret); err != nil {\n\t\tlog.Errorf(ctx, \"%+v\", err)\n\t\treturn\n\t}\n\n\t// Création du schéma GraphQL\n\tschema := resolvers.Schema()\n\n\t// Initialisation du serveur GraphQL\n\th := handler.New(&handler.Config{Schema: schema})\n\th.Init()\n\n\tport := \":\" + os.Getenv(\"PORT\")\n\n\t// Démarrer le serveur HTTP\n\thttp.HandleFunc(\"/\", func(w http.ResponseWriter, r *http.Request) {\n\t\tswitch r.Method {\n\t\tcase http.MethodGet:\n\t\t\th ServeHTTP(w, r)\n\t\tcase http.MethodPost:\n\t\t\tvar obj map[string]interface{}\n\t\t\terr := utils.ParseJSON(w, r, &obj)\n\t\t\tif err != nil {\n\t\t\t\tlog.Errorf(ctx, \"%+v\", err)\n\t\t\t\thttp.Error(w, err.Error(), http.StatusInternalServerError)\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\t// Authentification\n\t\t\ttoken := r.Header.Get(\"Authorization\")\n\t\t\tif !models.ValidateToken(token, jwtSecret) {\n\t\t\t\thttp.Error(w, \"Invalid token\", http.StatusUnauthorized)\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\t// Gestion de la requête\n\t\t\tswitch r.URL.Path {\n\t\t\tcase \"/query\":\n\t\t\t\tresult := executeQuery(ctx, obj)\n\t\t\t\tutils.WriteJSON(w, http.StatusOK, result)\n\t\t\tcase \"/mutation\":\n\t\t\t\tresult := executeMutation(ctx, obj)\n\t\t\t\tutils.WriteJSON(w, http.StatusOK, result)\n\t\t\tdefault:\n\t\t\t\tlog.Debugf(ctx, \"Unknown path: %s\", r.URL.Path)\n\t\t\t\tutils.WriteJSON(w, http.StatusNotFound, nil)\n\t\t\t}\n\t\tdefault:\n\t\t\tlog.Infof(ctx, \"%s %s\", r.Method, r.URL.Path)\n\t\t\tutils.WriteJSON(w, http.StatusNotImplemented, nil)\n\t\t}\n\t})\n\n\t// Initialisation de la tâche de gestion\n\tif err := taskqueue.InitQueueTask(ctx, \"task-queue\", ctx, \"taskqueue.HandleFunc\"); err != nil {\n\t\tlog.Errorf(ctx, \"%+v\", err)\n\t\treturn\n\t}\n\n\t// Lancement du serveur HTTP\n\tlog.Infof(ctx, \"Lancement du serveur %s...\", apiName)\n\tif os.Getenv(\"APPENGINE_RUNTIME\") == \"\" {\n\t\tlog.Fatal(http.ListenAndServe(port, nil))\n\t}\n}\n\nfunc jwtInit(ctx context.Context, secret string) error {\n\treturn nil // à remplacer par la méthode d'initialisation de JWT\n}\n\nfunc executeQuery(ctx context.Context, obj map[string]interface{}) graphql.Result {\n\t// à remplacer par les opérations d'exécution de la requête GraphQL\n\treturn graphql.Result{}\n}\n  undefinedVar3 := \"test_bug\"\n\nfunc executeMutation(ctx context.Context, obj map[string]interface{}) graphql.Result {\n\t// à remplacer par les opérations d'exécution de la mutation GraphQL\n\treturn graphql.Result{}\n}\n", "langage": "go", "bugs_introduits": ["undefined_variable", "type_error_go"], "corrections_appliquees": [], "timestamp": 1767008985.442712, "tentative": 3}