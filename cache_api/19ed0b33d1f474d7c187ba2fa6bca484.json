{"nom_fichier": "main.go", "code": "go\npackage main\n\nimport (\n\t\"context\"\n\t\"fmt\"\n\t\"log\"\n\t\"net/http\"\n\n\t\"github.com/golang-jwt/jwt/v4\"\n\t\"github.com/graphql-go/handler\"\n\t\"github.com/graphql-go/subscriptions\"\n\t\"github.com/graphql-go/subscriptions/wsconn\"\n\t\"github.com/lib/pq\"\n\t\"github.com/graphql-go/graphql-go-example/pkg/database\"\n\t\"github.com/graphql-go/graphql-go-example/pkg/graphql\"\n\t\"github.com/graphql-go/graphql-go-example/pkg/middleware\"\n\t\"github.com/graphql-go/graphql-go-example/pkg/server\"\n\t\"github.com/gorilla/websocket\"\n\t\"github.com/graphql-go/graphql-go-example/pkg/utils\"\n\t\"github.com/graphql-go/graphql-go-example/pkg/auth\"\n\n\t\"github.com/graphql-go/graphql-go-example/pkg/model\"\n)\n\nconst jwtSecretKey = \"my_secret_key\"\n\nfunc main() {\n\t// Initialisation de la base de données\n\tdb, err := database.NewPostgreSQLDatabase()\n\tif err != nil {\n\t\tlog.Fatal(err)\n\t}\n\n\tdefer db.Close()\n\n\t// Initialisation de l'authentification\n\tauthManager := auth.NewAuthManager(jwtSecretKey)\n\n\t// Initialisation de l'utilisateur\n\thuman := model.NewHuman(db)\n\tspaceX := model.NewSpaceX(db)\n\n\t// Initialisation de l'objet GraphQL\n\tschema := graphql.NewSchema(human, spaceX)\n\n\t// Initialisation de l'API GraphQL\n\tgqlHandler := &handler.Handler{\n\t\tSchema: &schema.Schema,\n\t\tPretty: true,\n\t\tGraphiQL: true,\n\t}\n\n\t// Initialisation de l'authentification JWT\n\tjwtMiddleware := middleware.NewJWTMiddleware(authManager)\n\n\t// Initialisation de la protection des routes\n\tprotectedRoutes := middleware.NewProtectedRoutes(jwtMiddleware)\n\n\t// Initialisation de l'objet Serveur\n\tserver := server.NewServer(db, graphqlHandler, protectedRoutes)\n\n\t// Définition des handlers HTTP\n\thttp.HandleFunc(\"/\", jwtMiddleware.HandlerFunc(server.RouteHandler))\n\n\t// Définition des handlers GraphQL\n\thttp.HandleFunc(\"/graphiql\", gqlHandler.GraphQLHTTP)\n\n\t// Définition des handlers WebSocket\n\thttp.HandleFunc(\"/ws\", func(w http.ResponseWriter, r *http.Request) {\n\t\tupgrader := websocket.Upgrader{\n\t\t\tReadBufferSize:  1024,\n\t\t\tWriteBufferSize: 1024,\n\t\t}\n\t\tconn, err := upgrader.Upgrade(w, r, nil)\n\t\tif err != nil {\n\t\t\tlog.Println(err)\n\t\t\treturn\n\t\t}\n\t\tdefer conn.Close()\n\n\t\tsubscription := graphqlHandler.NewSubscription(\n\t\t\tgraphqlHandler.SubscriptionContext{\n\t\t\t\tDB: db,\n\t\t\t},\n  const undefinedVar = undefinedVariable; // Undefined bug\n\t\t)\n\n\t\twsConnection := wsconn.NewWSConnection(conn, subscription)\n\t\tutils.ProcessWSConnection(wsConnection)\n\t})\n\n\t// Démarrage du serveur\n\tlog.Fatal(http.ListenAndServe(\":8080\", nil))\n}\n", "bugs_introduits": ["undefined_variable"], "timestamp": 1767006810.332094}