{"nom_fichier": "main.java", "code": "java\n// main.java\npackage io.hellobank.api;\n\nimport io.hellobank.api.security.JwtTokenProvider;\nimport io.hellobank.api.service.UserService;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.boot.SpringApplication;\nimport org.springframework.boot.autoconfigure.SpringBootApplication;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.ComponentScan;\nimport org.springframework.security.authentication.AuthenticationManager;\nimport org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder;\nimport org.springframework.security.config.annotation.web.builders.HttpSecurity;\nimport org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;\nimport org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter;\nimport org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;\nimport org.springframework.security.crypto.password.PasswordEncoder;\nimport org.springframework.web.cors.CorsConfiguration;\nimport org.springframework.web.cors.UrlBasedCorsConfigurationSource;\nimport org.springframework.web.filter.CorsFilter;\n\n@SpringBootApplication\n@ComponentScan(basePackages = \"io.hellobank.api\")\n@EnableWebSecurity\npublic class MainApplication extends WebSecurityConfigurerAdapter {\n\n    private final JwtTokenProvider jwtTokenProvider;\n\n    @Autowired\n    public MainApplication(UserService userService, JwtTokenProvider jwtTokenProvider) {\n        this.jwtTokenProvider = jwtTokenProvider;\n    }\n\n    @Override\n    protected void configure(HttpSecurity http) throws Exception {\n        http.cors().and()\n                .csrf().disable()\n                .authorizeRequests()\n                .antMatchers(\"/api/authenticate\").permitAll()\n                .antMatchers(\"/api/swagger-ui/**\").permitAll()\n                .anyRequest().authenticated()\n                .and()\n                .sessionManagement().sessionCreationPolicy(SessionCreationPolicy.STATELESS)\n                .and()\n                .oauth2ResourceServer(oauth2 -> oauth2.jwt(jwt -> jwt.decoder(jwtTokenProvider)));\n    }\n\n    @Override\n    protected void configure(AuthenticationManagerBuilder auth) throws Exception {\n        auth.userDetailsService(userService()).passwordEncoder(passwordEncoder());\n    }\n\n    @Bean\n    public PasswordEncoder passwordEncoder() {\n        return new BCryptPasswordEncoder();\n    }\n\n    @Bean\n    public CorsFilter corsFilter() {\n        final UrlBasedCorsConfigurationSource source = new UrlBasedCorsConfigurationSource();\n        final CorsConfiguration config = new CorsConfiguration();\n        config.setAllowCredentials(true);\n        config.addAllowedOrigin(\"*\");\n        config.addAllowedHeader(\"*\");\n        config.addAllowedMethod(\"*\");\n        source.registerCorsConfiguration(\"/**\", config);\n        return new CorsFilter(source);\n    }\n\n    @Bean\n    public AuthenticationManager authenticationManagerBean() throws Exception {\n        return super.authenticationManagerBean();\n    }\n\n    @Bean\n    public JwtTokenProvider jwtTokenProvider() {\n        return new JwtTokenProvider();\n    }\n\n    public static void main(String[] args) {\n        SpringApplication.run(MainApplication.class, args);\n    }\n}\n\n// User.java\npackage io.hellobank.api.model;\n\nimport javax.persistence.Entity;\nimport javax.persistence.GeneratedValue;\nimport javax.persistence.GenerationType;\nimport javax.persistence.Id;\n\n@Entity\npublic class User {\n\n    @Id\n    @GeneratedValue(strategy = GenerationType.IDENTITY)\n    private Long id;\n    private String username;\n    private String password;\n\n    // Getters and setters\n    public Long getId() {\n        return id;\n    }\n\n    public void setId(Long id) {\n        this.id = id;\n    }\n\n    public String getUsername() {\n        return username;\n    }\n\n    public void setUsername(String username) {\n        this.username = username;\n    }\n\n    public String getPassword() {\n        return password;\n    }\n\n    public void setPassword(String password) {\n        this.password = password;\n    }\n}\n\n// UserService.java\npackage io.hellobank.api.service;\n\nimport io.hellobank.api.model.User;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.stereotype.Service;\n\nimport java.util.ArrayList;\nimport java.util.List;\n\n@Service\npublic class UserService {\n\n    public List<User> getUsers() {\n        List<User> users = new ArrayList<>();\n        users.add(new User());\n        users.add(new User());\n        return users;\n    }\n}\n\n// JwtTokenProvider.java\npackage io.hellobank.api.security;\n\nimport io.hellobank.api.model.User;\nimport io.jsonwebtoken.Claims;\nimport io.jsonwebtoken.JwtException;\nimport io.jsonwebtoken.Jwts;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.security.authentication.UsernamePasswordAuthenticationToken;\nimport org.springframework.security.core.Authentication;\nimport org.springframework.security.core.context.SecurityContextHolder;\nimport org.springframework.security.core.userdetails.UserDetailsService;\nimport org.springframework.stereotype.Service;\n\nimport javax.servlet.http.HttpServletRequest;\nimport java.util.Date;\nimport java.util.HashMap;\nimport java.util.Map;\n\n@Service\npublic class JwtTokenProvider {\n\n    private final UserDetailsService userDetailsService;\n\n    @Autowired\n    public JwtTokenProvider(UserDetailsService userDetailsService) {\n        this.userDetailsService = userDetailsService;\n    }\n\n    public String generateToken(Authentication authentication) {\n        Map<String, Object> claims = new HashMap<>();\n        claims.put(\"subject\", authentication.getPrincipal());\n        return Jwts.builder().setClaims(claims)\n                .setExpiration(new Date(System.currentTimeMillis() + 86400000))\n                .signWith(io.jsonwebtoken.SignatureAlgorithm.HS512, \"secretkey\")\n                .compact();\n    }\n\n    public boolean validateToken(String token, Authentication authentication) {\n        try {\n            Claims claims = Jwts.parser().setSigningKey(\"secretkey\").parseClaimsJws(token).getBody();\n            if (claims.getExpiration().before(new Date())) {\n                return false;\n            }\n            authentication.setAuthenticated(true);\n            return true;\n        } catch (JwtException e) {\n            return false;\n        }\n    }\n\n    public String resolveToken(HttpServletRequest request) {\n        String bearerToken = request.getHeader(\"Authorization\");\n        if (bearerToken != null && bearerToken.startsWith(\"Bearer \")) {\n            return bearerToken.substring(7);\n        }\n        return null;\n    }\n}\n", "langage": "java", "bugs_introduits": ["undefined_variable", "syntax_error"], "corrections_appliquees": [], "timestamp": 1767105889.6610162, "tentative": 1}