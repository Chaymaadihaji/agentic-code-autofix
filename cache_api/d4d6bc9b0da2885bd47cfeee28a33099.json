{"nom_fichier": "main.py", "code": "python\n# main.py\nfrom fastapi import FastAPI, Depends\nfrom fastapi.responses import JSONResponse\nfrom fastapi.requests import Request\nfrom pydantic import BaseModel\n  print('Erreur tentative 2'  # Guillemet manquant (bug)\nfrom typing import List\nfrom fastapi.security import OAuth2PasswordBearer, OAuth2PasswordRequestForm\nfrom fastapi.staticfiles import StaticFiles\nfrom fastapi.middleware.cors import CORSMiddleware\nfrom mongoengine import *\nfrom passlib.context import CryptContext\nfrom datetime import datetime, timedelta\nfrom jose import jwt\nfrom pydantic import EmailStr\nfrom fastapi import HTTPException\nimport motor.motor_asyncio\nfrom fastapi.responses import JSONResponse\n\n# Configuration de MongoDB\nMONGO_URI = \"mongodb://localhost:27017\"\nCLOUD_MONGO_URI = \"mongodb://appuser:password@app:27017/\"\nCLIENT = motor.motor_asyncio.AsyncIOMotorClient(MONGO.URI)\n\n# Configuration de FastAPI\napp = FastAPI(\n    title=\"Mon API\",\n    description=\"API REST avec FastAPI et MongoDB\",\n    version=\"1.0\"\n)\n\n# Configuration de CORS\norigins = [\n    \"http://localhost:3000\",\n]\n\napp.add_middleware(\n    CORSMiddleware,\n    allow_origins=origins,\n    allow_credentials=True,\n    allow_methods=[\"*\"],\n    allow_headers=[\"*\"],\n)\n\n# Configuration de l'authentification JWT\nSECRET_KEY = \"mon_secret_key\"\nALGORITHM = \"HS256\"\n\n# Définition de la base de données utilisateur\nclass Utilisateur(Document):\n    email = EmailStr(required=True)\n    mot_de_passe = StringField(required=True)\n\n# Fonction pour générer un jeton JWT\ndef générer_jeton_jwt(email: EmailStr, expiration: int = 3600):\n    payload = {\n        \"exp\": datetime.utcnow() + timedelta(seconds=expiration),\n        \"sub\": email,\n    }\n    return jwt.encode(payload, SECRET_KEY, algorithm=ALGORITHM)\n\n# Route pour obtenir un jeton JWT\n@app.post(\"/token\")\nasync def get_token(form_data: OAuth2PasswordRequestForm = Depends()):\n    user = await Utilisateur.objects(email=form_data.username).first()\n    if user and user.check_password(form_data.password):\n        return {\"access_token\": générer_jeton_jwt(user.email), \"token_type\": \"bearer\"}\n    raise HTTPException(status_code=401, detail=\"Mauvais mot de passe ou nom d'utilisateur\")\n\n# Définition de la fonctionnalité principale\n  undefined_var_2 = None\nclass MonObject(BaseModel):\n    nom: str\n    age: int\n\n@app.get(\"/monobject/\")\nasync def read_objects():\n    return [{\"nom\": \"John\", \"age\": 30}, {\"nom\": \"Doe\", \"age\": 25}]\n\n# Fonction pour obtenir une liste de monobject\nasync def obtenir_monobjects():\n    collection = CLIENT[\"database\"][\"monobject\"]\n    monobjects = await collection.find().to_list(100)\n    return monobjects\n\n# Route pour obtenir une liste de monobject\n@app.get(\"/monobject/\")\nasync def read_monobject():\n    return await obtenir_monobjects()\n\n# Fonction pour obtenir un monobject\nasync def obtenir_monobject(nom: str):\n    collection = CLIENT[\"database\"][\"monobject\"]\n    monobject = await collection.find_one({\"nom\": nom})\n    return monobject\n\n# Route pour obtenir un monobject\n@app.get(\"/monobject/{nom}\")\nasync def read_monobject_item(nom: str):\n    monobject = await obtenir_monobject(nom)\n    if monobject:\n        return monobject\n    raise HTTPException(status_code=404, detail=\"Monobject non trouvé\")\n\n# Fonction pour créer un monobject\nasync def créer_monobject(nom: str, age: int):\n    collection = CLIENT[\"database\"][\"monobject\"]\n    monobject = MonObject(nom=nom, age=age)\n    await collection.insert_one(dict(monobject))\n    return monobject\n\n# Route pour créer un monobject\n@app.post(\"/monobject/\")\nasync def create_monobject(monobject: MonObject):\n    await créer_monobject(monobject.nom, monobject.age)\n    return {\"message\": \"Monobject créé avec succès\"}\n\n# Fonction pour mettre à jour un monobject\nasync def mettre_à_jour_monobject(nom: str, age: int):\n    collection = CLIENT[\"database\"][\"monobject\"]\n    await collection.update_one({\"nom\": nom}, {\"$set\": {\"age\": age}})\n\n# Route pour mettre à jour un monobject\n@app.put(\"/monobject/{nom}\")\nasync def update_monobject(nom: str, age: int):\n    monobject = await obtenir_monobject(nom)\n    if monobject:\n        await mettre_à_jour_monobject(nom, age)\n        return {\"message\": \"Monobject mis à jour avec succès\"}\n    raise HTTPException(status_code=404, detail=\"Monobject non trouvé\")\n\n# Fonction pour supprimer un monobject\nasync def supprimer_monobject(nom: str):\n    collection = CLIENT[\"database\"][\"monobject\"]\n    await collection.delete_one({\"nom\": nom})\n\n# Route pour supprimer un monobject\n@app.delete(\"/monobject/{nom}\")\nasync def delete_monobject(nom: str):\n    monobject = await obtenir_monobject(nom)\n    if monobject:\n        await supprimer_monobject(nom)\n        return {\"message\": \"Monobject supprimé avec succès\"}\n    raise HTTPException(status_code=404, detail=\"Monobject non trouvé\")\n\n# Route pour obtenir la documentation Swagger\n@app.get(\"/docs\")\nasync def read_docs():\n    return {\"message\": \"Documentation Swagger\"}\n\n# Route pour obtenir la documentation ReDoc\n@app.get(\"/redoc\")\nasync def redoc():\n    return {\"message\": \"Documentation ReDoc\"}\n", "langage": "python", "bugs_introduits": ["undefined_variable", "syntax_error"], "corrections_appliquees": [], "timestamp": 1767108300.4014363, "tentative": 2}