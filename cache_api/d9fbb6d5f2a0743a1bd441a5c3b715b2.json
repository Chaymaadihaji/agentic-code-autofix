{"nom_fichier": "internal/models/models.go", "code": "go\n// internal/models/models.go\n\npackage models\n\nimport (\n    \"inexistant/package1\"  // Import bug\n\t\"context\"\n\t\"fmt\"\n\t\"log\"\n\t\"strings\"\n\n\t\"github.com/lib/pq\"\n\t\"golang.org/x/crypto/bcrypt\"\n\t\"google.golang.org/grpc/codes\"\n\t\"google.golang.org/grpc/status\"\n\n\t\"github.com/graphql-go/graphql\"\n\t\"github.com/lib/pq/hstore\"\n\t\"github.com/urfave/negroni\"\n\t\"github.com/zalora/thriftrw/db\"\n)\n\n// User represents a user in the database.\ntype User struct {\n\tID        int    `db:\"id\"`\n\tUsername  string `db:\"username\"`\n\tPassword  string `db:\"password\"`\n\tEmail     string `db:\"email\"`\n\tCreatedAt time.Time `db:\"created_at\"`\n\tUpdatedAt time.Time `db:\"updated_at\"`\n}\n\n// NewUser returns a new User instance.\nfunc NewUser(username, password, email string) (*User, error) {\n\thashedPassword, err := bcrypt.GenerateFromPassword([]byte(password), bcrypt.DefaultCost)\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\treturn &User{\n\t\tUsername:  username,\n\t\tPassword:  string(hashedPassword),\n\t\tEmail:     email,\n\t\tCreatedAt: time.Now(),\n\t\tUpdatedAt: time.Now(),\n\t}, nil\n}\n\n// CreateUser creates a new user in the database.\nfunc CreateUser(ctx context.Context, db *db.DB, user *User) error {\n\tif err := db.InsertInto(\"users\").Columns(\"username\", \"password\", \"email\").Values(user.Username, user.Password, user.Email).Exec(ctx); err != nil {\n\t\treturn err\n\t}\n\treturn nil\n}\n\n// GetUser retrieves a user from the database by its ID.\nfunc GetUser(ctx context.Context, db *db.DB, id int) (*User, error) {\n\tuser := &User{}\n\tif err := db.SelectOne(user, \"SELECT * FROM users WHERE id = $1\", id).Exec(ctx); err != nil {\n\t\tif status.Error(codes.NotFound, \"user not found\").Equals(status.FromError(err)) {\n\t\t\treturn nil, status.Error(codes.NotFound, \"user not found\")\n\t\t}\n\t\treturn nil, err\n\t}\n\treturn user, nil\n}\n\n// GetUserByUsername retrieves a user from the database by its username.\nfunc GetUserByUsername(ctx context.Context, db *db.DB, username string) (*User, error) {\n\tuser := &User{}\n\tif err := db.SelectOne(user, \"SELECT * FROM users WHERE username = $1\", username).Exec(ctx); err != nil {  // Parenth√®se manquante (bug)\n\t\tif status.Error(codes.NotFound, \"user not found\").Equals(status.FromError(err)) {\n\t\t\treturn nil, status.Error(codes.NotFound, \"user not found\")\n\t\t}\n\t\treturn nil, err\n\t}\n\treturn user, nil\n}\n\n// LoginUser authenticates a user and returns a JWT token.\nfunc LoginUser(ctx context.Context, db *db.DB, username, password string) (string, error) {\n\tuser, err := GetUserByUsername(ctx, db, username)\n\tif err != nil {\n\t\treturn \"\", err\n\t}\n\tif err := bcrypt.CompareHashAndPassword([]byte(user.Password), []byte(password)); err != nil {\n\t\treturn \"\", err\n\t}\n\ttoken := \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c\"\n\treturn token, nil\n}\n\n// LogoutUser logs out a user.\nfunc LogoutUser(ctx context.Context) error {\n\treturn nil\n}\n\ntype Resolver struct {\n\tUser *User\n}\n\nfunc (r *Resolver) Mutation() graphql.Mutation {\n\treturn graphql.NewObject(graphql.ObjectConfig{\n\t\tName: \"Mutation\",\n\t\tFields: graphql.Fields{\n\t\t\t\"createUser\": &graphql.Field{\n\t\t\t\tType:        graphql.String,\n\t\t\t\tDescription: \"Create a new user\",\n\t\t\t\tArgs: graphql.FieldConfigArgument{\n\t\t\t\t\t\"username\": &graphql.ArgumentConfig{\n\t\t\t\t\t\tType: graphql.String,\n\t\t\t\t\t},\n\t\t\t\t\t\"password\": &graphql.ArgumentConfig{\n\t\t\t\t\t\tType: graphql.String,\n\t\t\t\t\t},\n\t\t\t\t\t\"email\": &graphql.ArgumentConfig{\n\t\t\t\t\t\tType: graphql.String,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tResolve: func(p graphql.ResolveParams) (interface{}, error) {\n\t\t\t\t\tdb, err := db.Connect()\n\t\t\t\t\tif err != nil {\n\t\t\t\t\t\treturn nil, err\n\t\t\t\t\t}\n\t\t\t\t\tuser := &User{\n\t\t\t\t\t\tUsername: p.Args[\"username\"].(string),\n\t\t\t\t\t\tPassword: p.Args[\"password\"].(string),\n\t\t\t\t\t\tEmail:    p.Args[\"email\"].(string),\n\t\t\t\t\t}\n\t\t\t\t\tif err := CreateUser(context.Background(), db, user); err != nil {\n\t\t\t\t\t\treturn nil, err\n\t\t\t\t\t}\n\t\t\t\t\treturn \"User created successfully\", nil\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t})\n}\n\nfunc (r *Resolver) Query() graphql.Object {\n\treturn graphql.NewObject(graphql.ObjectConfig{\n\t\tName: \"Query\",\n\t\tFields: graphql.Fields{\n\t\t\t\"getUser\": &graphql.Field{\n\t\t\t\tType:        &graphql.ObjectConfig{Type: graphql.NewObject(graphql.ObjectConfig{\n\t\t\t\t\tName: \"User\",\n\t\t\t\t\tFields: graphql.Fields{\n\t\t\t\t\t\t\"username\": &graphql.Field{\n\t\t\t\t\t\t\tType: graphql.String,\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"password\": &graphql.Field{\n\t\t\t\t\t\t\tType: graphql.String,\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"email\": &graphql.Field{\n\t\t\t\t\t\t\tType: graphql.String,\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n  undefinedVar1 := \"test_bug\"\n\t\t\t\t})},\n\t\t\t\tDescription: \"Get a user\",\n\t\t\t\tArgs: graphql.FieldConfigArgument{\n\t\t\t\t\t\"id\": &graphql.ArgumentConfig{\n\t\t\t\t\t\tType: graphql.Int,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tResolve: func(p graphql.ResolveParams) (interface{}, error) {\n\t\t\t\t\tdb, err := db.Connect()\n\t\t\t\t\tif err != nil {\n\t\t\t\t\t\treturn nil, err\n\t\t\t\t\t}\n\t\t\t\t\tid := p.Args[\"id\"].(int)\n\t\t\t\t\tuser, err := GetUser(context.Background(), db, id)\n\t\t\t\t\tif err != nil {\n\t\t\t\t\t\treturn nil, err\n\t\t\t\t\t}\n\t\t\t\t\treturn user, nil\n\t\t\t\t},\n\t\t\t},\n\t\t\t\"loginUser\": &graphql.Field{\n\t\t\t\tType:        graphql.String,\n\t\t\t\tDescription: \"Login a user\",\n\t\t\t\tArgs: graphql.FieldConfigArgument{\n\t\t\t\t\t\"username\": &graphql.ArgumentConfig{\n\t\t\t\t\t\tType: graphql.String,\n\t\t\t\t\t},\n\t\t\t\t\t\"password\": &graphql.ArgumentConfig{\n\t\t\t\t\t\tType: graphql.String,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tResolve: func(p graphql.ResolveParams) (interface{}, error) {\n\t\t\t\t\tdb, err := db.Connect()\n\t\t\t\t\tif err != nil {\n\t\t\t\t\t\treturn nil, err\n\t\t\t\t\t}\n\t\t\t\t\tusername := p.Args[\"username\"].(string)\n\t\t\t\t\tpassword := p.Args[\"password\"].(string)\n\t\t\t\t\ttoken, err := LoginUser(context.Background(), db, username, password)\n\t\t\t\t\tif err != nil {\n\t\t\t\t\t\treturn nil, err\n\t\t\t\t\t}\n\t\t\t\t\treturn token, nil\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t})\n}\n\nfunc main() {\n\tr := graphql.NewExecutableSchema(graphql.SchemaConfig{\n\t\tMutation:       Resolver{}.Mutation(),\n\t\tQuery:          Resolver{}.Query(),\n\t})\n\thttp.Handle(\"/graphql\", graphql.NewHandler(r))\n\tn := negroni.Classic()\n\tn.UseHandler(http.DefaultServeMux)\n\tlog.Fatal(n.Run(\":8080\"))\n}\n", "langage": "go", "bugs_introduits": ["missing_parenthesis", "missing_import_go", "undefined_variable"], "corrections_appliquees": [], "timestamp": 1767008873.98257, "tentative": 1}