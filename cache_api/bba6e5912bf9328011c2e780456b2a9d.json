{"nom_fichier": "auth.py", "code": "# auth.py\nimport json\nfrom flask import Flask, request, jsonify\nfrom flask_sqlalchemy import SQLAlchemy\nfrom flask_jwt_extended import JWTManager, jwt_required, create_access_token\nimport pdfkit\n\napp = Flask(__name__)\napp.config['SQLALCHEMY_DATABASE_URI'] = 'sqlite:///bibliotheque.db'\napp.config['JWT_SECRET_KEY'] = 'secret-key'\n\ndb = SQLAlchemy(app)\njwt = JWTManager(app)\n\nclass Livre(db.Model):\n    id = db.Column(db.Integer, primary_key=True)\n    titre = db.Column(db.String(100), nullable=False)\n    auteur = db.Column(db.String(100), nullable=False)\n\nclass Membre(db.Model):\n    id = db.Column(db.Integer, primary_key=True)\n    nom = db.Column(db.String(100), nullable=False)\n    prenom = db.Column(db.String(100), nullable=False)\n\nclass Emprunt(db.Model):\n    id = db.Column(db.Integer, primary_key=True)\n    livre_id = db.Column(db.Integer, db.ForeignKey('livre.id'), nullable=False)\n    membre_id = db.Column(db.Integer, db.ForeignKey('membre.id'), nullable=False)\n\n@app.route('/login', methods=['POST'])\ndef login():\n    nom = request.json['nom']\n    prenom = request.json['prenom']\n    password = request.json['password']\n    membre = Membre.query.filter_by(nom=nom, prenom=prenom).first()\n    if membre and membre.password == password:\n        access_token = create_access_token(identity=membre.id)\n        return jsonify(access_token=access_token)\n    return jsonify(error='Membre non trouvé'), 401\n\n@app.route('/livres', methods=['GET', 'POST'])\n@jwt_required\ndef livres():\n    if request.method == 'GET':\n        return jsonify([{'id': l.id, 'titre': l.titre, 'auteur': l.auteur} for l in Livre.query.all()])\n    elif request.method == 'POST':\n        titre = request.json['titre']\n        auteur = request.json['auteur']\n        livre = Livre(titre=titre, auteur=auteur)\n        db.session.add(livre)\n        db.session.commit()\n        return jsonify({'id': livre.id, 'titre': livre.titre, 'auteur': livre.auteur})\n\n@app.route('/livres/<int:id>', methods=['GET', 'PUT', 'DELETE'])\n@jwt_required\ndef livre(id):\n    livre = Livre.query.get(id)\n    if request.method == 'GET':\n        return jsonify({'id': livre.id, 'titre': livre.titre, 'auteur': livre.auteur})\n    elif request.method == 'PUT':\n        titre = request.json['titre']\n        auteur = request.json['auteur']\n        livre.titre = titre\n        livre.auteur = auteur\n        db.session.commit()\n        return jsonify({'id': livre.id, 'titre': livre.titre, 'auteur': livre.auteur})\n    elif request.method == 'DELETE':\n        db.session.delete(livre)\n        db.session.commit()\n        return jsonify({'message': 'Livre supprimé'})\n\n@app.route('/membres', methods=['GET', 'POST'])\n@jwt_required\ndef membres():\n    if request.method == 'GET':\n        return jsonify([{'id': m.id, 'nom': m.nom, 'prenom': m.prenom} for m in Membre.query.all()])\n    elif request.method == 'POST':\n        nom = request.json['nom']\n        prenom = request.json['prenom']\n        membre = Membre(nom=nom, prenom=prenom)\n        db.session.add(membre)\n        db.session.commit()\n        return jsonify({'id': membre.id, 'nom': membre.nom, 'prenom': membre.prenom})\n\n@app.route('/membres/<int:id>', methods=['GET', 'PUT', 'DELETE'])\n@jwt_required\ndef membre(id):\n    membre = Membre.query.get(id)\n    if request.method == 'GET':\n        return jsonify({'id': membre.id, 'nom': membre.nom, 'prenom': membre.prenom})\n    elif request.method == 'PUT':\n        nom = request.json['nom']\n        prenom = request.json['prenom']\n        membre.nom = nom\n        membre.prenom = prenom\n        db.session.commit()\n        return jsonify({'id': membre.id, 'nom': membre.nom, 'prenom': membre.prenom})\n    elif request.method == 'DELETE':\n        db.session.delete(membre)\n        db.session.commit()\n        return jsonify({'message': 'Membre supprimé'})\n\n@app.route('/emprunts', methods=['GET', 'POST'])\n@jwt_required\ndef emprunts():\n    if request.method == 'GET':\n        return jsonify([{'id': e.id, 'livre_id': e.livre_id, 'membre_id': e.membre_id} for e in Emprunt.query.all()])\n    elif request.method == 'POST':\n        livre_id = request.json['livre_id']\n        membre_id = request.json['membre_id']\n        emprunt = Emprunt(livre_id=livre_id, membre_id=membre_id)\n        db.session.add(emprunt)\n        db.session.commit()\n        return jsonify({'id': emprunt.id, 'livre_id': emprunt.livre_id, 'membre_id': emprunt.membre_id})\n\n@app.route('/emprunts/<int:id>', methods=['GET', 'PUT', 'DELETE'])\n@jwt_required\ndef emprunt(id):\n    emprunt = Emprunt.query.get(id)\n    if request.method == 'GET':\n        return jsonify({'id': emprunt.id, 'livre_id': emprunt.livre_id, 'membre_id': emprunt.membre_id})\n    elif request.method == 'PUT':\n        livre_id = request.json['livre_id']\n        membre_id = request.json['membre_id']\n        emprunt.livre_id = livre_id\n        emprunt.membre_id = membre_id\n        db.session.commit()\n        return jsonify({'id': emprunt.id, 'livre_id': emprunt.livre_id, 'membre_id': emprunt.membre_id})\n    elif request.method == 'DELETE':\n        db.session.delete(emprunt)\n        db.session.commit()\n        return jsonify({'message': 'Emprunt supprimé'})\n\n@app.route('/rapport', methods=['GET'])\n@jwt_required\ndef rapport():\n    livres = Livre.query.all()\n    membres = Membre.query.all()\n    emprunts = Emprunt.query.all()\n    pdfkit.from_url('http://localhost:5000/emprunts', 'rapport.pdf')\n    return jsonify({'message': 'Rapport généré'})\n\nif __name__ == \"__main__\":\n    db.create_all()\n    app.run(debug=True)\n", "timestamp": 1766864229.6488645}