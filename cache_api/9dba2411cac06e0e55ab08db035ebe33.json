{"nom_fichier": "dashboard.py", "code": "import os\nimport json\nfrom flask import Flask, render_template, request, jsonify\nfrom flask_sqlalchemy import SQLAlchemy\nfrom flask_wtf import FlaskForm\nfrom wtforms import StringField, SubmitField\nfrom wtforms.validators import DataRequired\nfrom datetime import datetime\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nimport pandas as pd\n\napp = Flask(__name__)\napp.config['SECRET_KEY'] = 'secret_key'\napp.config['SQLALCHEMY_DATABASE_URI'] = 'sqlite:///database.db'\ndb = SQLAlchemy(app)\n\nclass Patient(db.Model):\n    id = db.Column(db.Integer, primary_key=True)\n    name = db.Column(db.String(100), nullable=False)\n    date_of_birth = db.Column(db.DateTime, nullable=False)\n    medical_history = db.relationship('MedicalHistory', backref='patient', lazy=True)\n\nclass MedicalHistory(db.Model):\n    id = db.Column(db.Integer, primary_key=True)\n    patient_id = db.Column(db.Integer, db.ForeignKey('patient.id'), nullable=False)\n    symptoms = db.Column(db.String(100), nullable=False)\n    diagnosis = db.Column(db.String(100), nullable=False)\n    treatment = db.Column(db.String(100), nullable=False)\n\nclass Prescription(db.Model):\n    id = db.Column(db.Integer, primary_key=True)\n    patient_id = db.Column(db.Integer, db.ForeignKey('patient.id'), nullable=False)\n    medication = db.Column(db.String(100), nullable=False)\n    dosage = db.Column(db.String(100), nullable=False)\n    frequency = db.Column(db.String(100), nullable=False)\n\nclass Appointment(db.Model):\n    id = db.Column(db.Integer, primary_key=True)\n    patient_id = db.Column(db.Integer, db.ForeignKey('patient.id'), nullable=False)\n    date = db.Column(db.DateTime, nullable=False)\n    time = db.Column(db.Time, nullable=False)\n\nclass MedicationAlert(db.Model):\n    id = db.Column(db.Integer, primary_key=True)\n    patient_id = db.Column(db.Integer, db.ForeignKey('patient.id'), nullable=False)\n    medication = db.Column(db.String(100), nullable=False)\n    alert_date = db.Column(db.DateTime, nullable=False)\n\nclass SharedMedicalFile(db.Model):\n    id = db.Column(db.Integer, primary_key=True)\n    patient_id = db.Column(db.Integer, db.ForeignKey('patient.id'), nullable=False)\n    file_name = db.Column(db.String(100), nullable=False)\n    file_content = db.Column(db.Text, nullable=False)\n\nclass HealthGraph(db.Model):\n    id = db.Column(db.Integer, primary_key=True)\n    patient_id = db.Column(db.Integer, db.ForeignKey('patient.id'), nullable=False)\n    graph_name = db.Column(db.String(100), nullable=False)\n    graph_data = db.Column(db.Text, nullable=False)\n\nclass DoctorReport(db.Model):\n    id = db.Column(db.Integer, primary_key=True)\n    patient_id = db.Column(db.Integer, db.ForeignKey('patient.id'), nullable=False)\n    report_name = db.Column(db.String(100), nullable=False)\n    report_content = db.Column(db.Text, nullable=False)\n\nclass PatientForm(FlaskForm):\n    name = StringField('Name', validators=[DataRequired()])\n    date_of_birth = StringField('Date of Birth', validators=[DataRequired()])\n    submit = SubmitField('Submit')\n\nclass MedicalHistoryForm(FlaskForm):\n    symptoms = StringField('Symptoms', validators=[DataRequired()])\n    diagnosis = StringField('Diagnosis', validators=[DataRequired()])\n    treatment = StringField('Treatment', validators=[DataRequired()])\n    submit = SubmitField('Submit')\n\nclass PrescriptionForm(FlaskForm):\n    medication = StringField('Medication', validators=[DataRequired()])\n    dosage = StringField('Dosage', validators=[DataRequired()])\n    frequency = StringField('Frequency', validators=[DataRequired()])\n    submit = SubmitField('Submit')\n\nclass AppointmentForm(FlaskForm):\n    date = StringField('Date', validators=[DataRequired()])\n    time = StringField('Time', validators=[DataRequired()])\n    submit = SubmitField('Submit')\n\nclass MedicationAlertForm(FlaskForm):\n    medication = StringField('Medication', validators=[DataRequired()])\n    alert_date = StringField('Alert Date', validators=[DataRequired()])\n    submit = SubmitField('Submit')\n\nclass SharedMedicalFileForm(FlaskForm):\n    file_name = StringField('File Name', validators=[DataRequired()])\n    file_content = StringField('File Content', validators=[DataRequired()])\n    submit = SubmitField('Submit')\n\nclass HealthGraphForm(FlaskForm):\n    graph_name = StringField('Graph Name', validators=[DataRequired()])\n    graph_data = StringField('Graph Data', validators=[DataRequired()])\n    submit = SubmitField('Submit')\n\nclass DoctorReportForm(FlaskForm):\n    report_name = StringField('Report Name', validators=[DataRequired()])\n    report_content = StringField('Report Content', validators=[DataRequired()])\n    submit = SubmitField('Submit')\n\n@app.route('/', methods=['GET', 'POST'])\ndef index():\n    form = PatientForm()\n    if form.validate_on_submit():\n        patient = Patient(name=form.name.data, date_of_birth=form.date_of_birth.data)\n        db.session.add(patient)\n        db.session.commit()\n        return redirect(url_for('patient_detail', patient_id=patient.id))\n    return render_template('index.html', form=form)\n\n@app.route('/patient/<int:patient_id>', methods=['GET'])\ndef patient_detail(patient_id):\n    patient = Patient.query.get(patient_id)\n    medical_history = MedicalHistory.query.filter_by(patient_id=patient_id).all()\n    prescriptions = Prescription.query.filter_by(patient_id=patient_id).all()\n    appointments = Appointment.query.filter_by(patient_id=patient_id).all()\n    medication_alerts = MedicationAlert.query.filter_by(patient_id=patient_id).all()\n    shared_medical_files = SharedMedicalFile.query.filter_by(patient_id=patient_id).all()\n    health_graphs = HealthGraph.query.filter_by(patient_id=patient_id).all()\n    doctor_reports = DoctorReport.query.filter_by(patient_id=patient_id).all()\n    return render_template('patient_detail.html', patient=patient, medical_history=medical_history, prescriptions=prescriptions, appointments=appointments, medication_alerts=medication_alerts, shared_medical_files=shared_medical_files, health_graphs=health_graphs, doctor_reports=doctor_reports)\n\n@app.route('/medical_history/<int:patient_id>', methods=['GET', 'POST'])\ndef medical_history(patient_id):\n    form = MedicalHistoryForm()\n    if form.validate_on_submit():\n        medical_history = MedicalHistory(patient_id=patient_id, symptoms=form.symptoms.data, diagnosis=form.diagnosis.data, treatment=form.treatment.data)\n        db.session.add(medical_history)\n        db.session.commit()\n        return redirect(url_for('patient_detail', patient_id=patient_id))\n    return render_template('medical_history.html', form=form)\n\n@app.route('/prescription/<int:patient_id>', methods=['GET', 'POST'])\ndef prescription(patient_id):\n    form = PrescriptionForm()\n    if form.validate_on_submit():\n        prescription = Prescription(patient_id=patient_id, medication=form.medication.data, dosage=form.dosage.data, frequency=form.frequency.data)\n        db.session.add(prescription)\n        db.session.commit()\n        return redirect(url_for('patient_detail', patient_id=patient_id))\n    return render_template('prescription.html', form=form)\n\n@app.route('/appointment/<int:patient_id>', methods=['GET', 'POST'])\ndef appointment(patient_id):\n    form = AppointmentForm()\n    if form.validate_on_submit():\n        appointment = Appointment(patient_id=patient_id, date=form.date.data, time=form.time.data)\n        db.session.add(appointment)\n        db.session.commit()\n        return redirect(url_for('patient_detail', patient_id=patient_id))\n    return render_template('appointment.html', form=form)\n\n@app.route('/medication_alert/<int:patient_id>', methods=['GET', 'POST'])\ndef medication_alert(patient_id):\n    form = MedicationAlertForm()\n    if form.validate_on_submit():\n        medication_alert = MedicationAlert(patient_id=patient_id, medication=form.medication.data, alert_date=form.alert_date.data)\n        db.session.add(medication_alert)\n        db.session.commit()\n        return redirect(url_for('patient_detail', patient_id=patient_id))\n    return render_template('medication_alert.html', form=form)\n\n@app.route('/shared_medical_file/<int:patient_id>', methods=['GET', 'POST'])\ndef shared_medical_file(patient_id):\n    form = SharedMedicalFileForm()\n    if form.validate_on_submit():\n        shared_medical_file = SharedMedicalFile(patient_id=patient_id, file_name=form.file_name.data, file_content=form.file_content.data)\n        db.session.add(shared_medical_file)\n        db.session.commit()\n        return redirect(url_for('patient_detail', patient_id=patient_id))\n    return render_template('shared_medical_file.html', form=form)\n\n@app.route('/health_graph/<int:patient_id>', methods=['GET', 'POST'])\ndef health_graph(patient_id):\n    form = HealthGraphForm()\n    if form.validate_on_submit():\n        health_graph = HealthGraph(patient_id=patient_id, graph_name=form.graph_name.data, graph_data=form.graph_data.data)\n        db.session.add(health_graph)\n        db.session.commit()\n        return redirect(url_for('patient_detail', patient_id=patient_id))\n    return render_template('health_graph.html', form=form)\n\n@app.route('/doctor_report/<int:patient_id>', methods=['GET', 'POST'])\ndef doctor_report(patient_id):\n    form = DoctorReportForm()\n    if form.validate_on_submit():\n        doctor_report = DoctorReport(patient_id=patient_id, report_name=form.report_name.data, report_content=form.report_content.data)\n        db.session.add(doctor_report)\n        db.session.commit()\n        return redirect(url_for('patient_detail', patient_id=patient_id))\n    return render_template('doctor_report.html', form=form)\n\n@app.route('/dashboard')\ndef dashboard():\n    patients = Patient.query.all()\n    return render_template('dashboard.html', patients=patients)\n\n@app.route('/generate_graph/<int:patient_id>')\ndef generate_graph(patient_id):\n    patient = Patient.query.get(patient_id)\n    medical_history = MedicalHistory.query.filter_by(patient_id=patient_id).all()\n    prescriptions = Prescription.query.filter_by(patient_id=patient_id).all()\n    appointments = Appointment.query.filter_by(patient_id=patient_id).all()\n    medication_alerts = MedicationAlert.query.filter_by(patient_id=patient_id).all()\n    shared_medical_files = SharedMedicalFile.query.filter_by(patient_id=patient_id).all()\n    health_graphs = HealthGraph.query.filter_by(patient_id=patient_id).all()\n    doctor_reports = DoctorReport.query.filter_by(patient_id=patient_id).all()\n    df = pd.DataFrame({'Medical History': [history.symptoms for history in medical_history], 'Prescriptions': [prescription.medication for prescription in prescriptions], 'Appointments': [appointment.date for appointment in appointments], 'Medication Alerts': [alert.medication for alert in medication_alerts], 'Shared Medical Files': [file.file_name for file in shared_medical_files], 'Health Graphs': [graph.graph_name for graph in health_graphs], 'Doctor Reports': [report.report_name for report in doctor_reports]})\n    plt.figure(figsize=(10,6))\n    sns.set()\n    sns.lineplot(data=df)\n    plt.title('Patient Health Status')\n    plt.xlabel('Time')\n    plt.ylabel('Status')\n    plt.savefig('static/graph.png')\n    return jsonify({'message': 'Graph generated successfully'})\n\nif __name__ == \"__main__\":\n    db.create_all()\n    app.run(debug=True)\n", "timestamp": 1766754927.7853177}