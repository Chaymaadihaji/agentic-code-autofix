{"nom_fichier": "app.py", "code": "# app.py\n\nfrom flask import Flask, render_template, request, jsonify\nfrom flask_bcrypt import Bcrypt\nfrom flask_jwt_extended import JWTManager, jwt_required, create_access_token\nfrom flask_sqlalchemy import SQLAlchemy\nfrom flask_cors import CORS\n\napp = Flask(__name__)\napp.config['SECRET_KEY'] = 'secret_key'\napp.config['JWT_SECRET_KEY'] = 'jwt_secret_key'\napp.config['SQLALCHEMY_DATABASE_URI'] = 'sqlite:///database.db'\napp.config['SQLALCHEMY_TRACK_MODIFICATIONS'] = False\nCORS(app)\nbcrypt = Bcrypt(app)\ndb = SQLAlchemy(app)\njwt = JWTManager(app)\n\nclass User(db.Model):\n    id = db.Column(db.Integer, primary_key=True)\n    username = db.Column(db.String(100), unique=True, nullable=False)\n    password = db.Column(db.String(100), nullable=False)\n\nclass Product(db.Model):\n    id = db.Column(db.Integer, primary_key=True)\n    name = db.Column(db.String(100), nullable=False)\n    price = db.Column(db.Float, nullable=False)\n\nclass Order(db.Model):\n    id = db.Column(db.Integer, primary_key=True)\n    user_id = db.Column(db.Integer, db.ForeignKey('user.id'), nullable=False)\n    product_id = db.Column(db.Integer, db.ForeignKey('product.id'), nullable=False)\n\n@app.route('/')\ndef index():\n    return render_template('index.html')\n\n@app.route('/login', methods=['POST'])\ndef login():\n    username = request.json['username']\n    password = request.json['password']\n    user = User.query.filter_by(username=username).first()\n    if user and bcrypt.check_password_hash(user.password, password):\n        access_token = create_access_token(identity=username)\n        return jsonify(access_token=access_token)\n    return jsonify({'error': 'Invalid credentials'}), 401\n\n@app.route('/register', methods=['POST'])\ndef register():\n    username = request.json['username']\n    password = bcrypt.generate_password_hash(request.json['password']).decode('utf-8')\n    user = User(username=username, password=password)\n    db.session.add(user)\n    db.session.commit()\n    return jsonify({'message': 'User created successfully'})\n\n@app.route('/products', methods=['GET'])\n@jwt_required\ndef get_products():\n    products = Product.query.all()\n    return jsonify([{'id': p.id, 'name': p.name, 'price': p.price} for p in products])\n\n@app.route('/orders', methods=['POST'])\n@jwt_required\ndef create_order():\n    user_id = request.json['user_id']\n    product_id = request.json['product_id']\n    order = Order(user_id=user_id, product_id=product_id)\n    db.session.add(order)\n    db.session.commit()\n    return jsonify({'message': 'Order created successfully'})\n\n@app.errorhandler(404)\ndef not_found(error):\n    return jsonify({'message': 'Not found'}), 404\n\n@app.errorhandler(500)\ndef internal_error(error):\n    return jsonify({'message': 'Internal server error'}), 500\n\nif __name__ == \"__main__\":\n    app.run(debug=True)\n", "timestamp": 1766864869.949552}