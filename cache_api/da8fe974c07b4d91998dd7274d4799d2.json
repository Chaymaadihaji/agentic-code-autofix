{"nom_fichier": "main.py", "code": "# main.py\n\nfrom flask import Flask, render_template, request\nfrom flask_sqlalchemy import SQLAlchemy\nimport json\nfrom datetime import datetime\nfrom werkzeug.security import generate_password_hash\nimport matplotlib.pyplot as plt\nfrom matplotlib.figure import Figure\nfrom matplotlib.backends.backend_agg import FigureCanvasAgg as FigureCanvas\n\napp = Flask(__name__)\napp.config['SQLALCHEMY_DATABASE_URI'] = 'sqlite:///database.db'\ndb = SQLAlchemy(app)\n\nclass Patient(db.Model):\n    id = db.Column(db.Integer, primary_key=True)\n    nom = db.Column(db.String(100), nullable=False)\n    prenom = db.Column(db.String(100), nullable=False)\n    date_naissance = db.Column(db.DateTime, nullable=False)\n    ordonnances = db.relationship('Ordonnance', backref='patient', lazy=True)\n\nclass Ordonnance(db.Model):\n    id = db.Column(db.Integer, primary_key=True)\n    patient_id = db.Column(db.Integer, db.ForeignKey('patient.id'), nullable=False)\n    medicament = db.Column(db.String(100), nullable=False)\n    quantite = db.Column(db.Integer, nullable=False)\n    date = db.Column(db.DateTime, nullable=False, default=datetime.utcnow)\n\nclass RDV(db.Model):\n    id = db.Column(db.Integer, primary_key=True)\n    patient_id = db.Column(db.Integer, db.ForeignKey('patient.id'), nullable=False)\n    date = db.Column(db.DateTime, nullable=False)\n    heure = db.Column(db.String(100), nullable=False)\n\nclass Medicament(db.Model):\n    id = db.Column(db.Integer, primary_key=True)\n    nom = db.Column(db.String(100), nullable=False)\n    description = db.Column(db.String(100), nullable=False)\n\nclass DossierMedicale(db.Model):\n    id = db.Column(db.Integer, primary_key=True)\n    patient_id = db.Column(db.Integer, db.ForeignKey('patient.id'), nullable=False)\n    contenu = db.Column(db.String(1000), nullable=False)\n\n@app.route('/')\ndef index():\n    patients = Patient.query.all()\n    return render_template('index.html', patients=patients)\n\n@app.route('/ajouter_patient', methods=['GET', 'POST'])\ndef ajouter_patient():\n    if request.method == 'POST':\n        patient = Patient(nom=request.form['nom'], prenom=request.form['prenom'], date_naissance=request.form['date_naissance'])\n        db.session.add(patient)\n        db.session.commit()\n    return render_template('ajouter_patient.html')\n\n@app.route('/ordonnances', methods=['GET', 'POST'])\ndef ordonnances():\n    if request.method == 'POST':\n        ordonnance = Ordonnance(patient_id=request.form['patient_id'], medicament=request.form['medicament'], quantite=request.form['quantite'])\n        db.session.add(ordonnance)\n        db.session.commit()\n    patients = Patient.query.all()\n    ordonnances = Ordonnance.query.all()\n    return render_template('ordonnances.html', patients=patients, ordonnances=ordonnances)\n\n@app.route('/rdvs', methods=['GET', 'POST'])\ndef rdvs():\n    if request.method == 'POST':\n        rdv = RDV(patient_id=request.form['patient_id'], date=request.form['date'], heure=request.form['heure'])\n        db.session.add(rdv)\n        db.session.commit()\n    patients = Patient.query.all()\n    rdvs = RDV.query.all()\n    return render_template('rdvs.html', patients=patients, rdvs=rdvs)\n\n@app.route('/medicaments', methods=['GET', 'POST'])\ndef medicaments():\n    if request.method == 'POST':\n        medicament = Medicament(nom=request.form['nom'], description=request.form['description'])\n        db.session.add(medicament)\n        db.session.commit()\n    medicaments = Medicament.query.all()\n    return render_template('medicaments.html', medicaments=medicaments)\n\n@app.route('/dossier_medicale', methods=['GET', 'POST'])\ndef dossier_medicale():\n    if request.method == 'POST':\n        dossier = DossierMedicale(patient_id=request.form['patient_id'], contenu=request.form['contenu'])\n        db.session.add(dossier)\n        db.session.commit()\n    patients = Patient.query.all()\n    dossiers = DossierMedicale.query.all()\n    return render_template('dossier_medicale.html', patients=patients, dossiers=dossiers)\n\n@app.route('/graphiques', methods=['GET', 'POST'])\ndef graphiques():\n    patients = Patient.query.all()\n    ordonnances = Ordonnance.query.all()\n    fig = Figure()\n    ax = fig.add_subplot(111)\n    x = []\n    y = []\n    for patient in patients:\n        patient_id = patient.id\n        for ordonnance in ordonnances:\n            if ordonnance.patient_id == patient_id:\n                x.append(patient_id)\n                y.append(ordonnance.quantite)\n    ax.plot(x, y)\n    canvas = FigureCanvas(fig)\n    return render_template('graphiques.html', x=x, y=y, fig=fig)\n\n@app.route('/rapports', methods=['GET', 'POST'])\ndef rapports():\n    patients = Patient.query.all()\n    ordonnances = Ordonnance.query.all()\n    rapport = \"\"\n    for patient in patients:\n        patient_id = patient.id\n        for ordonnance in ordonnances:\n            if ordonnance.patient_id == patient_id:\n                rapport += f\"Patient {patient_id} : {ordonnance.medicament} ({ordonnance.quantite})\\n\"\n    return render_template('rapports.html', rapport=rapport)\n\nif __name__ == \"__main__\":\n    app.run(debug=True)\n", "timestamp": 1766754881.435463}