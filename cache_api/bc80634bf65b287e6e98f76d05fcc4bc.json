{"nom_fichier": "main.java", "code": "```java\n// fichier: pom.xml\n<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n  xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n  <modelVersion>4.0.0</modelVersion>\n\n  <groupId>com.example</groupId>\n  <artifactId>api</artifactId>\n  <version>0.0.1-SNAPSHOT</version>\n  <packaging>jar</packaging>\n\n  <name>api</name>\n  <description>API avec Spring Boot, Spring Security JWT, PostgreSQL, Swagger et tests unitaires JUnit 5</description>\n\n  <properties>\n    <maven.compiler.source>11</maven.compiler.source>\n    <maven.compiler.target>11</maven.compiler.target>\n  </properties>\n\n  <dependencies>\n    <dependency>\n      <groupId>org.springframework.boot</groupId>\n      <artifactId>spring-boot-starter-web</artifactId>\n    </dependency>\n    <dependency>\n      <groupId>org.springframework.boot</groupId>\n      <artifactId>spring-boot-starter-security</artifactId>\n    </dependency>\n    <dependency>\n      <groupId>org.springframework.boot</groupId>\n      <artifactId>spring-boot-starter-data-jpa</artifactId>\n    </dependency>\n    <dependency>\n      <groupId>org.postgresql</groupId>\n      <artifactId>postgresql</artifactId>\n      <scope>runtime</scope>\n    </dependency>\n    <dependency>\n      <groupId>io.springfox</groupId>\n      <artifactId>springfox-boot-starter</artifactId>\n    </dependency>\n    <dependency>\n      <groupId>io.springfox</groupId>\n      <artifactId>springfox-swagger-ui</artifactId>\n    </dependency>\n    <dependency>\n      <groupId>io.jsonwebtoken</groupId>\n      <artifactId>jjwt</artifactId>\n      <version>0.9.1</version>\n    </dependency>\n    <dependency>\n      <groupId>org.junit.jupiter</groupId>\n      <artifactId>junit-jupiter-api</artifactId>\n      <scope>test</scope>\n    </dependency>\n    <dependency>\n      <groupId>org.junit.jupiter</groupId>\n      <artifactId>junit-jupiter-engine</artifactId>\n      <scope>test</scope>\n    </dependency>\n  </dependencies>\n\n  <build>\n    <plugins>\n      <plugin>\n        <groupId>org.springframework.boot</groupId>\n        <artifactId>spring-boot-maven-plugin</artifactId>\n      </plugin>\n    </plugins>\n  </build>\n</project>\n\n// fichier: application.properties\nspring.datasource.url=jdbc:postgresql://localhost:5432/api\nspring.datasource.username=api\nspring.datasource.password=api\nspring.jpa.hibernate.ddl-auto=update\nspring.jpa.show-sql=true\nspring.jpa.properties.hibernate.format_sql=true\nspring.security.oauth2.resourceserver.jwt.issuer-uri=http://localhost:8080\n\n// fichier: Configuration.java\npackage com.example.api.config;\n\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.security.config.annotation.web.builders.HttpSecurity;\nimport org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;\nimport org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter;\nimport org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;\nimport org.springframework.security.crypto.password.PasswordEncoder;\nimport org.springframework.security.oauth2.config.annotation.web.configuration.EnableResourceServer;\nimport org.springframework.security.oauth2.config.annotation.web.configuration.ResourceServerConfigurerAdapter;\n\n@Configuration\n@EnableWebSecurity\n@EnableResourceServer\npublic class Configuration extends ResourceServerConfigurerAdapter {\n\n  @Override\n  public void configure(HttpSecurity http) throws Exception {\n    http.authorizeRequests()\n      .antMatchers(\"/swagger-ui/**\").permitAll()\n      .antMatchers(\"/v2/api-docs/**\").permitAll()\n      .anyRequest().authenticated();\n  }\n\n  @Bean\n  public PasswordEncoder passwordEncoder() {\n    return new BCryptPasswordEncoder();\n  }\n}\n\n// fichier: TokenService.java\npackage com.example.api.service;\n\nimport io.jsonwebtoken.Claims;\nimport io.jsonwebtoken.JwtBuilder;\nimport io.jsonwebtoken.JwtException;\nimport io.jsonwebtoken.JwtParser;\nimport io.jsonwebtoken.Jwts;\nimport io.jsonwebtoken.SignatureAlgorithm;\nimport java.util.Date;\nimport java.util.Map;\n\npublic class TokenService {\n\n  public static String generateToken(String subject, Map<String, Object> additionalClaims, String secretKey) {\n    Claims claims = Jwts.claims();\n    claims.put(\"sub\", subject);\n    claims.putAll(additionalClaims);\n    Date exp = new Date(System.currentTimeMillis() + 10 * 60 * 1000);\n    return Jwts.builder()\n      .setClaims(claims)\n      .setExpiration(exp)\n      .signWith(SignatureAlgorithm.HS256, secretKey)\n      .compact();\n  }\n\n  public static String verifyToken(String token, String secretKey) {\n    try {\n      JwtParser parser = Jwts.parser().setSigningKey(secretKey);\n      return parser.parseClaimsJws(token).getBody().getSubject();\n    } catch (JwtException e) {\n      return null;\n    }\n  }\n}\n\n// fichier: JwtAuthFilter.java\npackage com.example.api.filter;\n\nimport io.jsonwebtoken.Claims;\nimport io.jsonwebtoken.ExpiredJwtException;\nimport io.jsonwebtoken.JwtException;\nimport io.jsonwebtoken.Jwts;\nimport java.io.IOException;\nimport java.util.HashMap;\nimport java.util.Map;\nimport javax.servlet.Filter;\nimport javax.servlet.FilterChain;\nimport javax.servlet.FilterConfig;\nimport javax.servlet.ServletException;\nimport javax.servlet.ServletRequest;\nimport javax.servlet.ServletResponse;\nimport javax.servlet.http.HttpServletRequest;\nimport javax.servlet.http.HttpServletResponse;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.http.HttpMethod;\nimport org.springframework.security.authentication.AuthenticationManager;\nimport org.springframework.security.authentication.UsernamePasswordAuthenticationToken;\nimport org.springframework.security.core.Authentication;\nimport org.springframework.security.core.context.SecurityContextHolder;\nimport org.springframework.security.core.userdetails.UserDetails;\nimport org.springframework.security.web.AuthenticationEntryPoint;\nimport org.springframework.security.web.authentication.UsernamePasswordAuthenticationFilter;\nimport org.springframework.security.web.util.matcher.RequestMatcher;\n\npublic class JwtAuthFilter extends UsernamePasswordAuthenticationFilter {\n\n  private static final String BEARER_PREFIX = \"Bearer \";\n  private static final String AUTHENTICATION_HEADER = \"Authorization\";\n\n  private final AuthenticationManager authenticationManager;\n\n  public JwtAuthFilter(AuthenticationManager authenticationManager, String secretKey) {\n    this.authenticationManager = authenticationManager;\n  }\n\n  @Override\n  public Authentication attemptAuthentication(HttpServletRequest request, HttpServletResponse response)\n    throws AuthenticationException {\n    String token = request.getHeader(AUTHENTICATION_HEADER);\n    if (token == null || !token.startsWith(BEARER_PREFIX)) {\n      response.setStatus(HttpServletResponse.SC_UNAUTHORIZED);\n      return null;\n    }\n    String jwt = token.substring(BEARER_PREFIX.length());\n    try {\n      Claims claims = Jwts.parser().setSigningKey(\"secretKey\").parseClaimsJws(jwt).getBody();\n      String username = claims.get(\"sub\").toString();\n      UserDetails userDetails = new User(username, \"\", getAuthorities());\n      Authentication authentication = new UsernamePasswordAuthenticationToken(userDetails, null, userDetails.getAuthorities());\n      SecurityContextHolder.getContext().setAuthentication(authentication);\n      return authentication;\n    } catch (ExpiredJwtException | JwtException e) {\n      response.setStatus(HttpServletResponse.SC_UNAUTHORIZED);\n      return null;\n    }\n  }\n\n  private Set<GrantedAuthority> getAuthorities() {\n    Set<GrantedAuthority> authorities = new HashSet<>();\n    authorities.add(new SimpleGrantedAuthority(\"USER\"));\n    return authorities;\n  }\n\n  @Override\n  protected void successfulAuthentication(HttpServletRequest request, HttpServletResponse response,\n    Authentication authResult) throws IOException, ServletException {\n    super.successfulAuthentication(request, response, authResult);\n  }\n\n  @Override\n  protected void unsuccessfulAuthentication(HttpServletRequest request, HttpServletResponse response,\n    AuthenticationException failed) throws IOException, ServletException {\n    response.setStatus(HttpServletResponse.SC_UNAUTHORIZED);\n  }\n\n  public static boolean isAdmin(String token) {\n    Claims claims = Jwts.parser().setSigningKey(\"secretKey\").parseClaimsJws(token).getBody();\n    Set<GrantedAuthority> authorities = (Set<GrantedAuthority>) claims.get(\"authorities\");\n    return authorities.contains(new SimpleGrantedAuthority(\"ADMIN\"));\n  }\n}\n\n// fichier: User.java\npackage com.example.api.entity;\n\nimport javax.persistence.Entity;\nimport javax.persistence.GeneratedValue;\nimport javax.persistence.GenerationType;\nimport javax.persistence.Id;\n\n@Entity\npublic class User {\n\n  @Id\n  @GeneratedValue(strategy = GenerationType.IDENTITY)\n  private Long id;\n\n  private String username;\n\n  private String password;\n\n  private String authorities;\n\n  // getters et setters\n}\n\n// fichier: UserDAO.java\npackage com.example.api.dao;\n\nimport com.example.api.entity.User;\nimport org.springframework.data.jpa.repository.JpaRepository;\nimport org.springframework.stereotype.Repository;\n\n@Repository\npublic interface UserDAO extends JpaRepository<User, Long> {\n\n}\n\n// fichier: UserRepository.java\npackage com.example.api.repo;\n\nimport com.example.api.entity.User;\nimport org.springframework.data.jpa.repository.JpaRepository;\nimport org.springframework.stereotype.Repository;\n\n@Repository\npublic interface UserRepository extends JpaRepository<User, Long> {\n\n}\n\n// fichier: UserService.java\npackage com.example.api.service;\n\nimport com.example.api.entity.User;\nimport com.example.api.dao.UserDAO;\nimport com.example.api.repo.UserRepository;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.stereotype.Service;\n\n@Service\npublic class UserService {\n\n  @Autowired\n  private UserRepository userRepository;\n\n  public User getUser(Long id) {\n    return userRepository.findById(id).orElse(null);\n", "langage": "java", "bugs_introduits": ["syntax_error", "undefined_variable"], "corrections_appliquees": [], "timestamp": 1767105663.2012172, "tentative": 2}