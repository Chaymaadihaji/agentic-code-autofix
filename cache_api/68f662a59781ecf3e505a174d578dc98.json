{"nom_fichier": "internal/models/models.go", "code": "```go\n// Package models contient les modèles utilisés par l'application\npackage models\n\nimport (\n\t\"context\"\n\t\"database/sql\"\n\t\"fmt\"\n\t\"log\"\n\t\"strings\"\n\t\"time\"\n\n\t\"github.com/google/uuid\"\n\t\"github.com/lib/pq\"\n\t\"github.com/graphql-go/graphql\"\n\t\"github.com/graphql-go/graphql/gqlerrors\"\n\t\"github.com/graphql-go/graphql/gqlschema\"\n\t\"github.com/graphql-go/graphql/language/ast\"\n\t\"github.com/graphql-go/graphql/language/parser/astnode\"\n\t\"github.com/graphql-go/graphql/language/printer\"\n\t\"github.com/graphql-go/graphql/validation\"\n\t\"github.com/graphql-go/graphql/lang\"\n\t\"github.com/lib/pq/hstore\"\n\t\"github.com/spf13/viper\"\n\t\"golang.org/x/exp/slog\"\n\n\t\"github.com/graphql-go/graphql-go/pkg/db\"\n\t\"github.com/graphql-go/graphql-go/pkg/jwt\"\n\t\"github.com/graphql-go/graphql-go/pkg/schemas\"\n\t\"github.com/graphql-go/graphql-go/pkg/subs\"\n\t\"github.com/graphql-go/graphql-go/pkg/utils\"\n)\n\n// Database est la connexion à la base de données\ntype Database struct {\n\tConn *sql.DB\n}\n\n// NewDatabase crée une nouvelle instance de Database\nfunc NewDatabase() (*Database, error) {\n\t// Connexion à la base de données PostgreSQL\n\tpsqlInfo := viper.GetString(\"DATABASE_URL\")\n\tconn, err := sql.Open(\"postgres\", psqlInfo)\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\treturn &Database{Conn: conn}, nil\n}\n\n// Migrate mets à jour la base de données\nfunc (db *Database) Migrate() error {\n\t// Mise à jour de la base de données\n\tmigrations := []string{\n\t\t\"CREATE TABLE users (id uuid NOT NULL, email varchar(255) NOT NULL, username varchar(255) NOT NULL, password varchar(255) NOT NULL, created_at timestamp NOT NULL DEFAULT (now()), updated_at timestamp NOT NULL DEFAULT (now()));\",\n\t}\n\tfor _, migration := range migrations {\n\t\t_, err := db.Conn.Exec(migration)\n\t\tif err != nil {\n\t\t\treturn err\n\t\t}\n\t}\n\treturn nil\n}\n\n// Models est un conteneur pour les modèles\ntype Models struct {\n\tDatabases []Database\n}\n\n// NewModels crée une nouvelle instance de Models\nfunc NewModels() (*Models, error) {\n\tdb, err := NewDatabase()\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\treturn &Models{Databases: []Database{*db}}, nil\n}\n\n// GraphQLSchema définit la structure de la GraphQL Schema\nvar GraphQLSchema = graphql.NewSchema(\n\tgraphql.NewObject(graphql.ObjectConfig{\n\t\tName: \"Query\",\n\t\tFields: graphql.FieldConfigMap{\n\t\t\t\"users\": &graphql.Field{\n\t\t\t\tType:        graphql.NewList(userType),\n\t\t\t\tDescription: \"Rétrouve la liste des utilisateurs\",\n\t\t\t\tResolver:    getUserResolver(),\n\t\t\t},\n\t\t\t\"user\": &graphql.Field{\n\t\t\t\tType:        userType,\n\t\t\t\tDescription: \"Rétrouve un utilisateur spécifique\",\n\t\t\t\tArgs: graphql.FieldConfigMap{\n\t\t\t\t\t\"id\": &graphql.ArgumentConfig{\n\t\t\t\t\t\tType: graphql.String,\n\t\t\t\t\t\tNullable: true,\n\t\t\t\t\t\tDescription: \"ID de l'utilisateur\",\n\t\t\t\t\t},\n\t\t\t\t\t\"email\": &graphql_argument{\n\t\t\t\t\t\tType: graphql.String,\n\t\t\t\t\t\tNullable:  true,\n\t\t\t\t\t\tDescription:  \"Courriel de l'utilisateur\",\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tResolver: getUserResolver(),\n\t\t\t},\n\t\t},\n\t}),\n\tgraphql.NewObject(graphql.ObjectConfig{\n\t\tName: \"Mutation\",\n\t\tFields: graphql.FieldConfigMap{\n\t\t\t\".createUser\": &graphql.Field{\n\t\t\t\tType:        userType,\n\t\t\t\tDescription: \"Crée de nouveau utilisateur\",\n\t\t\t\tArgs: graphql.FieldConfigMap{\n\t\t\t\t\t'email': &graphql_argument{\n\t\t\t\t\t\tType: graphql.String,\n\t\t\t\t\t\tNullable:  false,\n\t\t\t\t\t\tDescription:  \"Courriel du nouvel utilisateur\",\n\t\t\t\t\t},\n\t\t\t\t\t'username': &graphql_argument{\n\t\t\t\t\t\tType: graphql.String,\n\t\t\t\t\t\tNullable:  false,\n\t\t\t\t\t\tDescription:  \"Nom d'utilisateur du nouvel utilisateur\",\n\t\t\t\t\t},\n\t\t\t\t\t'password': &graphql_argument{\n\t\t\t\t\t\tType: graphql.String,\n\t\t\t\t\t\tNullable:  false,\n\t\t\t\t\t\tDescription: \"Mot de passe de l'utilisateur\",\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tResolver: postUserResolver,\n\t\t\t},\n\t\t\t\"updateUser\": &graphql.Field{\n\t\t\t\tType:        userType,\n\t\t\t\tDescription: \"Mets à jour un utilisateur\",\n\t\t\t\tArgs: graphql.FieldConfigMap{\n\t\t\t\t\t'id': &graphql_argument{\n\t\t\t\t\t\tType: graphql.String,\n\t\t\t\t\t\tNullable: true,\n\t\t\t\t\t\tDescription: \"ID de l'utilisateur\",\n\t\t\t\t\t},\n\t\t\t\t\t'email': &graphql_argument{\n\t\t\t\t\t\tType: graphql.String,\n\t\t\t\t\t\tNullable:  false,\n\t\t\t\t\t\tDescription:  \"Courriel de l'utilisateur\",\n\t\t\t\t\t},\n\t\t\t\t\t'username': &graphql_argument{\n\t\t\t\t\t\tType: graphql.String,\n\t\t\t\t\t\tNullable:  false,\n\t\t\t\t\t\tDescription:  \"Nom d'utilisateur de l'utilisateur\",\n\t\t\t\t\t},\n\t\t\t\t\t'password': &graphql_argument{\n\t\t\t\t\t\tType: graphql.String,\n\t\t\t\t\t\tNullable:  false,\n\t\t\t\t\t\tDescription: \"Mot de passe de l'utilisateur\",\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tResolver: postUserResolver,\n\t\t\t},\n\t\t\t'deleteUser': &graphql.Field{\n\t\t\t\tType:        userType,\n\t\t\t\tDescription: \"Suppression d'un utilisateur\",\n\t\t\t\tArgs: graphql.FieldConfigMap{\n\t\t\t\t\t'id':&graphql_argument{\n\t\t\t\t\t\tType: graphql.String,\n\t\t\t\t\t\tNullable:  false,\n\t\t\t\t\t\tDescription:  \"ID de l'utilisateur\",\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tResolver: deleteUserResolver,\n\t\t\t},\n\t\t},\n\t}),\n\tgraphql.NewObject(graphql.ObjectConfig{\n\t\tName: \"Subscription\",\n\t\tFields: graphql.FieldConfigMap{\n\t\t\t\"createUser\": &graphql.Field{\n\t\t\t\tType:        userType,\n\t\t\t\tDescription: \"Crée un nouvel utilisateur\",\n\t\t\t\tArgs: graphql.FieldConfigMap{\n\t\t\t\t\t'email': &graphql_argument{\n\t\t\t\t\t\tType: graphql.String,\n\t\t\t\t\t\tNullable:  false,\n\t\t\t\t\t\tDescription:  \"Courriel de l'utilisateur nouveau\",\n\t\t\t\t\t},\n\t\t\t\t\t'username': &graphql_argument{\n\t\t\t\t\t\tType: graphql.String,\n\t\t\t\t\t\tNullable:  false,\n\t\t\t\t\t\tDescription:  \"Nom d'utilisateur du nouvel utilisateur\",\n\t\t\t\t\t},\n\t\t\t\t\t'password': &graphql_argument{\n\t\t\t\t\t\tType: graphql.String,\n\t\t\t\t\t\tNullable:  false,\n\t\t\t\t\t\tDescription: \"Mot de passe de l'utilisateur \",\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tResolver: postUserResolver,\n\t\t\t},\n\t\t\t\"updateUser\": &graphql.Field{\n\t\t\t\tType:        userType,\n\t\t\t\tDescription: \"Modification de l'utilisateur \",\n\t\t\t\tArgs: graphql.FieldConfigMap{\n\t\t\t\t\t\"id\": &graphql_argument{\n\t\t\t\t\t\tType: graphql.String,\n\t\t\t\t\t\tNullable: true,\n\t\t\t\t\t\tDescription: \"ID de l'utilisateur\",\n\t\t\t\t\t},\n\t\t\t\t\t\"email\": &graphql_argument{\n\t\t\t\t\t\tType: graphql.String,\n\t\t\t\t\t\tNullable: false,\n\t\t\t\t\t\tDescription: \"Courriel de l'utilisateur\",\n\t\t\t\t\t},\n\t\t\t\t\t\"username\": &graphql_argument{\n\t\t\t\t\t\tType: graphql.String,\n\t\t\t\t\t\tNullable: false,\n\t\t\t\t\t\tDescription: \"Nom d'utilisateur de l'utilisateur\",\n\t\t\t\t\t},\n\t\t\t\t\t\"password\": &graphql_argument{\n\t\t\t\t\t\tType:       graphql.String,\n\t\t\t\t\t\tNullable:   false,\n\t\t\t\t\t\tDescription: \"Mot de passe de l'utilisateur\",\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tResolver: postUserResolver,\n\t\t\t},\n\t\t\t\"deleteUser\": &graphql.Field{\n\t\t\t\tType:        userType,\n\t\t\t\tDescription: \"Suppression de l'utilisateur\",\n\t\t\t\tArgs: graphql.FieldConfigMap{\n\t\t\t\t\t\"id\": &graphql_argument{\n\t\t\t\t\t\tType: graphql.String,\n\t\t\t\t\t\tNullable:  false,\n\t\t\t\t\t\tDescription: \"ID de l'utilisateur\",\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tResolver: deleteUserResolver,\n\t\t\t},\n\t\t},\n\t})\n)\n\nfunc getUserResolver() graphql.Resolver {\n\treturn/graphql.Resolver(func(p graphql.ResolveParams) (interface{}, error) {\n\t\tid, ok := p.Args[\"id\"]\n\t\temail , ok := p.Args[\"email\"]\n\t\tisEmail := \"NULL\" != fmt.Sprintf(\"%v\",email)\n\t\tif isEmail && !ok ||  !ok{\n\t\t\treturn nil, fmt.Errorf(\"missing ID and/ou email for the User\")\n\t\t}\n\n\t\tif _, isEmail := id.(uuid.UUID); !isEmail {\n\t\t\treturn nil, gqlerrors.ValidationError(errors.New(\"invalid ID\"))\n\t\t}\n\n\t\tdb, err := db.Get()\n\t\tif err != nil {\n\t\t\treturn nil, err\n\t\t}\n\t\trows, err := db.Query(\"SELECT id, email, username FROM users WHERE (email = $2 OR id = $1)\", id,(email))\n\t\tif err != nil {\n\t\t\treturn nil, err\n\t\t}\n\t\tdefer rows.Close()\n\n\t\tvar users []map[string]string\n\t\tfor rows.Next() {\n\t\t\tuser := map[string]string{}\n\t\t\terr := rows.Scan(&user[\"id\"], &user[\"email\"], &user[\"username\"])\n\t\t\tif err != nil {\n\t\t\t\treturn nil, err\n\t\t\t}\n\t\t\tusers = append(users, user)\n\t\t}\n\n\t\treturn users, nil\n\t})\n}\nfunc postUserResolver(p graphql.ResolveParams) (interface{}, error) {\n\temail,_ := p.Args[\"email\"]\n\tusername,_ := p.Args[\"username\"]\n\tpassword,_ := p.Args[\"password\"]\n\tid,_:=p.Args[\"id\"]\n\n\tu:=User{ID:uuid.New(),Email:email,Username:username, HashedPassword: password}\n\terr := u.NewUser()\n\tif\n", "bugs_introduits": [], "timestamp": 1767006974.0024323}