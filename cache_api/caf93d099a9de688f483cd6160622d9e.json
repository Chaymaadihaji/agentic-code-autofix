{"nom_fichier": "data_processor.py", "code": "# data_processor.py\n\nimport json\nimport os\nimport random\nfrom datetime import datetime, timedelta\nfrom flask import Flask, render_template, jsonify\nfrom flask_sqlalchemy import SQLAlchemy\n\napp = Flask(__name__)\napp.config['SQLALCHEMY_DATABASE_URI'] = 'sqlite:///database.db'\ndb = SQLAlchemy(app)\n\nclass Patient(db.Model):\n    id = db.Column(db.Integer, primary_key=True)\n    nom = db.Column(db.String(100), nullable=False)\n    prenom = db.Column(db.String(100), nullable=False)\n    date_naissance = db.Column(db.Date, nullable=False)\n    adresse = db.Column(db.String(200), nullable=False)\n    telephone = db.Column(db.String(20), nullable=False)\n    historique_medical = db.relationship('HistoriqueMedical', backref='patient', lazy=True)\n\nclass HistoriqueMedical(db.Model):\n    id = db.Column(db.Integer, primary_key=True)\n    patient_id = db.Column(db.Integer, db.ForeignKey('patient.id'), nullable=False)\n    date = db.Column(db.Date, nullable=False)\n    description = db.Column(db.String(200), nullable=False)\n    ordonnance_numerique = db.Column(db.String(100), nullable=False)\n\nclass OrdonnanceNumerique(db.Model):\n    id = db.Column(db.Integer, primary_key=True)\n    patient_id = db.Column(db.Integer, db.ForeignKey('patient.id'), nullable=False)\n    date = db.Column(db.Date, nullable=False)\n    medicament = db.Column(db.String(100), nullable=False)\n    quantite = db.Column(db.Integer, nullable=False)\n\nclass RendezVous(db.Model):\n    id = db.Column(db.Integer, primary_key=True)\n    patient_id = db.Column(db.Integer, db.ForeignKey('patient.id'), nullable=False)\n    date = db.Column(db.Date, nullable=False)\n    heure = db.Column(db.Time, nullable=False)\n\nclass Medecin(db.Model):\n    id = db.Column(db.Integer, primary_key=True)\n    nom = db.Column(db.String(100), nullable=False)\n    prenom = db.Column(db.String(100), nullable=False)\n    telephone = db.Column(db.String(20), nullable=False)\n\nclass DossierMedicalPartage(db.Model):\n    id = db.Column(db.Integer, primary_key=True)\n    patient_id = db.Column(db.Integer, db.ForeignKey('patient.id'), nullable=False)\n    medecin_id = db.Column(db.Integer, db.ForeignKey('medecin.id'), nullable=False)\n    date = db.Column(db.Date, nullable=False)\n\nclass GraphiqueSuiviSante(db.Model):\n    id = db.Column(db.Integer, primary_key=True)\n    patient_id = db.Column(db.Integer, db.ForeignKey('patient.id'), nullable=False)\n    date = db.Column(db.Date, nullable=False)\n    valeur = db.Column(db.Float, nullable=False)\n\nclass RapportPourMedecin(db.Model):\n    id = db.Column(db.Integer, primary_key=True)\n    patient_id = db.Column(db.Integer, db.ForeignKey('patient.id'), nullable=False)\n    medecin_id = db.Column(db.Integer, db.ForeignKey('medecin.id'), nullable=False)\n    date = db.Column(db.Date, nullable=False)\n\n@app.route('/')\ndef index():\n    patients = Patient.query.all()\n    return render_template('index.html', patients=patients)\n\n@app.route('/patient/<int:patient_id>')\ndef patient(patient_id):\n    patient = Patient.query.get(patient_id)\n    if patient:\n        return render_template('patient.html', patient=patient)\n    return jsonify({'error': 'Patient not found'})\n\n@app.route('/ordonnance/<int:patient_id>')\ndef ordonnance(patient_id):\n    ordonnances = OrdonnanceNumerique.query.filter_by(patient_id=patient_id).all()\n    return jsonify([o.to_dict() for o in ordonnances])\n\n@app.route('/rendez-vous/<int:patient_id>')\ndef rendez_vous(patient_id):\n    rendez_vous = RendezVous.query.filter_by(patient_id=patient_id).all()\n    return jsonify([rv.to_dict() for rv in rendez_vous])\n\n@app.route('/medecin/<int:medecin_id>')\ndef medecin(medecin_id):\n    medecin = Medecin.query.get(medecin_id)\n    if medecin:\n        return render_template('medecin.html', medecin=medecin)\n    return jsonify({'error': 'Médecin not found'})\n\n@app.route('/dossier-medical/<int:patient_id>')\ndef dossier_medical(patient_id):\n    dossier_medical = DossierMedicalPartage.query.filter_by(patient_id=patient_id).all()\n    return jsonify([dm.to_dict() for dm in dossier_medical])\n\n@app.route('/graphique/<int:patient_id>')\ndef graphique(patient_id):\n    graphique = GraphiqueSuiviSante.query.filter_by(patient_id=patient_id).all()\n    return jsonify([g.to_dict() for g in graphique])\n\n@app.route('/rapport/<int:patient_id>')\ndef rapport(patient_id):\n    rapport = RapportPourMedecin.query.filter_by(patient_id=patient_id).all()\n    return jsonify([r.to_dict() for r in rapport])\n\nif __name__ == \"__main__\":\n    db.create_all()\n    with open('data.json', 'w') as f:\n        json.dump({\n            'patients': [\n                {'id': 1, 'nom': 'Dupont', 'prenom': 'Jean', 'date_naissance': '1990-01-01', 'adresse': 'Rue de la République', 'telephone': '0123456789'},\n                {'id': 2, 'nom': 'Martin', 'prenom': 'Pierre', 'date_naissance': '1995-02-02', 'adresse': 'Rue de la Liberté', 'telephone': '0987654321'}\n            ],\n            'historique_medical': [\n                {'id': 1, 'patient_id': 1, 'date': '2022-01-01', 'description': 'Consultation initiale', 'ordonnance_numerique': '10mg'},\n                {'id': 2, 'patient_id': 1, 'date': '2022-02-02', 'description': 'Consultation de suivi', 'ordonnance_numerique': '20mg'}\n            ],\n            'ordonnance_numerique': [\n                {'id': 1, 'patient_id': 1, 'date': '2022-01-01', 'medicament': 'Paracetamol', 'quantite': 10},\n                {'id': 2, 'patient_id': 1, 'date': '2022-02-02', 'medicament': 'Ibuprofène', 'quantite': 20}\n            ],\n            'rendez-vous': [\n                {'id': 1, 'patient_id': 1, 'date': '2022-01-01', 'heure': '10:00'},\n                {'id': 2, 'patient_id': 1, 'date': '2022-02-02', 'heure': '14:00'}\n            ],\n            'medecin': [\n                {'id': 1, 'nom': 'Smith', 'prenom': 'John', 'telephone': '0123456789'},\n                {'id': 2, 'nom': 'Johnson', 'prenom': 'Jane', 'telephone': '0987654321'}\n            ],\n            'dossier_medical': [\n                {'id': 1, 'patient_id': 1, 'medecin_id': 1, 'date': '2022-01-01'},\n                {'id': 2, 'patient_id': 1, 'medecin_id': 2, 'date': '2022-02-02'}\n            ],\n            'graphique': [\n                {'id': 1, 'patient_id': 1, 'date': '2022-01-01', 'valeur': 10.5},\n                {'id': 2, 'patient_id': 1, 'date': '2022-02-02', 'valeur': 20.8}\n            ],\n            'rapport': [\n                {'id': 1, 'patient_id': 1, 'medecin_id': 1, 'date': '2022-01-01'},\n                {'id': 2, 'patient_id': 1, 'medecin_id': 2, 'date': '2022-02-02'}\n            ]\n        }, f)\n    app.run(debug=True)\n\nclass Patient:\n    def to_dict(self):\n        return {'id': self.id, 'nom': self.nom, 'prenom': self.prenom, 'date_naissance': self.date_naissance, 'adresse': self.adresse, 'telephone': self.telephone}\n\nclass HistoriqueMedical:\n    def to_dict(self):\n        return {'id': self.id, 'patient_id': self.patient_id, 'date': self.date, 'description': self.description, 'ordonnance_numerique': self.ordonnance_numerique}\n\nclass OrdonnanceNumerique:\n    def to_dict(self):\n        return {'id': self.id, 'patient_id': self.patient_id, 'date': self.date, 'medicament': self.medicament, 'quantite': self.quantite}\n\nclass RendezVous:\n    def to_dict(self):\n        return {'id': self.id, 'patient_id': self.patient_id, 'date': self.date, 'heure': self.heure}\n\nclass Medecin:\n    def to_dict(self):\n        return {'id': self.id, 'nom': self.nom, 'prenom': self.prenom, 'telephone': self.telephone}\n\nclass DossierMedicalPartage:\n    def to_dict(self):\n        return {'id': self.id, 'patient_id': self.patient_id, 'medecin_id': self.medecin_id, 'date': self.date}\n\nclass GraphiqueSuiviSante:\n    def to_dict(self):\n        return {'id': self.id, 'patient_id': self.patient_id, 'date': self.date, 'valeur': self.valeur}\n\nclass RapportPourMedecin:\n    def to_dict(self):\n        return {'id': self.id, 'patient_id': self.patient_id, 'medecin_id': self.medecin_id, 'date': self.date}\n", "timestamp": 1766754942.3852406}