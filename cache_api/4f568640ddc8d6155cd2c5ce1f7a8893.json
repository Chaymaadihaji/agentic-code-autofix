{"nom_fichier": "main.py", "code": "# main.py\n\nimport os\nfrom flask import Flask, render_template, request, jsonify\nfrom flask_sqlalchemy import SQLAlchemy\nfrom flask_marshmallow import Marshmallow\nfrom flask_bcrypt import Bcrypt\nfrom flask_cors import CORS\nfrom flask_login import LoginManager\nfrom werkzeug.security import generate_password_hash\nimport uuid\nfrom datetime import datetime\n\n# Configuration\napp = Flask(__name__)\napp.config['SQLALCHEMY_DATABASE_URI'] = 'sqlite:///database.db'\napp.config['SQLALCHEMY_TRACK_MODIFICATIONS'] = False\napp.config['SECRET_KEY'] = 'secret_key'\n\n# Initialisation des extensions\ndb = SQLAlchemy(app)\nma = Marshmallow(app)\nbcrypt = Bcrypt(app)\nlogin_manager = LoginManager(app)\nlogin_manager.login_view = 'login'\nCORS(app)\n\n# Modèle de patient\nclass Patient(db.Model):\n    id = db.Column(db.Integer, primary_key=True)\n    nom = db.Column(db.String(100), nullable=False)\n    prenom = db.Column(db.String(100), nullable=False)\n    date_naissance = db.Column(db.Date, nullable=False)\n    telephone = db.Column(db.String(20), nullable=False)\n    adresse = db.Column(db.String(200), nullable=False)\n\n# Modèle de rendez-vous\nclass RendezVous(db.Model):\n    id = db.Column(db.Integer, primary_key=True)\n    patient_id = db.Column(db.Integer, db.ForeignKey('patient.id'), nullable=False)\n    date = db.Column(db.DateTime, nullable=False)\n    heure = db.Column(db.Time, nullable=False)\n    motif = db.Column(db.String(200), nullable=False)\n\n# Modèle de médicament\nclass Medicament(db.Model):\n    id = db.Column(db.Integer, primary_key=True)\n    nom = db.Column(db.String(100), nullable=False)\n    posologie = db.Column(db.String(200), nullable=False)\n    debut_traitement = db.Column(db.DateTime, nullable=False)\n    fin_traitement = db.Column(db.DateTime, nullable=False)\n\n# Modèle de rapport\nclass Rapport(db.Model):\n    id = db.Column(db.Integer, primary_key=True)\n    patient_id = db.Column(db.Integer, db.ForeignKey('patient.id'), nullable=False)\n    date = db.Column(db.DateTime, nullable=False)\n    contenu = db.Column(db.String(500), nullable=False)\n\n# Modèle d'utilisateur\nclass Utilisateur(db.Model):\n    id = db.Column(db.Integer, primary_key=True)\n    username = db.Column(db.String(100), nullable=False, unique=True)\n    password = db.Column(db.String(200), nullable=False)\n    email = db.Column(db.String(100), nullable=False, unique=True)\n\n# Schemas\nclass PatientSchema(ma.Schema):\n    class Meta:\n        fields = ('id', 'nom', 'prenom', 'date_naissance', 'telephone', 'adresse')\n\nclass RendezVousSchema(ma.Schema):\n    class Meta:\n        fields = ('id', 'patient_id', 'date', 'heure', 'motif')\n\nclass MedicamentSchema(ma.Schema):\n    class Meta:\n        fields = ('id', 'nom', 'posologie', 'debut_traitement', 'fin_traitement')\n\nclass RapportSchema(ma.Schema):\n    class Meta:\n        fields = ('id', 'patient_id', 'date', 'contenu')\n\nclass UtilisateurSchema(ma.Schema):\n    class Meta:\n        fields = ('id', 'username', 'password', 'email')\n\n# Initialisation des schemas\npatient_schema = PatientSchema()\npatients_schema = PatientSchema(many=True)\nrendez_vous_schema = RendezVousSchema()\nrendez_vous_schema = RendezVousSchema(many=True)\nmedicament_schema = MedicamentSchema()\nmedicaments_schema = MedicamentSchema(many=True)\nrapport_schema = RapportSchema()\nrapports_schema = RapportSchema(many=True)\nutilisateur_schema = UtilisateurSchema()\nutilisateurs_schema = UtilisateurSchema(many=True)\n\n# Route pour les fiches patients\n@app.route('/patients', methods=['GET'])\ndef get_patients():\n    patients = Patient.query.all()\n    return jsonify(patients_schema.dump(patients))\n\n# Route pour les rendez-vous\n@app.route('/rendez-vous', methods=['GET'])\ndef get_rendez_vous():\n    rendez_vous = RendezVous.query.all()\n    return jsonify(rendez_vous_schema.dump(rendez_vous))\n\n# Route pour les médicaments\n@app.route('/medicaments', methods=['GET'])\ndef get_medicaments():\n    medicaments = Medicament.query.all()\n    return jsonify(medocaments_schema.dump(medicaments))\n\n# Route pour les rapports\n@app.route('/rapports', methods=['GET'])\ndef get_rapports():\n    rapports = Rapport.query.all()\n    return jsonify(rapports_schema.dump(rapports))\n\n# Route pour les utilisateurs\n@app.route('/utilisateurs', methods=['GET'])\ndef get_utilisateurs():\n    utilisateurs = Utilisateur.query.all()\n    return jsonify(utilisateurs_schema.dump(utilisateurs))\n\n# Route pour la création d'un patient\n@app.route('/patients', methods=['POST'])\ndef create_patient():\n    patient = Patient(nom=request.json['nom'], prenom=request.json['prenom'], date_naissance=request.json['date_naissance'], telephone=request.json['telephone'], adresse=request.json['adresse'])\n    db.session.add(patient)\n    db.session.commit()\n    return patient_schema.jsonify(patient)\n\n# Route pour la création d'un rendez-vous\n@app.route('/rendez-vous', methods=['POST'])\ndef create_rendez_vous():\n    rendez_vous = RendezVous(patient_id=request.json['patient_id'], date=request.json['date'], heure=request.json['heure'], motif=request.json['motif'])\n    db.session.add(rendez_vous)\n    db.session.commit()\n    return rendez_vous_schema.jsonify(rendez_vous)\n\n# Route pour la création d'un médicament\n@app.route('/medicaments', methods=['POST'])\ndef create_medicament():\n    medicament = Medicament(nom=request.json['nom'], posologie=request.json['posologie'], debut_traitement=request.json['debut_traitement'], fin_traitement=request.json['fin_traitement'])\n    db.session.add(medicament)\n    db.session.commit()\n    return medicament_schema.jsonify(medicament)\n\n# Route pour la création d'un rapport\n@app.route('/rapports', methods=['POST'])\ndef create_rapport():\n    rapport = Rapport(patient_id=request.json['patient_id'], date=request.json['date'], contenu=request.json['contenu'])\n    db.session.add(rapport)\n    db.session.commit()\n    return rapport_schema.jsonify(rapport)\n\n# Route pour la création d'un utilisateur\n@app.route('/utilisateurs', methods=['POST'])\ndef create_utilisateur():\n    utilisateur = Utilisateur(username=request.json['username'], password=request.json['password'], email=request.json['email'])\n    db.session.add(utilisateur)\n    db.session.commit()\n    return utilisateur_schema.jsonify(utilisateur)\n\n# Route pour la connexion d'un utilisateur\n@app.route('/login', methods=['POST'])\ndef login():\n    utilisateur = Utilisateur.query.filter_by(username=request.json['username']).first()\n    if utilisateur and bcrypt.check_password_hash(utilisateur.password, request.json['password']):\n        return utilisateur_schema.jsonify(utilisateur)\n    return jsonify({'erreur': 'Mauvais identifiant ou mot de passe'}), 401\n\n# Route pour la création de rendez-vous\n@app.route('/rendez-vous', methods=['PUT'])\ndef update_rendez_vous():\n    rendez_vous = RendezVous.query.get(request.json['id'])\n    rendez_vous.patient_id = request.json['patient_id']\n    rendez_vous.date = request.json['date']\n    rendez_vous.heure = request.json['heure']\n    rendez_vous.motif = request.json['motif']\n    db.session.commit()\n    return rendez_vous_schema.jsonify(rendez_vous)\n\n# Route pour la suppression d'un rendez-vous\n@app.route('/rendez-vous', methods=['DELETE'])\ndef delete_rendez_vous():\n    rendez_vous = RendezVous.query.get(request.json['id'])\n    db.session.delete(rendez_vous)\n    db.session.commit()\n    return jsonify({'message': 'Rendez-vous supprimé avec succès'})\n\n# Initialisation de l'application\n@app.route('/')\ndef index():\n    return render_template('index.html')\n\n# Initialisation de l'application\nif __name__ == \"__main__\":\n    db.create_all()\n    app.run(debug=True)\n", "timestamp": 1766765493.2443106}