{"nom_fichier": "main.py", "code": "import os\nfrom flask import Flask, render_template, request, jsonify\nfrom flask_sqlalchemy import SQLAlchemy\n\napp = Flask(__name__)\napp.config[\"SQLALCHEMY_DATABASE_URI\"] = \"sqlite:///taches.db\"\ndb = SQLAlchemy(app)\n\nclass Tache(db.Model):\n    id = db.Column(db.Integer, primary_key=True)\n    titre = db.Column(db.String(100), nullable=False)\n    description = db.Column(db.Text, nullable=False)\n    cree_le = db.Column(db.DateTime, nullable=False, default=db.func.current_timestamp())\n    modifie_le = db.Column(db.DateTime, nullable=False, default=db.func.current_timestamp(), onupdate=db.func.current_timestamp())\n\nclass Statistique(db.Model):\n    id = db.Column(db.Integer, primary_key=True)\n    nombre_taches = db.Column(db.Integer, nullable=False)\n    nombre_taches_terminees = db.Column(db.Integer, nullable=False)\n\n@app.route(\"/\")\ndef index():\n    taches = Tache.query.all()\n    statistiques = Statistique.query.first()\n    if not statistiques:\n        statistiques = Statistique(nombre_taches=0, nombre_taches_terminees=0)\n        db.session.add(statistiques)\n        db.session.commit()\n    return render_template(\"index.html\", taches=taches, statistiques=statistiques)\n\n@app.route(\"/taches\", methods=[\"POST\"])\ndef ajouter_tache():\n    titre = request.json[\"titre\"]\n    description = request.json[\"description\"]\n    tache = Tache(titre=titre, description=description)\n    db.session.add(tache)\n    db.session.commit()\n    return jsonify({\"message\": \"Tache ajoutée avec succès\"})\n\n@app.route(\"/taches/<int:id>\", methods=[\"PUT\"])\ndef modifier_tache(id):\n    tache = Tache.query.get(id)\n    if tache:\n        titre = request.json.get(\"titre\")\n        description = request.json.get(\"description\")\n        if titre:\n            tache.titre = titre\n        if description:\n            tache.description = description\n        db.session.commit()\n        return jsonify({\"message\": \"Tache modifiée avec succès\"})\n    return jsonify({\"message\": \"Tache non trouvée\"}), 404\n\n@app.route(\"/taches/<int:id>\", methods=[\"DELETE\"])\ndef supprimer_tache(id):\n    tache = Tache.query.get(id)\n    if tache:\n        db.session.delete(tache)\n        db.session.commit()\n        return jsonify({\"message\": \"Tache supprimée avec succès\"})\n    return jsonify({\"message\": \"Tache non trouvée\"}), 404\n\n@app.route(\"/statistiques\", methods=[\"GET\"])\ndef get_statistiques():\n    statistiques = Statistique.query.first()\n    if statistiques:\n        nombre_taches = Tache.query.count()\n        nombre_taches_terminees = Tache.query.filter_by(modifie_le__isnull=False).count()\n        statistiques.nombre_taches = nombre_taches\n        statistiques.nombre_taches_terminees = nombre_taches_terminees\n        db.session.commit()\n    return jsonify({\"nombre_taches\": statistiques.nombre_taches, \"nombre_taches_terminees\": statistiques.nombre_taches_terminees})\n\nif __name__ == \"__main__\":\n    app.run(debug=True)\n", "timestamp": 1766328738.919392}