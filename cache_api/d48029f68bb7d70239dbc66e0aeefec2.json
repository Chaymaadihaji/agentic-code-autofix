{"nom_fichier": "models.py", "code": "python\n# models.py\n\nfrom sqlalchemy import Column, Integer, String, DateTime\nfrom sqlalchemy.ext.declarative import declarative_base\nfrom pydantic import BaseModel\nfrom fastapi import FastAPI\nfrom fastapi.responses import JSONResponse\nfrom fastapi.security import HTTPBearer, HTTPAuthCredentials\nfrom jose import jwt\nfrom datetime import datetime, timedelta\nfrom passlib.context import CryptContext\nfrom fastapi import Depends, Request\n\napp = FastAPI(\n    title=\"API\",\n    description=\"API REST avec FastAPI et MongoDB\",\n    version=\"1.0\",\n    openapi_tags=[{\"name\":\"autres\",\"description\":\"Touts les endpoints autres\"}],\n)\n\n# Configuration JWT\nsecret_key = \"secret_key\"\nalgorithm = \"HS256\"\nexpiration_time = 60 * 15  # 15 minutes\n\n# Création d'un contexte de hachage pour le mot de passe\npwd_context = CryptContext(schemes=[\"bcrypt\"], default=\"bcrypt\")\n\n# Classe de modèle de données MongoDB\nBase = declarative_base()\n\nclass UserMongoDB(Base):\n    __tablename__ = \"users\"\n\n    id = Column(Integer, primary_key=True)\n    login = Column(String)\n    password = Column(String)\n    create_at = Column(DateTime)\n\n\nclass TokenModel(BaseModel):\n    access_token: str\n    token_type: str\n\n\nclass TokenData(BaseModel):\n    email: str | None = None\n\n\n# Création d'un endpoint d'inscription\n@app.post(\"/inscription\")\nasync def inscription(request: Request, user: UserMongoDB):\n    hashed_password = pwd_context.hash(user.password)\n    user.password = hashed_password\n    Base.session.add(user)\n    Base.session.commit()\n    return JSONResponse(status_code=202, content={\"message\": \"L'utilisateur a été créé avec succès\"})\n\n# Création d'un endpoint d'identification\n@app.post(\"/login\")\nasync def login(request: Request, user: UserMongoDB):\n    if not user or not user.password:\n        return JSONResponse(status_code=401, content={\"message\": \"Informations manquantes\"})\n    try:\n        hashed_password = pwd_context.verify(user.password, user.password)\n        if not hashed_password:\n            raise ValueError\n        access_token = jwt.encode({\"sub\": user.login}, secret_key, algorithm)\n        return JSONResponse(status_code=200, content={\"access_token\": access_token, \"token_type\": \"bearer\"})\n    except ValueError:\n        return JSONResponse(status_code=401, content={\"message\": \"Mot de passe incorrect\"})\n\n# Gestion des exceptions\n@app.exception_handler(Exception)\nasync def exception_handler(request: Request, exc: Exception):\n    return JSONResponse(status_code=500, content={\"message\": \"Une erreur inconnue est survenue\"})\n", "langage": "python", "bugs_introduits": [], "corrections_appliquees": [], "timestamp": 1767106741.3726132, "tentative": 4}