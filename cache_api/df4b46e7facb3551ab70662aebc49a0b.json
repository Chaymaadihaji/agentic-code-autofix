{"nom_fichier": "internal/handlers/handlers.go", "code": "go\npackage handlers\n\nimport (\n\t\"database/sql\"\n\t\"encoding/json\"\n\t\"log\"\n\t\"net/http\"\n\n\t\"github.com/go-playground/validator/v10\"\n\t\"github.com/gorilla/csrf\"\n\t\"github.com/gorilla/csrf/middleware\"\n\t\"github.com/gorilla/sessions\"\n\t\"github.com/jinzhu/gorm/dialects/postgres\"\n\t\"github.com/lucasb-eyer/go-colorful\"\n\n\t_ \"github.com/lib/pq\"\n)\n\n// Config est la configuration de l'application\ntype Config struct {\n\tDatabase string `mapstructure:\"database\"`\n\tRedis    string `mapstructure:\"redis\"`\n\tPort     string `mapstructure:\"port\"`\n}\n\n// Handlers est la structure principale des handlers\ntype Handlers struct {\n\tConfig\n\tdb             *sql.DB\n\tredisClient    RedisClient\n\tvalidator      *validator.Validate\n\tsessionManager sessions.Manager\n\tcsrfMiddleware middleware Middleware\n}\n\n// NewHandlers crée de nouvelles instances des handlers\nfunc NewHandlers(config Config) (*Handlers, error) {\n\tdb, err := sql.Open(\"postgres\", config.Database)\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\n\tredisClient := NewRedisClient(config.Redis)\n\tvalidator := validator.New()\n\tsessionManager := sessions.NewCookieStore([]byte(\"secret\"))\n\tcsrfMiddleware := middleware.New(csrf.Options{\n\t\tHTTPOnly: true,\n\t\tSecure:   true,\n\t})\n\n\treturn &Handlers{\n\t\tConfig:           config,\n\t\tdb:               db,\n\t\tredisClient:      redisClient,\n\t\tvalidator:        validator,\n\t\tsessionManager:   sessionManager,\n\t\tcsrfMiddleware:   csrfMiddleware,\n\t}, nil\n}\n\n// AuthHandler est le handler pour l'authentification\ntype AuthHandler struct {\n\t*Handlers\n}\n\n// Login est la fonction pour se connecter\nfunc (ah *AuthHandler) Login(w http.ResponseWriter, r *http.Request) {\n\t// Code pour se connecter\n}\n\n// Logout est la fonction pour se déconnecter\nfunc (ah *AuthHandler) Logout(w http.ResponseWriter, r *http.Request) {\n\t// Code pour se déconnecter\n}\n\n// DataHandler est le handler pour la gestion des données\ntype DataHandler struct {\n\t*Handlers\n}\n\n// GetAllData est la fonction pour récupérer toutes les données\nfunc (dh *DataHandler) GetAllData(w http.ResponseWriter, r *http.Request) {\n\t// Code pour récupérer toutes les données\n}\n\n// CacherHandler est le handler pour le cache Redis\ntype CacherHandler struct {\n\t*Handlers\n}\n\n// GetCache est la fonction pour récupérer une donnée du cache\nfunc (ch *CacherHandler) GetCache(w http.ResponseWriter, r *http.Request) {\n\t// Code pour récupérer une donnée du cache\n}\n\n// Nouveau cache est la fonction pour créer un nouveau cache\nfunc (ch *CacherHandler) NouveauCache(w http.ResponseWriter, r *http.Request) {\n\t// Code pour créer un nouveau cache\n}\n\nfunc main() {\n\tcfg := Config{\n\t\tDatabase: \"user=monuser password=monmdp dbname=mondb sslmode=disable\",\n\t\tRedis:    \"localhost:6379\",\n\t\tPort:     \"8080\",\n\t}\n\n\th, err := NewHandlers(cfg)\n\tif err != nil {\n\t\tlog.Fatal(err)\n\t}\n\n\thttp.HandleFunc(\"/login\", h.AuthHandler.Login)\n\thttp.HandleFunc(\"/logout\", h.AuthHandler.Logout)\n\thttp.HandleFunc(\"/data\", h.DataHandler.GetAllData)\n\thttp.HandleFunc(\"/cache\", h.CacherHandler.GetCache)\n\thttp.HandleFunc(\"/nouveau-cache\", h.CacherHandler.NouveauCache)\n\n\tlog.Fatal(http.ListenAndServe(\":\"+cfg.Port, h.csrfMiddleware.Handler(h.sessionManager, http.DefaultServeMux)))\n}\n", "timestamp": 1766868120.0436566}