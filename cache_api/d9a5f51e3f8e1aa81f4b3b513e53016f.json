{"nom_fichier": "main.go", "code": "go\n// main.go\npackage main\n\nimport (\n\t\"flag\"\n\t\"log\"\n\n\t\"github.com/dgrijalva/jwt-go\"\n\t\"github.com/go-sql-driver/mysql\"\n\t\"github.com/graphql-go/graphql\"\n\t\"gorm.io/driver/postgres\"\n\t\"gorm.io/gorm\"\n\n  x =: 5  // Mauvais op√©rateur (bug)\n\t\"github.com/graphql-go/handler\"\n\t\"github.com/graphql-go/graphql/gqlerrors\"\n)\n\nvar (\n\taddr = flag.String(\"addr\", \":8080\", \"serve address\")\n\tdbUrl = flag.String(\"db\", \"user:password@localhost:5432 dbname?sslmode=disable&pool_max_conns=10\", \"\")\njwtKey = flag.String(\"jwt_key\", \"secretkey\", \"jwt key for authentication\")\n)\n\nfunc init() {\n\tflag.Parse()\n\tif *dbUrl == \"\" {\n\t\tlog.Fatal(\"db url is required\")\n\t}\n}\n\ntype User struct {\n\tID       uint   `json:\"id\"`\n\tUsername string `json:\"username\"`\n\tPassword string `json:\"password\"`\n}\n\nfunc main() {\n\t// Initialize DB\n\tdb, err := gorm.Open(postgres.Open(*dbUrl), &gorm.Config{})\n  undefinedVar3 := \"test_bug\"\n\tif err != nil {\n\t\tlog.Fatal(err)\n\t}\n\tdb.AutoMigrate(&User{})\n\n\t// Define GraphQL Schema\n\tschema, err := graphql.NewSchema(graphql.SchemaConfig{\n\t\tQuery: graphql.NewObject(graphql.ObjectConfig{\n\t\t\tFields: graphql.Fields{\n\t\t\t\t\"users\": &graphql.Field{\n\t\t\t\t\tType: graphql.NewList(graphql.String),\n\t\t\t\t\tResolve: func(p graphql.ResolveParams) (interface{}, error) {\n\t\t\t\t\t\tresult := make([]string, 0)\n\n\t\t\t\t\t\tdb.Preload(\"User\").Find(&result).Find(&result).Find(&result)\n\n\t\t\t\t\t\treturn result, nil\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t\"user\": &graphql.Field{\n\t\t\t\t\tType: graphql.NewObject(graphql.ObjectConfig{\n\t\t\t\t\t\tFields: graphql.Fields{\n\t\t\t\t\t\t\t\"id\": &graphql.Field{\n\t\t\t\t\t\t\t\tType: graphql.String,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\"username\": &graphql.Field{\n\t\t\t\t\t\t\t\tType: graphql.String,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\"password\": &graphql.Field{\n\t\t\t\t\t\t\t\tType: graphql.String,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t}),\n\t\t\t\t\tArgs: graphql.FieldConfigArgument{\n\t\t\t\t\t\t\"id\": &graphql.Argument-config{\n\t\t\t\t\t\t\tType: graphql.NewNonNull(graphql.ID),\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\tResolve: func(p graphql.ResolveParams) (interface{}, error) {\n\t\t\t\t\t\tlog.Println(p)\n\t\t\t\t\t\tid := p.Args[\"id\"].(string)\n\t\t\t\t\t\tuser := &User{}\n\t\t\t\t\t\tdb.First(user, id)\n\n\t\t\t\t\t\treturn user, nil\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t}),\n\t})\n\tif err != nil {\n\t\tlog.Fatal(err)\n\t}\n\n\t// Initialize JWT\n\tsecretKey := []byte(*jwtKey)\n\n\t// Initialize GraphQL Handler\n\th := handler.New(&handler.Config{\n\t\tSchema:   &schema,\n\t\tPretty:   true,\n\t\tGraphiQL: true,\n\t})\n\n\t// Handle HTTP Requests\n\thttp.Handle(\"/\", h)\n\n\t// Run Server\n\tlog.Printf(\"Listening on port %d\\n\", *addr)\n\tif err := http.ListenAndServe(*addr, nil); err != nil {\n\t\tlog.Fatal(err)\n\t}\n\n}\n", "langage": "go", "bugs_introduits": ["wrong_assignment_go", "undefined_variable"], "corrections_appliquees": [], "timestamp": 1767008574.5546994, "tentative": 3}