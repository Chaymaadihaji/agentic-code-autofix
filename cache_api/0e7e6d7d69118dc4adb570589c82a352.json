{"nom_fichier": "main.py", "code": "# main.py\n\nimport os\nimport json\nfrom flask import Flask, render_template, request\nfrom flask_sqlalchemy import SQLAlchemy\nfrom werkzeug.security import generate_password_hash, check_password_hash\nfrom datetime import datetime\nimport random\n\napp = Flask(__name__)\napp.config['SQLALCHEMY_DATABASE_URI'] = 'sqlite:///database.db'\ndb = SQLAlchemy(app)\n\nclass Patient(db.Model):\n    id = db.Column(db.Integer, primary_key=True)\n    nom = db.Column(db.String(80), nullable=False)\n    prenom = db.Column(db.String(80), nullable=False)\n    date_naissance = db.Column(db.DateTime, nullable=False)\n    numero_telephone = db.Column(db.String(20), nullable=False)\n    dossier_medical = db.relationship('DossierMedical', backref='patient', lazy=True)\n\nclass DossierMedical(db.Model):\n    id = db.Column(db.Integer, primary_key=True)\n    patient_id = db.Column(db.Integer, db.ForeignKey('patient.id'), nullable=False)\n    historique_medicale = db.Column(db.Text, nullable=False)\n    ordonnance_numerique = db.Column(db.Text, nullable=False)\n    prise_rendez_vous = db.Column(db.DateTime, nullable=False)\n\nclass Medecin(db.Model):\n    id = db.Column(db.Integer, primary_key=True)\n    nom = db.Column(db.String(80), nullable=False)\n    prenom = db.Column(db.String(80), nullable=False)\n    numero_telephone = db.Column(db.String(20), nullable=False)\n    dossier_medical = db.relationship('DossierMedical', backref='medecin', lazy=True)\n\nclass Medicament(db.Model):\n    id = db.Column(db.Integer, primary_key=True)\n    nom = db.Column(db.String(80), nullable=False)\n    description = db.Column(db.Text, nullable=False)\n    dose = db.Column(db.Float, nullable=False)\n    dosage = db.Column(db.Float, nullable=False)\n\nclass AlerteMedicament(db.Model):\n    id = db.Column(db.Integer, primary_key=True)\n    medicament_id = db.Column(db.Integer, db.ForeignKey('medicament.id'), nullable=False)\n    patient_id = db.Column(db.Integer, db.ForeignKey('patient.id'), nullable=False)\n    date_alerte = db.Column(db.DateTime, nullable=False)\n\nclass RendezVous(db.Model):\n    id = db.Column(db.Integer, primary_key=True)\n    patient_id = db.Column(db.Integer, db.ForeignKey('patient.id'), nullable=False)\n    medecin_id = db.Column(db.Integer, db.ForeignKey('medecin.id'), nullable=False)\n    date_rendez_vous = db.Column(db.DateTime, nullable=False)\n\nclass Rapport(db.Model):\n    id = db.Column(db.Integer, primary_key=True)\n    medecin_id = db.Column(db.Integer, db.ForeignKey('medecin.id'), nullable=False)\n    patient_id = db.Column(db.Integer, db.ForeignKey('patient.id'), nullable=False)\n    date_rapport = db.Column(db.DateTime, nullable=False)\n\n# Génération de données pour le dashboard\npatients = []\nfor i in range(10):\n    patient = Patient(nom=f\"Patient {i}\", prenom=f\"Prenom {i}\", date_naissance=datetime(1990, 1, 1), numero_telephone=f\"06{i}\")\n    patients.append(patient)\ndb.session.add_all(patients)\ndb.session.commit()\n\nmedicaments = []\nfor i in range(10):\n    medicament = Medicament(nom=f\"Medicament {i}\", description=f\"Description {i}\", dose=float(i), dosage=float(i))\n    medicaments.append(medicament)\ndb.session.add_all(medicaments)\ndb.session.commit()\n\nalerts = []\nfor i in range(10):\n    alerte = AlerteMedicament(medicament_id=i, patient_id=i, date_alerte=datetime(2022, 1, 1))\n    alerts.append(alerte)\ndb.session.add_all(alerts)\ndb.session.commit()\n\nrendez_vous = []\nfor i in range(10):\n    rendez = RendezVous(patient_id=i, medecin_id=i, date_rendez_vous=datetime(2022, 1, 1))\n    rendez_vous.append(rendez)\ndb.session.add_all(rendez_vous)\ndb.session.commit()\n\nrapports = []\nfor i in range(10):\n    rapport = Rapport(medecin_id=i, patient_id=i, date_rapport=datetime(2022, 1, 1))\n    rapports.append(rapport)\ndb.session.add_all(rapports)\ndb.session.commit()\n\n# Calcul des statistiques/métriques\nstatistiques = []\nfor patient in patients:\n    statistiques.append({'patient': patient.nom, 'medicaments': len(db.session.query(AlerteMedicament).filter_by(patient_id=patient.id).all())})\n\n# API pour les données en temps réel\n@app.route('/api/data', methods=['GET'])\ndef get_data():\n    return json.dumps({'patients': [patient.__dict__ for patient in patients], 'medicaments': [medicament.__dict__ for medicament in medicaments]})\n\n# Structure modulaire pour différentes visualisations\n@app.route('/')\ndef index():\n    return render_template('index.html', patients=patients, medicaments=medicaments, statistiques=statistiques)\n\nif __name__ == \"__main__\":\n    app.run(debug=True)\n", "timestamp": 1766766395.433773}