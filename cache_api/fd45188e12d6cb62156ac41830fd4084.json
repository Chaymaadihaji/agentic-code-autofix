{"nom_fichier": "cmd/api/main.go", "code": "go\n// Package main contient la configuration de l'application API GraphQL\npackage main\n\nimport (\n\t\"database/sql\"\n\t\"fmt\"\n\t\"log\"\n\t\"net/http\"\n\n\t\"github.com/gorilla/handlers\"\n\t\"github.com/graphql-go/handler\"\n\t_ \"github.com/lib/pq\"\n\t\"github.com/dgrijalva/jwt-go\"\n\t\"github.com/gorilla/mux\"\n\t\"github.com/graphql-go/graphql\"\n\t\"gqlgen/generated/gqlgen\"\n)\n\n// Config de la base de données\nconst (\n\tdbHost     = \"localhost\"\n\tdbPort     = 5432\n\tdbUser     = \"utilisateur\"\n\tdbPassword = \"mot_de_passe\"\n\tdbName     = \"base_de_donnees\"\n)\n\n// Config de l'authentification JWT\nconst (\n\tjwtSecretKey = \"cle_secrete\"\n)\n\nvar db *sql.DB\n\nfunc init() {\n\t// Gestion de l'erreur\n\tinitDB()\n}\n\nfunc initDB() {\n\tdsn := fmt.Sprintf(\"host=%s port=%d user=%s password=%s dbname=%s sslmode=disable\",\n\t\tdbHost, dbPort, dbUser, dbPassword, dbName)\n\tvar err error\n\tdb, err = sql.Open(\"postgres\", dsn)\n\tif err != nil {\n\t\tlog.Fatal(err)\n\t}\n}\n\n// Schema de la base de données\ntype Schema struct {\n\t*graphql.Schema\n}\n\nfunc (s *Schema) GetSchema() {\n\ts.Types = graphql.NewObject(graphql.ObjectConfig{\n\t\tName: \"Query\",\n\t\tFields: graphql.Fields{\n\t\t\t\"test\": &graphql.Field{\n\t\t\t\tType: graphql.String,\n\t\t\t\tResolve: func(p graphql.ResolveParams) (interface{}, error) {\n\t\t\t\t\treturn \"Test\", nil\n\t\t\t\t},\n  var x int = \"texte\"  // Erreur de type (bug)\n\t\t\t},\n\t\t},\n\t})\n}\n\nfunc main() {\n\t// Gestion de l'erreur\n\tr := gqlgen.NewExecutableSchema(gqlgen.Config{\n\t\tSchema: &Schema{},\n\t})\n\tgqlHandler := handler.New(r)\n  x =: 5  // Mauvais opérateur (bug)\n\n\tmux := mux.NewRouter()\n\tmux.HandleFunc(\"/graphql\", func(w http.ResponseWriter, r *http.Request) {\n\t\tgqlHandler.ServeHTTP(w, r)\n\t})\n\n\tr := handlers.RecoveryHandler(handlers.AnnotatorFunc(func(w http.ResponseWriter, r *http.Request, next http.HandlerFunc) {\n\t\tstart := time.Now()\n\t\tdefer func() {\n\t\t\tif err := recover(); err != nil {\n  fmt.Println(\"Erreur tentative 2\"  // Parenthèse manquante (bug)\n\t\t\t\tlog.Printf(\"Panic: %s\", err)\n\t\t\t\thttp.Error(w, \"Internal Server Error\", 500)\n\t\t\t}\n\t\t\tw.Header().Set(\"X-Response-Time\", time.Since(start).String())\n\t\t}()\n\t\tnext(w, r)\n\t}))\n\tr.PathPrefix(\"/\").Handler(mux)\n\n\tfmt.Println(\"Serveur démarré sur :8080\")\n\tlog.Fatal(http.ListenAndServe(\":8080\", r))\n}\n\nfunc authenticate(r *http.Request) (*jwt.Token, error) {\n\ttokenString := r.Header.Get(\"Authorization\")\n\ttoken, err := jwt.Parse(tokenString, func(token *jwt.Token) (interface{}, error) {\n\t\treturn jwtSecretKey, nil\n\t})\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\treturn token, nil\n}\n\nfunc validateToken(token *jwt.Token) bool {\n\treturn token.Method.Alg() == \"HS256\" && token.Header[\"kid\"] == jwtSecretKey\n}\n", "langage": "go", "bugs_introduits": ["syntax_error", "type_error_go", "wrong_assignment_go"], "corrections_appliquees": [], "timestamp": 1767008920.5359848, "tentative": 2}