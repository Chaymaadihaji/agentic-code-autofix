{"nom_fichier": "main.py", "code": "# main.py\n\nfrom flask import Flask, render_template, request, jsonify\nfrom flask_sqlalchemy import SQLAlchemy\nfrom flask_redis import FlaskRedis\nfrom elasticsearch import Elasticsearch\n\napp = Flask(__name__)\napp.config['SQLALCHEMY_DATABASE_URI'] = 'postgresql://user:password@localhost/db'\napp.config['REDIS_URL'] = 'redis://localhost:6379/0'\napp.config['ES_HOST'] = 'localhost'\napp.config['ES_PORT'] = 9200\n\ndb = SQLAlchemy(app)\nredis_store = FlaskRedis(app)\nes = Elasticsearch(hosts=[app.config['ES_HOST']], port=app.config['ES_PORT'])\n\n# Modèle de données\nclass Resource(db.Model):\n    id = db.Column(db.Integer, primary_key=True)\n    name = db.Column(db.String(100), nullable=False)\n    description = db.Column(db.Text, nullable=False)\n\n# Routes\n@app.route('/')\ndef index():\n    return render_template('index.html')\n\n@app.route('/reservations', methods=['GET', 'POST'])\ndef reservations():\n    if request.method == 'POST':\n        resource_name = request.form['resource_name']\n        resource_description = request.form['resource_description']\n        resource = Resource(name=resource_name, description=resource_description)\n        db.session.add(resource)\n        db.session.commit()\n        redis_store.set(f'resource:{resource_name}', resource.id)\n        es.index(index='resources', body={'name': resource_name, 'description': resource_description})\n        return jsonify({'message': 'Réservation créée avec succès'})\n    resources = Resource.query.all()\n    return render_template('reservations.html', resources=resources)\n\n@app.route('/search', methods=['GET'])\ndef search():\n    query = request.args.get('q')\n    results = es.search(index='resources', body={'query': {'match': {'name': query}}})\n    return jsonify(results['hits']['hits'])\n\n# Erreurs\n@app.errorhandler(404)\ndef not_found(e):\n    return jsonify({'message': 'Ressource non trouvée'}), 404\n\n@app.errorhandler(500)\ndef internal_server_error(e):\n    return jsonify({'message': 'Erreur interne du serveur'}), 500\n\nif __name__ == \"__main__\":\n    app.run(debug=True)\n", "timestamp": 1766865689.024923}