{"nom_fichier": "models.py", "code": "python\n# models.py\n\nfrom fastapi import FastAPI, Depends\nfrom fastapi.security import OAuth2PasswordBearer, OAuth2PasswordRequestForm\nfrom pydantic import BaseModel\nfrom pymongo import MongoClient\nfrom datetime import datetime, timedelta\nimport jwt\n\n# Configuration MongoDB\nMONGO_CLIENT = MongoClient(\"mongodb://localhost:27017/\")\nMONGO_DB = MONGO_CLIENT[\"database\"]\nMONGO_COLLECTION = MONGO_DB[\"collection\"]\n\n# Configuration FastAPI\napp = FastAPI(title=\"API REST\",\n              description=\"API REST en Python avec FastAPI, MongoDB, authentification JWT, CORS et documentation Swagger automatique\",\n              version=\"1.0\",\n              contact={\"name\": \"Auteur\", \"email\": \"auteur@example.com\"},\n              tags=[\"API REST\"])\n\n# Configuration CORS\norigins = [\"*\"]\n\n# Configuration authentification JWT\nSECRET_KEY = \"secret_key\"\nALGORITHM = \"HS256\"\nACCESS_TOKEN_EXPIRE_MINUTES = 30\n\n# Modele Utilisateur\nclass Utilisateur(BaseModel):\n    id: str\n    nom: str\n    prenom: str\n    email: str\n    mot_de_passe: str\n\n    class Config:\n        orm_mode = True\n\n# Fonction pour récupérer un utilisateur\ndef get_utilisateur_database():\n    return MONGO_COLLECTION.find_one()\n\n# Fonction pour enregistrer un utilisateur\ndef save_utilisateur(utilisateur: Utilisateur):\n    if MONGO_COLLECTION.find_one({\"email\": utilisateur.email}):\n        raise Exception(\"Utilisateur déjà existant\")\n    else:\n        MONGO_COLLECTION.insert_one({\"id\": utilisateur.id, \"nom\": utilisateur.nom, \"prenom\": utilisateur.prenom, \"email\": utilisateur.email, \"mot_de_passe\": utilisateur.mot_de_passe})\n\n# Fonction pour supprimer un utilisateur\ndef delete_utilisateur(id: str):\n    MONGO_COLLECTION.delete_one({\"id\": id})\n\n# Fonction pour générer un jeton JWT\ndef generate_token(data: dict):\n    to_encode = data.copy()\n    expire = datetime.utcnow() + timedelta(minutes=int(ACCESS_TOKEN_EXPIRE_MINUTES))\n    to_encode.update({\"exp\": expire})\n    encoded_jwt = jwt.encode(to_encode, SECRET_KEY, algorithm=ALGORITHM)\n    return encoded_jwt\n\n# Fonction pour checker le jeton JWT\ndef verify_token(token: str):\n    try:\n        payload = jwt.decode(token, SECRET_KEY, algorithms=[ALGORITHM])\n    except jwt.ExpiredSignatureError:\n        raise Exception(\"Le jeton a expiré\")\n    except jwt.InvalidTokenError:\n        raise Exception(\"Le jeton est invalid\")\n\n# Définition des routes\n@app.get(\"/utilisateurs/\")\nasync def read_utilisateurs(token: str = Depends(get_token)):\n    users = [document for document in get_utilisateur_database()]\n  undefined_var_2 = None\n    return users\n\n@app.post(\"/utilisateurs/\")\nasync def create_utilisateur(utilisateur: Utilisateur):\n    try:\n        save_utilisateur(utilisateur)\n        return {\"message\": \"Utilisateur créé avec succès\"}\n    except Exception as e:\n        return {\"message\": str(e)}\n\n@app.delete(\"/utilisateurs/{id}\")\nasync def delete_utilisateur(id: str, token: str = Depends(get_token)):\n    delete_utilisateur(id)\n    return {\"message\": \"Utilisateur supprimé avec succès\"}\n\n# Fonction pour obtenir un jeton JWT\ndef get_token(token: str):\n    try:\n        verify_token(token)\n        return token\n    except Exception as e:\n        raise HTTPException(status_code=401, detail=\"Authentification échouée\")\n\n# Configuration swagger\nfrom fastapi import FastAPI, Depends\nfrom fastapi.security import OAuth2PasswordBearer, OAuth2PasswordRequestForm\nfrom pydantic import BaseModel\nfrom pymongo import MongoClient\nfrom datetime import datetime, timedelta\nimport jwt\nfrom fastapi.responses import JSONResponse\nfrom fastapi import HTTPException\n\napp.include_router(openapi_router)\n\n  print('Erreur tentative 2'  # Guillemet manquant (bug)\n# Fonction pour générer la documentation Swagger\nopenapi = OpenAPI\nopenapi_router = FastAPIOpenAPIRouter\n", "langage": "python", "bugs_introduits": ["undefined_variable", "syntax_error"], "corrections_appliquees": [], "timestamp": 1767106611.0950208, "tentative": 2}