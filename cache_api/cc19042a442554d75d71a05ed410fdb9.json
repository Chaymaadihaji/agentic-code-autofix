{"nom_fichier": "models.py", "code": "# models.py\n\nimport os\nfrom flask import Flask, render_template, request, jsonify\nfrom flask_sqlalchemy import SQLAlchemy\nfrom flask_redis import FlaskRedis\nfrom elasticsearch import Elasticsearch\n\napp = Flask(__name__)\napp.config['SQLALCHEMY_DATABASE_URI'] = 'postgresql://user:password@host:port/dbname'\napp.config['REDIS_URL'] = 'redis://localhost:6379/0'\napp.config['ELASTICSEARCH_URL'] = 'http://localhost:9200'\n\ndb = SQLAlchemy(app)\nredis = FlaskRedis(app)\nes = Elasticsearch(app.config['ELASTICSEARCH_URL'])\n\nclass Reservation(db.Model):\n    id = db.Column(db.Integer, primary_key=True)\n    resource_id = db.Column(db.Integer, db.ForeignKey('resource.id'))\n    user_id = db.Column(db.Integer, db.ForeignKey('user.id'))\n    start_date = db.Column(db.DateTime, nullable=False)\n    end_date = db.Column(db.DateTime, nullable=False)\n\nclass Resource(db.Model):\n    id = db.Column(db.Integer, primary_key=True)\n    name = db.Column(db.String(100), nullable=False)\n\nclass User(db.Model):\n    id = db.Column(db.Integer, primary_key=True)\n    name = db.Column(db.String(100), nullable=False)\n\n@app.route('/')\ndef index():\n    return render_template('index.html')\n\n@app.route('/reserve', methods=['POST'])\ndef reserve():\n    data = request.json\n    reservation = Reservation(start_date=data['start_date'], end_date=data['end_date'], resource_id=data['resource_id'], user_id=data['user_id'])\n    db.session.add(reservation)\n    db.session.commit()\n    redis.incr('reservation_count')\n    es.index(index='reservations', body={'start_date': data['start_date'], 'end_date': data['end_date'], 'resource_id': data['resource_id'], 'user_id': data['user_id']})\n    return jsonify({'message': 'Reservation created'})\n\n@app.route('/search', methods=['GET'])\ndef search():\n    query = request.args.get('query')\n    results = es.search(index='reservations', body={'query': {'match': {'start_date': query}}})\n    return jsonify(results)\n\nif __name__ == \"__main__\":\n    app.run(debug=True)\n", "timestamp": 1766865704.1301453}