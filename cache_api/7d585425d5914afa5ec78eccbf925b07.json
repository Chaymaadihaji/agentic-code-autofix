{"nom_fichier": "README.md", "code": "# Fichier app.py\nfrom flask import Flask, render_template, request, redirect, url_for\nfrom flask_sqlalchemy import SQLAlchemy\nfrom flask_login import LoginManager, UserMixin, login_user, login_required, logout_user\nfrom werkzeug.security import generate_password_hash, check_password_hash\nfrom flask_mail import Mail, Message\nimport random\nimport string\nfrom datetime import datetime\n\napp = Flask(__name__)\napp.config.from_object('config')\n\ndb = SQLAlchemy(app)\nlogin_manager = LoginManager()\nlogin_manager.init_app(app)\nlogin_manager.login_view = 'login'\n\nmail = Mail(app)\n\nclass User(UserMixin, db.Model):\n    id = db.Column(db.Integer, primary_key=True)\n    username = db.Column(db.String(64), unique=True, nullable=False)\n    email = db.Column(db.String(120), unique=True, nullable=False)\n    password = db.Column(db.String(128), nullable=False)\n    connected_at = db.Column(db.DateTime, nullable=False, default=datetime.utcnow)\n\n    def __init__(self, username, email, password):\n        self.username = username\n        self.email = email\n        self.password = generate_password_hash(password)\n\nclass Connexion(db.Model):\n    id = db.Column(db.Integer, primary_key=True)\n    user_id = db.Column(db.Integer, db.ForeignKey('user.id'), nullable=False)\n    user = db.relationship('User', backref=db.backref('connexions', lazy=True))\n    ip = db.Column(db.String(15), nullable=False)\n    created_at = db.Column(db.DateTime, nullable=False, default=datetime.utcnow)\n\n@login_manager.user_loader\ndef load_user(user_id):\n    return User.query.get(int(user_id))\n\n@app.route('/')\ndef index():\n    return render_template('index.html')\n\n@app.route('/login', methods=['GET', 'POST'])\ndef login():\n    if request.method == 'POST':\n        username = request.form['username']\n        password = request.form['password']\n        user = User.query.filter_by(username=username).first()\n        if user and check_password_hash(user.password, password):\n            login_user(user)\n            return redirect(url_for('dashboard'))\n    return render_template('login.html')\n\n@app.route('/register', methods=['GET', 'POST'])\ndef register():\n    if request.method == 'POST':\n        username = request.form['username']\n        email = request.form['email']\n        password = request.form['password']\n        user = User.query.filter_by(username=username).first()\n        if user:\n            return 'Utilisateur déjà existant'\n        user = User(username, email, password)\n        db.session.add(user)\n        db.session.commit()\n        return 'Utilisateur créé avec succès'\n    return render_template('register.html')\n\n@app.route('/logout')\n@login_required\ndef logout():\n    logout_user()\n    return redirect(url_for('index'))\n\n@app.route('/dashboard')\n@login_required\ndef dashboard():\n    return render_template('dashboard.html', user=current_user)\n\n@app.route('/historique')\n@login_required\ndef historique():\n    connexions = Connexion.query.filter_by(user_id=current_user.id).all()\n    return render_template('historique.html', connexions=connexions)\n\n@app.route('/forgot_password', methods=['GET', 'POST'])\ndef forgot_password():\n    if request.method == 'POST':\n        email = request.form['email']\n        user = User.query.filter_by(email=email).first()\n        if user:\n            # Envoi d'un SMS de réinitialisation\n            message = Message('Réinitialisation de mot de passe', sender='votre_adresse_email@gmail.com', recipients=[email])\n            message.body = 'Votre code de réinitialisation est : ' + ''.join(random.choices(string.digits, k=6))\n            mail.send(message)\n            return 'Code de réinitialisation envoyé'\n    return render_template('forgot_password.html')\n\nif __name__ == '__main__':\n    app.run(debug=True)\n", "timestamp": 1766865299.7152708}