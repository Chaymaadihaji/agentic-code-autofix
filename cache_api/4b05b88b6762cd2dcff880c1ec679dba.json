{"nom_fichier": "streamlit_app.py", "code": "import streamlit as st\nimport sqlite3\nimport jwt\nimport datetime\nfrom fpdf import FPDF\nfrom flask import Flask, request, jsonify\nfrom werkzeug.security import generate_password_hash, check_password_hash\n\napp = Flask(__name__)\napp.config['SECRET_KEY'] = 'secret_key'\n\n# Connexion à la base de données\nconn = sqlite3.connect('bibliotheque.db')\nc = conn.cursor()\n\n# Création de la table livres\nc.execute('''CREATE TABLE IF NOT EXISTS livres\n             (id INTEGER PRIMARY KEY, titre TEXT, auteur TEXT, edition TEXT)''')\n\n# Création de la table membres\nc.execute('''CREATE TABLE IF NOT EXISTS membres\n             (id INTEGER PRIMARY KEY, nom TEXT, prenom TEXT, email TEXT, mot_de_passe TEXT)''')\n\n# Création de la table emprunts\nc.execute('''CREATE TABLE IF NOT EXISTS emprunts\n             (id INTEGER PRIMARY KEY, livre_id INTEGER, membre_id INTEGER, date_emprunt DATE, date_retour DATE)''')\n\n# Fonction de gestion des livres\ndef gestion_livres():\n    c.execute(\"SELECT * FROM livres\")\n    livres = c.fetchall()\n    return livres\n\n# Fonction de gestion des membres\ndef gestion_membres():\n    c.execute(\"SELECT * FROM membres\")\n    membres = c.fetchall()\n    return membres\n\n# Fonction de gestion des emprunts\ndef gestion_emprunts():\n    c.execute(\"SELECT * FROM emprunts\")\n    emprunts = c.fetchall()\n    return emprunts\n\n# Fonction de création de token JWT\ndef create_token(user_id):\n    payload = {\n        'exp': datetime.datetime.utcnow() + datetime.timedelta(days=1),\n        'iat': datetime.datetime.utcnow(),\n        'user_id': user_id\n    }\n    token = jwt.encode(payload, app.config['SECRET_KEY'], algorithm='HS256')\n    return token\n\n# Fonction de vérification du token JWT\ndef verify_token(token):\n    try:\n        payload = jwt.decode(token, app.config['SECRET_KEY'], algorithms=['HS256'])\n        return payload['user_id']\n    except jwt.ExpiredSignatureError:\n        return None\n    except jwt.InvalidTokenError:\n        return None\n\n# Page d'accueil\ndef page_accueil():\n    st.title(\"Bibliothèque\")\n    st.write(\"Bienvenue dans la bibliothèque !\")\n\n# Page de gestion des livres\ndef page_gestion_livres():\n    st.title(\"Gestion des livres\")\n    livres = gestion_livres()\n    st.write(\"Livres disponibles :\")\n    for livre in livres:\n        st.write(f\"{livre[1]} - {livre[2]} - {livre[3]}\")\n\n# Page de gestion des membres\ndef page_gestion_membres():\n    st.title(\"Gestion des membres\")\n    membres = gestion_membres()\n    st.write(\"Membres disponibles :\")\n    for membre in membres:\n        st.write(f\"{membre[1]} {membre[2]} - {membre[3]}\")\n\n# Page de gestion des emprunts\ndef page_gestion_emprunts():\n    st.title(\"Gestion des emprunts\")\n    emprunts = gestion_emprunts()\n    st.write(\"Emprunts disponibles :\")\n    for emprunt in emprunts:\n        st.write(f\"{emprunt[1]} - {emprunt[3]} - {emprunt[4]}\")\n\n# Page de connexion\ndef page_connexion():\n    st.title(\"Connexion\")\n    email = st.text_input(\"Email\")\n    mot_de_passe = st.text_input(\"Mot de passe\", type=\"password\")\n    if st.button(\"Se connecter\"):\n        c.execute(\"SELECT * FROM membres WHERE email = ?\", (email,))\n        membre = c.fetchone()\n        if membre and check_password_hash(membre[4], mot_de_passe):\n            token = create_token(membre[0])\n            st.write(f\"Bonjour {membre[1]} {membre[2]} ! Votre token est : {token}\")\n        else:\n            st.write(\"Identifiant ou mot de passe incorrect\")\n\n# Page de création de livre\ndef page_creation_livre():\n    st.title(\"Création de livre\")\n    titre = st.text_input(\"Titre\")\n    auteur = st.text_input(\"Auteur\")\n    edition = st.text_input(\"Édition\")\n    if st.button(\"Créer\"):\n        c.execute(\"INSERT INTO livres (titre, auteur, edition) VALUES (?, ?, ?)\", (titre, auteur, edition))\n        conn.commit()\n        st.write(\"Livre créé avec succès\")\n\n# Page de création de membre\ndef page_creation_membre():\n    st.title(\"Création de membre\")\n    nom = st.text_input(\"Nom\")\n    prenom = st.text_input(\"Prénom\")\n    email = st.text_input(\"Email\")\n    mot_de_passe = st.text_input(\"Mot de passe\", type=\"password\")\n    if st.button(\"Créer\"):\n        c.execute(\"INSERT INTO membres (nom, prenom, email, mot_de_passe) VALUES (?, ?, ?, ?)\", (nom, prenom, email, generate_password_hash(mot_de_passe)))\n        conn.commit()\n        st.write(\"Membre créé avec succès\")\n\n# Page de création d'emprunt\ndef page_creation_emprunt():\n    st.title(\"Création d'emprunt\")\n    livre_id = st.selectbox(\"Sélectionner un livre\", [livre[0] for livre in gestion_livres()])\n    membre_id = st.selectbox(\"Sélectionner un membre\", [membre[0] for membre in gestion_membres()])\n    date_emprunt = st.date_input(\"Date d'emprunt\")\n    date_retour = st.date_input(\"Date de retour\")\n    if st.button(\"Créer\"):\n        c.execute(\"INSERT INTO emprunts (livre_id, membre_id, date_emprunt, date_retour) VALUES (?, ?, ?, ?)\", (livre_id, membre_id, date_emprunt, date_retour))\n        conn.commit()\n        st.write(\"Emprunt créé avec succès\")\n\n# Fonction de génération de rapports PDF\ndef generate_report():\n    pdf = FPDF()\n    pdf.add_page()\n    pdf.set_font(\"Arial\", size=15)\n    pdf.cell(200, 10, txt=\"Rapport de la bibliothèque\", ln=True, align='C')\n    pdf.ln(10)\n    pdf.cell(200, 10, txt=\"Nombre de livres : \" + str(len(gestion_livres())), ln=True, align='C')\n    pdf.ln(10)\n    pdf.cell(200, 10, txt=\"Nombre de membres : \" + str(len(gestion_membres())), ln=True, align='C')\n    pdf.ln(10)\n    pdf.cell(200, 10, txt=\"Nombre d'emprunts : \" + str(len(gestion_emprunts())), ln=True, align='C')\n    pdf.output(\"rapport.pdf\")\n\n# Fonction de lancement de l'application\ndef lancer_application():\n    page = st.selectbox(\"Sélectionner une page\", [\"Page d'accueil\", \"Page de gestion des livres\", \"Page de gestion des membres\", \"Page de gestion des emprunts\", \"Page de connexion\", \"Page de création de livre\", \"Page de création de membre\", \"Page de création d'emprunt\", \"Génération de rapports PDF\"])\n    if page == \"Page d'accueil\":\n        page_accueil()\n    elif page == \"Page de gestion des livres\":\n        page_gestion_livres()\n    elif page == \"Page de gestion des membres\":\n        page_gestion_membres()\n    elif page == \"Page de gestion des emprunts\":\n        page_gestion_emprunts()\n    elif page == \"Page de connexion\":\n        page_connexion()\n    elif page == \"Page de création de livre\":\n        page_creation_livre()\n    elif page == \"Page de création de membre\":\n        page_creation_membre()\n    elif page == \"Page de création d'emprunt\":\n        page_creation_emprunt()\n    elif page == \"Génération de rapports PDF\":\n        generate_report()\n\n# Lancement de l'application\nif __name__ == \"__main__\":\n    lancer_application()\n", "timestamp": 1766864194.0510325}