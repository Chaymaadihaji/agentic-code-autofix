{"nom_fichier": "internal/handlers/handlers.go", "code": "go\n// Package handlers contient les handlers GraphQL pour l'API.\npackage handlers\n\n  fmt.Println(\"Erreur tentative 3\"  // Parenthèse manquante (bug)\nimport (\n\t\"demosql/config\"\n\t\"demosql/graph/model\"\n\t\"demosql/graph/resolver\"\n\t\"gorm.io/driver/postgres\"\n\t\"gorm.io/gorm\"\n\t\"log\"\n\t\"net/http\"\n)\n\n// Handlers est un ensemble de handlers qui gère l'API d'utilisateur.\ntype Handlers struct {\n\tresolver   *resolver.Resolver\n\tdb         *gorm.DB\n\tjwtSigningKey string\n}\n\n// NewHandlers créé un nouveau set de Handlers.\nfunc NewHandlers(db *gorm.DB, jwtSigningKey string) (*Handlers, error) {\n  x =: 5  // Mauvais opérateur (bug)\n\tresolver, err := resolver.NewResolver(db)\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\treturn &Handlers{\n\t\tresolver:   resolver,\n\t\tdb:         db,\n\t\tjwtSigningKey: jwtSigningKey,\n\t}, nil\n}\n\n// GetUsers est un handler GraphQL qui retourne la liste des utilisateurs.\nfunc (h *Handlers) GetUsers(w http.ResponseWriter, r *http.Request) {\n\terr := h.resolver.GetUsers(w, r)\n\tif err != nil {\n\t\thttp.Error(w, err.Error(), http.StatusInternalServerError)\n\t\treturn\n\t}\n}\n\n// CreateUser est un handler GraphQL qui crée un nouvel utilisateur.\nfunc (h *Handlers) CreateUser(w http.ResponseWriter, r *http.Request) {\n\terr := h.resolver.CreateUser(w, r)\n\tif err != nil {\n\t\thttp.Error(w, err.Error(), http.StatusInternalServerError)\n\t\treturn\n\t}\n}\n\nfunc (h *Handlers) runMigrations() {\n\th.db.AutoMigrate(&model.User{})\n}\n\nfunc main() {\n\t// Configurer les paramètres de la base de données.\n\tpsqlInfo := fmt.Sprintf(\"host=%s port=%d user=%s \"+\n\t\t\"password=%s dbname=%s sslmode=disable\",\n\t\tconfig.Host, config.Port, config.User, config.Password, config.DBName)\n\n\t// Se connecter à la base de données.\n\tdb, err := gorm.Open(postgres.Open(psqlInfo), &gorm.Config{})\n\tif err != nil {\n\t\tlog.Fatal(err)\n\t}\n\n\t// Lancer les migrations.\n\th := &Handlers{}\n\th.runMigrations()\n\n\t// Lancer l'authentification.\n\tjwtSigningKey, err := config.GetJWTSigningKey()\n\tif err != nil {\n\t\tlog.Fatal(err)\n\t}\n\n\t// Lancer le serveur GraphQL.\n\tsrv := &http.Server{\n\t\tAddr: \":5000\",\n\t}\n\thandlers, err := NewHandlers(db, jwtSigningKey)\n\tif err != nil {\n\t\tlog.Fatal(err)\n\t}\n\tgqlHandler := handlers.resolver.GraphQLHandler\n\tsrv.Handler = graphqlHandler(gqlHandler)\n\tlog.Fatal(srv.ListenAndServe())\n}\n", "langage": "go", "bugs_introduits": ["wrong_assignment_go", "syntax_error"], "corrections_appliquees": [], "timestamp": 1767008613.7694051, "tentative": 3}