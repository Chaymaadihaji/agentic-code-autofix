{"nom_fichier": "requirements.txt", "code": "from flask import Flask, render_template, request, redirect, url_for\nfrom flask_login import LoginManager, UserMixin, login_required, login_user, logout_user, current_user\nfrom flask_sqlalchemy import SQLAlchemy\nfrom flask_wtf import FlaskForm\nfrom wtforms import StringField, PasswordField, SubmitField\nfrom wtforms.validators import InputRequired, Email, EqualTo\nfrom werkzeug.security import generate_password_hash, check_password_hash\nimport pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nfrom sklearn.model_selection import train_test_split\nfrom sklearn import metrics\nfrom sklearn.linear_model import LogisticRegression\nfrom sklearn.model_selection import GridSearchCV\nfrom sklearn.metrics import accuracy_score\nfrom sklearn.decomposition import PCA\nimport pickle\n\napp = Flask(__name__)\napp.config['SECRET_KEY'] = 'secret_key'\napp.config['SQLALCHEMY_DATABASE_URI'] = 'sqlite:///database.db'\napp.config['SQLALCHEMY_TRACK_MODIFICATIONS'] = False\ndb = SQLAlchemy(app)\nlogin_manager = LoginManager()\nlogin_manager.init_app(app)\n\nclass User(db.Model, UserMixin):\n    id = db.Column(db.Integer, primary_key=True)\n    username = db.Column(db.String(64), unique=True, nullable=False)\n    email = db.Column(db.String(120), unique=True, nullable=False)\n    password = db.Column(db.String(128), nullable=False)\n    patient = db.relationship('Patient', backref='user', lazy=True)\n\nclass Patient(db.Model):\n    id = db.Column(db.Integer, primary_key=True)\n    name = db.Column(db.String(64), nullable=False)\n    birthdate = db.Column(db.DateTime, nullable=False)\n    user_id = db.Column(db.Integer, db.ForeignKey('user.id'), nullable=False)\n\nclass FichePatient(db.Model):\n    id = db.Column(db.Integer, primary_key=True)\n    patient_id = db.Column(db.Integer, db.ForeignKey('patient.id'), nullable=False)\n    medicament = db.Column(db.String(64), nullable=False)\n    dosage = db.Column(db.Integer, nullable=False)\n    patient = db.relationship('Patient', backref='fiche', lazy=True)\n\nclass Ordonnance(db.Model):\n    id = db.Column(db.Integer, primary_key=True)\n    patient_id = db.Column(db.Integer, db.ForeignKey('patient.id'), nullable=False)\n    medicament = db.Column(db.String(64), nullable=False)\n    dosage = db.Column(db.Integer, nullable=False)\n    patient = db.relationship('Patient', backref='ordonnance', lazy=True)\n\nclass RendezVous(db.Model):\n    id = db.Column(db.Integer, primary_key=True)\n    patient_id = db.Column(db.Integer, db.ForeignKey('patient.id'), nullable=False)\n    date = db.Column(db.DateTime, nullable=False)\n    patient = db.relationship('Patient', backref='rendezvous', lazy=True)\n\nclass AlerteMedicament(db.Model):\n    id = db.Column(db.Integer, primary_key=True)\n    patient_id = db.Column(db.Integer, db.ForeignKey('patient.id'), nullable=False)\n    medicament = db.Column(db.String(64), nullable=False)\n    patient = db.relationship('Patient', backref='alerte', lazy=True)\n\nclass DossierMedical(db.Model):\n    id = db.Column(db.Integer, primary_key=True)\n    patient_id = db.Column(db.Integer, db.ForeignKey('patient.id'), nullable=False)\n    fichier = db.Column(db.String(64), nullable=False)\n    patient = db.relationship('Patient', backref='dossier', lazy=True)\n\nclass GraphiqueSuiviSante(db.Model):\n    id = db.Column(db.Integer, primary_key=True)\n    patient_id = db.Column(db.Integer, db.ForeignKey('patient.id'), nullable=False)\n    fichier = db.Column(db.String(64), nullable=False)\n    patient = db.relationship('Patient', backref='graphique', lazy=True)\n\nclass RapportMedecin(db.Model):\n    id = db.Column(db.Integer, primary_key=True)\n    patient_id = db.Column(db.Integer, db.ForeignKey('patient.id'), nullable=False)\n    fichier = db.Column(db.String(64), nullable=False)\n    patient = db.relationship('Patient', backref='rapport', lazy=True)\n\nclass Formulaire(db.Model):\n    id = db.Column(db.Integer, primary_key=True)\n    patient_id = db.Column(db.Integer, db.ForeignKey('patient.id'), nullable=False)\n    medicament = db.Column(db.String(64), nullable=False)\n    dosage = db.Column(db.Integer, nullable=False)\n    patient = db.relationship('Patient', backref='formulaire', lazy=True)\n\nclass LoginForm(FlaskForm):\n    username = StringField('Username', validators=[InputRequired(), Email()])\n    password = PasswordField('Password', validators=[InputRequired()])\n    submit = SubmitField('Login')\n\nclass RegistrationForm(FlaskForm):\n    username = StringField('Username', validators=[InputRequired(), Email()])\n    password = PasswordField('Password', validators=[InputRequired()])\n    confirm_password = PasswordField('Confirm Password', validators=[InputRequired(), EqualTo('password')])\n    submit = SubmitField('Register')\n\n@login_manager.user_loader\ndef load_user(user_id):\n    return User.query.get(int(user_id))\n\n@app.route('/')\ndef index():\n    return render_template('index.html')\n\n@app.route('/login', methods=['GET', 'POST'])\ndef login():\n    form = LoginForm()\n    if form.validate_on_submit():\n        user = User.query.filter_by(username=form.username.data).first()\n        if user and check_password_hash(user.password, form.password.data):\n            login_user(user)\n            return redirect(url_for('dashboard'))\n    return render_template('login.html', form=form)\n\n@app.route('/register', methods=['GET', 'POST'])\ndef register():\n    form = RegistrationForm()\n    if form.validate_on_submit():\n        user = User(username=form.username.data, email=form.username.data, password=generate_password_hash(form.password.data))\n        db.session.add(user)\n        db.session.commit()\n        return redirect(url_for('login'))\n    return render_template('register.html', form=form)\n\n@app.route('/dashboard')\n@login_required\ndef dashboard():\n    patients = Patient.query.all()\n    return render_template('dashboard.html', patients=patients)\n\n@app.route('/patient/<int:patient_id>')\n@login_required\ndef patient(patient_id):\n    patient = Patient.query.get(patient_id)\n    fiches = FichePatient.query.filter_by(patient_id=patient.id).all()\n    ordonnances = Ordonnance.query.filter_by(patient_id=patient.id).all()\n    rendezvous = RendezVous.query.filter_by(patient_id=patient.id).all()\n    alertes = AlerteMedicament.query.filter_by(patient_id=patient.id).all()\n    dossier = DossierMedical.query.filter_by(patient_id=patient.id).first()\n    graphiques = GraphiqueSuiviSante.query.filter_by(patient_id=patient.id).all()\n    rapports = RapportMedecin.query.filter_by(patient_id=patient.id).all()\n    form = Formulaire()\n    return render_template('patient.html', patient=patient, fiches=fiches, ordonnances=ordonnances, rendezvous=rendezvous, alertes=alertes, dossier=dossier, graphiques=graphiques, rapports=rapports, form=form)\n\n@app.route('/formulaire', methods=['POST'])\n@login_required\ndef formulaire():\n    patient_id = request.form['patient_id']\n    medicament = request.form['medicament']\n    dosage = request.form['dosage']\n    patient = Patient.query.get(patient_id)\n    formulaire = Formulaire(patient_id=patient_id, medicament=medicament, dosage=int(dosage))\n    db.session.add(formulaire)\n    db.session.commit()\n    return 'Formulaire ajouté avec succès'\n\n@app.route('/ordonnance', methods=['POST'])\n@login_required\ndef ordonnance():\n    patient_id = request.form['patient_id']\n    medicament = request.form['medicament']\n    dosage = request.form['dosage']\n    patient = Patient.query.get(patient_id)\n    ordonnance = Ordonnance(patient_id=patient_id, medicament=medicament, dosage=int(dosage))\n    db.session.add(ordonnance)\n    db.session.commit()\n    return 'Ordonnance ajoutée avec succès'\n\n@app.route('/rendezvous', methods=['POST'])\n@login_required\ndef rendezvous():\n    patient_id = request.form['patient_id']\n    date = request.form['date']\n    patient = Patient.query.get(patient_id)\n    rendezvous = RendezVous(patient_id=patient_id, date=date)\n    db.session.add(rendezvous)\n    db.session.commit()\n    return 'Rendez-vous ajouté avec succès'\n\n@app.route('/alerte', methods=['POST'])\n@login_required\ndef alerte():\n    patient_id = request.form['patient_id']\n    medicament = request.form['medicament']\n    patient = Patient.query.get(patient_id)\n    alerte = AlerteMedicament(patient_id=patient_id, medicament=medicament)\n    db.session.add(alerte)\n    db.session.commit()\n    return 'Alerte ajoutée avec succès'\n\n@app.route('/dossier', methods=['POST'])\n@login_required\ndef dossier():\n    patient_id = request.form['patient_id']\n    fichier = request.form['fichier']\n    patient = Patient.query.get(patient_id)\n    dossier = DossierMedical(patient_id=patient_id, fichier=fichier)\n    db.session.add(dossier)\n    db.session.commit()\n    return 'Dossier médical ajouté avec succès'\n\n@app.route('/graphique', methods=['POST'])\n@login_required\ndef graphique():\n    patient_id = request.form['patient_id']\n    fichier = request.form['fichier']\n    patient = Patient.query.get(patient_id)\n    graphique = GraphiqueSuiviSante(patient_id=patient_id, fichier=fichier)\n    db.session.add(graphique)\n    db.session.commit()\n    return 'Graphique ajouté avec succès'\n\n@app.route('/rapport', methods=['POST'])\n@login_required\ndef rapport():\n    patient_id = request.form['patient_id']\n    fichier = request.form['fichier']\n    patient = Patient.query.get(patient_id)\n    rapport = RapportMedecin(patient_id=patient_id, fichier=fichier)\n    db.session.add(rapport)\n    db.session.commit()\n    return 'Rapport ajouté avec succès'\n\n@app.route('/logout')\n@login_required\ndef logout():\n    logout_user()\n    return redirect(url_for('index'))\n\nif __name__ == '__main__':\n    app.run(debug=True)\n", "timestamp": 1766765508.2631154}