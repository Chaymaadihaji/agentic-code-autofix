{"nom_fichier": "tests.py", "code": "# tests.py\n\nimport unittest\nfrom unittest.mock import MagicMock\nfrom app import db, create_app\nfrom app.models import Livre, Membre, Emprunt\nfrom app.services import LivreService, MembreService, EmpruntService\nfrom app.utils import generate_jwt\n\nclass TestApp(unittest.TestCase):\n\n    def setUp(self):\n        self.app = create_app('testing')\n        self.app_context = self.app.app_context()\n        self.app_context.push()\n        db.create_all()\n\n    def tearDown(self):\n        db.session.remove()\n        db.drop_all()\n        self.app_context.pop()\n\n    def test_livre_service(self):\n        service = LivreService(db.session)\n        livre = Livre titre='Le Seigneur des Anneaux', auteur='J.R.R. Tolkien'\n        db.session.add(livre)\n        db.session.commit()\n        livre = service.get_by_id(livre.id)\n        self.assertEqual(livre.titre, 'Le Seigneur des Anneaux')\n\n    def test_membre_service(self):\n        service = MembreService(db.session)\n        membre = Membre nom='Jean Dupont', email='jean.dupont@example.com'\n        db.session.add(membre)\n        db.session.commit()\n        membre = service.get_by_email(membre.email)\n        self.assertEqual(membre.nom, 'Jean Dupont')\n\n    def test_emprunt_service(self):\n        service = EmpruntService(db.session)\n        livre = Livre titre='Le Seigneur des Anneaux', auteur='J.R.R. Tolkien'\n        membre = Membre nom='Jean Dupont', email='jean.dupont@example.com'\n        db.session.add(livre)\n        db.session.add(membre)\n        db.session.commit()\n        emprunt = service.create(livre.id, membre.id)\n        self.assertIsNotNone(emprunt)\n\n    def test_authentification_jwt(self):\n        jwt = generate_jwt('jean.dupont@example.com')\n        self.assertIsNotNone(jwt)\n\nclass TestApi(unittest.TestCase):\n\n    def setUp(self):\n        self.app = create_app('testing')\n        self.app_context = self.app.app_context()\n        self.app_context.push()\n        db.create_all()\n\n    def tearDown(self):\n        db.session.remove()\n        db.drop_all()\n        self.app_context.pop()\n\n    def test_api_livres(self):\n        client = self.app.test_client()\n        response = client.get('/livres')\n        self.assertEqual(response.status_code, 200)\n\n    def test_api_membres(self):\n        client = self.app.test_client()\n        response = client.get('/membres')\n        self.assertEqual(response.status_code, 200)\n\n    def test_api_emprunts(self):\n        client = self.app.test_client()\n        response = client.get('/emprunts')\n        self.assertEqual(response.status_code, 200)\n\nif __name__ == \"__main__\":\n    unittest.main()\n", "timestamp": 1766864292.566699}