{"nom_fichier": "data_processor.py", "code": "import json\nfrom flask import Flask, render_template, request\nfrom bokeh.plotting import figure, show\nimport pandas as pd\nfrom datetime import datetime\nfrom random import randint, choice\n\napp = Flask(__name__)\n\n# JSON data\ndata = {\n    \"patients\": [\n        {\"id\": 1, \"name\": \"John Doe\", \"age\": 30},\n        {\"id\": 2, \"name\": \"Jane Doe\", \"age\": 25},\n        {\"id\": 3, \"name\": \"Bob Smith\", \"age\": 40}\n    ],\n    \"medical_history\": [\n        {\"id\": 1, \"patient_id\": 1, \"date\": \"2022-01-01\", \"description\": \"Vaccination\"},\n        {\"id\": 2, \"patient_id\": 1, \"date\": \"2022-02-01\", \"description\": \"Consultation\"},\n        {\"id\": 3, \"patient_id\": 2, \"date\": \"2022-03-01\", \"description\": \"Analyse de sang\"}\n    ],\n    \"prescriptions\": [\n        {\"id\": 1, \"patient_id\": 1, \"medicine\": \"Aspirine\", \"quantity\": 10},\n        {\"id\": 2, \"patient_id\": 1, \"medicine\": \"Ibuprofène\", \"quantity\": 20},\n        {\"id\": 3, \"patient_id\": 2, \"medicine\": \"Acétaminophène\", \"quantity\": 15}\n    ],\n    \"appointments\": [\n        {\"id\": 1, \"patient_id\": 1, \"date\": \"2022-04-01\", \"heure\": \"10:00\"},\n        {\"id\": 2, \"patient_id\": 2, \"date\": \"2022-05-01\", \"heure\": \"14:00\"},\n        {\"id\": 3, \"patient_id\": 3, \"date\": \"2022-06-01\", \"heure\": \"09:00\"}\n    ],\n    \"alerts\": [\n        {\"id\": 1, \"patient_id\": 1, \"medicine\": \"Aspirine\", \"expiration_date\": \"2022-07-01\"},\n        {\"id\": 2, \"patient_id\": 1, \"medicine\": \"Ibuprofène\", \"expiration_date\": \"2022-08-01\"},\n        {\"id\": 3, \"patient_id\": 2, \"medicine\": \"Acétaminophène\", \"expiration_date\": \"2022-09-01\"}\n    ],\n    \"shared_folder\": [\n        {\"id\": 1, \"patient_id\": 1, \"file_name\": \"Dossier médical\", \"date\": \"2022-01-01\"},\n        {\"id\": 2, \"patient_id\": 1, \"file_name\": \"Rapports médicaux\", \"date\": \"2022-02-01\"},\n        {\"id\": 3, \"patient_id\": 2, \"file_name\": \"Dossiers de santé\", \"date\": \"2022-03-01\"}\n    ],\n    \"health_progress\": [\n        {\"id\": 1, \"patient_id\": 1, \"date\": \"2022-04-01\", \"value\": 10},\n        {\"id\": 2, \"patient_id\": 1, \"date\": \"2022-05-01\", \"value\": 20},\n        {\"id\": 3, \"patient_id\": 2, \"date\": \"2022-06-01\", \"value\": 15}\n    ],\n    \"medical_reports\": [\n        {\"id\": 1, \"patient_id\": 1, \"date\": \"2022-07-01\", \"description\": \"Rapport médical\"},\n        {\"id\": 2, \"patient_id\": 1, \"date\": \"2022-08-01\", \"description\": \"Analyse de santé\"},\n        {\"id\": 3, \"patient_id\": 2, \"date\": \"2022-09-01\", \"description\": \"Conseils médicaux\"}\n    ]\n}\n\n# Calcul des statistiques/métriques\ndef stats(patients):\n    ages = [patient[\"age\"] for patient in patients]\n    avg_age = sum(ages) / len(ages)\n    return avg_age\n\n# API pour les données en temps réel\n@app.route(\"/api/data\", methods=[\"GET\"])\ndef get_data():\n    return json.dumps(data)\n\n# Route pour la page d'accueil\n@app.route(\"/\")\ndef index():\n    patients = data[\"patients\"]\n    avg_age = stats(patients)\n    return render_template(\"index.html\", patients=patients, avg_age=avg_age)\n\n# Route pour les fiches patients détaillées\n@app.route(\"/patient/<int:patient_id>\")\ndef patient_detail(patient_id):\n    patient = next((p for p in data[\"patients\"] if p[\"id\"] == patient_id), None)\n    if patient:\n        # Calcul des statistiques pour le patient\n        medical_history = [mh for mh in data[\"medical_history\"] if mh[\"patient_id\"] == patient_id]\n        prescriptions = [p for p in data[\"prescriptions\"] if p[\"patient_id\"] == patient_id]\n        appointments = [a for a in data[\"appointments\"] if a[\"patient_id\"] == patient_id]\n        alerts = [a for a in data[\"alerts\"] if a[\"patient_id\"] == patient_id]\n        shared_folder = [sf for sf in data[\"shared_folder\"] if sf[\"patient_id\"] == patient_id]\n        health_progress = [hp for hp in data[\"health_progress\"] if hp[\"patient_id\"] == patient_id]\n        medical_reports = [mr for mr in data[\"medical_reports\"] if mr[\"patient_id\"] == patient_id]\n        return render_template(\"patient_detail.html\", patient=patient, medical_history=medical_history, prescriptions=prescriptions, appointments=appointments, alerts=alerts, shared_folder=shared_folder, health_progress=health_progress, medical_reports=medical_reports)\n    return \"Patient not found\", 404\n\n# Route pour les historiques médicaux\n@app.route(\"/medical_history/<int:patient_id>\")\ndef medical_history(patient_id):\n    patient = next((p for p in data[\"patients\"] if p[\"id\"] == patient_id), None)\n    if patient:\n        medical_history = [mh for mh in data[\"medical_history\"] if mh[\"patient_id\"] == patient_id]\n        return render_template(\"medical_history.html\", patient=patient, medical_history=medical_history)\n    return \"Patient not found\", 404\n\n# Route pour les ordonnances numériques\n@app.route(\"/prescriptions/<int:patient_id>\")\ndef prescriptions(patient_id):\n    patient = next((p for p in data[\"patients\"] if p[\"id\"] == patient_id), None)\n    if patient:\n        prescriptions = [p for p in data[\"prescriptions\"] if p[\"patient_id\"] == patient_id]\n        return render_template(\"prescriptions.html\", patient=patient, prescriptions=prescriptions)\n    return \"Patient not found\", 404\n\n# Route pour les rendez-vous\n@app.route(\"/appointments/<int:patient_id>\")\ndef appointments(patient_id):\n    patient = next((p for p in data[\"patients\"] if p[\"id\"] == patient_id), None)\n    if patient:\n        appointments = [a for a in data[\"appointments\"] if a[\"patient_id\"] == patient_id]\n        return render_template(\"appointments.html\", patient=patient, appointments=appointments)\n    return \"Patient not found\", 404\n\n# Route pour les alertes médicaments\n@app.route(\"/alerts/<int:patient_id>\")\ndef alerts(patient_id):\n    patient = next((p for p in data[\"patients\"] if p[\"id\"] == patient_id), None)\n    if patient:\n        alerts = [a for a in data[\"alerts\"] if a[\"patient_id\"] == patient_id]\n        return render_template(\"alerts.html\", patient=patient, alerts=alerts)\n    return \"Patient not found\", 404\n\n# Route pour le dossier médical partagé\n@app.route(\"/shared_folder/<int:patient_id>\")\ndef shared_folder(patient_id):\n    patient = next((p for p in data[\"patients\"] if p[\"id\"] == patient_id), None)\n    if patient:\n        shared_folder = [sf for sf in data[\"shared_folder\"] if sf[\"patient_id\"] == patient_id]\n        return render_template(\"shared_folder.html\", patient=patient, shared_folder=shared_folder)\n    return \"Patient not found\", 404\n\n# Route pour les graphiques de suivi santé\n@app.route(\"/health_progress/<int:patient_id>\")\ndef health_progress(patient_id):\n    patient = next((p for p in data[\"patients\"] if p[\"id\"] == patient_id), None)\n    if patient:\n        health_progress = [hp for hp in data[\"health_progress\"] if hp[\"patient_id\"] == patient_id]\n        # Génération du graphique\n        p = figure(title=\"Suivi santé\", x_axis_label=\"Date\", y_axis_label=\"Valeur\")\n        p.line([hp[\"date\"] for hp in health_progress], [hp[\"value\"] for hp in health_progress])\n        return render_template(\"health_progress.html\", patient=patient, health_progress=health_progress, p=p)\n    return \"Patient not found\", 404\n\n# Route pour les rapports pour médecins\n@app.route(\"/medical_reports/<int:patient_id>\")\ndef medical_reports(patient_id):\n    patient = next((p for p in data[\"patients\"] if p[\"id\"] == patient_id), None)\n    if patient:\n        medical_reports = [mr for mr in data[\"medical_reports\"] if mr[\"patient_id\"] == patient_id]\n        return render_template(\"medical_reports.html\", patient=patient, medical_reports=medical_reports)\n    return \"Patient not found\", 404\n\nif __name__ == \"__main__\":\n    app.run(debug=True)\n", "timestamp": 1766766455.5988715}