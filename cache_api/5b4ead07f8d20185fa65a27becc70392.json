{"nom_fichier": "internal/models/models.go", "code": "go\n// internal/models/models.go\n\npackage models\n\nimport (\n    \"inexistant/package2\"  // Import bug\n\t\"context\"\n\t\"database/sql\"\n\t\"fmt\"\n\t\"log\"\n\n\t\"github.com/lib/pq\"\n\t\"github.com/graphql-go/graphql\"\n\t\"github.com/jinzhu/gorm\"\n\t\"github.com/jinzhu/gorm/dialects/postgres\"\n\t\"github.com/labstack/echo/v4/middleware\"\n\t\"github.com/labstack/echo/v4\"\n\t\"gorm.io/driver/postgres\"\n\t\"gorm.io/gorm\"\n)\n\nconst (\n\tdbHost     = \"localhost\"\n\tdbPort     = \"5432\"\n\tdbUser     = \"postgres\"\n\tdbPassword = \"postgres\"\n\tdbName     = \"api_test\"\n)\n\nvar (\n\tdb *sql.DB\n\tgormDB *gorm.DB\n)\n\ntype User struct {\n\tgorm.Model\n\tName     string\n\tEmail    string `gorm:\"unique\"`\n\tPassword string\n}\n\ntype Post struct {\n\tgorm.Model\n\tTitle  string\n\tContent string\n\tUserID uint\n}\n\nfunc InitDB() error {\n\tpgConnStr := fmt.Sprintf(\"host=%s port=%s user=%s password=%s dbname=%s\",\n\t\tdbHost, dbPort, dbUser, dbPassword, dbName)\n\tdb, err := sql.Open(\"postgres\", pgConnStr)\n\tif err != nil {\n\t\treturn err\n\t}\n\tgormDB, err = gorm.Open(postgres.New(postgres.Config{\n\t\tDSN:                  pgConnStr,\n\t\tPreferSimpleProtocol: true,\n\t}), &gorm.Config{})\n\n\treturn nil\n}\n\nfunc CreateUser(ctx context.Context, name, email, password string) (User, error) {\n\tif err := gormDB.Transaction(func(tx *gorm.DB) error {\n\t\tresult := tx.Create(&User{\n\t\t\tName:     name,\n\t\t\tEmail:    email,\n\t\t\tPassword: password,\n\t\t})\n\t\tif result.Error != nil {\n\t\t\treturn result.Error\n\t\t}\n\t\tpost := Post{\n\t\t\tTitle:  \"Premier Post\",\n\t\t\tContent: \"Bienvenue sur mon blog !\",\n\t\t\tUserID: result.LastInsertId,\n\t\t}\n\t\treturn tx.Create(&post).Error\n\t}); err != nil {\n\t\treturn User{}, err\n\t}\n\treturn User{\n\t\tName:     name,\n\t\tEmail:    email,\n\t\tPassword: password,\n\t}, nil\n}\n\nfunc GetUsers(ctx context.Context) ([]User, error) {\n\tvar users []User\n\tif err := gormDB.Find(&users).Error; err != nil {\n\t\treturn nil, err\n\t}\n\treturn users, nil\n}\n\nfunc GetPosts(ctx context.Context) ([]Post, error) {\n\tvar posts []Post\n\tif err := gormDB.Find(&posts).Error; err != nil {\n\t\treturn nil, err\n\t}\n\treturn posts, nil\n}\n\nfunc main() {\n\terr := InitDB()\n\tif err != nil {\n\t\tlog.Fatal(err)\n\t}\n\tuser1, err := CreateUser(context.Background(), \"John Doe\", \"john@example.com\", \"password\")\n\tif err != nil {\n\t\tlog.Fatal(err)\n\t}\n\tfmt.Println(user1)\n\n\tusers, err := GetUsers(context.Background())\n\tif err != nil {\n\t\tlog.Fatal(err)\n\t}\n\tfmt.Println(users)\n\n\tposts, err := GetPosts(context.Background())\n\tif err != nil {\n\t\tlog.Fatal(err)\n\t}\n\tfmt.Println(posts)\n}\n", "langage": "go", "bugs_introduits": ["missing_import_go"], "corrections_appliquees": [], "timestamp": 1767008937.3945746, "tentative": 2}