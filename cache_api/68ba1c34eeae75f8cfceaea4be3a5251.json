{"nom_fichier": "app.py", "code": "# app.py\n\nimport os\nimport json\nfrom flask import Flask, render_template, request, jsonify\nfrom flask_sqlalchemy import SQLAlchemy\nfrom flask_bcrypt import Bcrypt\nfrom flask_login import LoginManager, UserMixin, login_user, logout_user, login_required, current_user\nfrom flask_bootstrap import Bootstrap\nfrom flask_wtf import FlaskForm\nfrom wtforms import StringField, PasswordField, SubmitField\nfrom wtforms.validators import DataRequired, Email, EqualTo\nfrom datetime import datetime\n\napp = Flask(__name__)\napp.config['SECRET_KEY'] = 'secret_key_here'\napp.config['SQLALCHEMY_DATABASE_URI'] = 'sqlite:///database.db'\napp.config['SQLALCHEMY_TRACK_MODIFICATIONS'] = False\n\ndb = SQLAlchemy(app)\nbcrypt = Bcrypt(app)\nlogin_manager = LoginManager(app)\nlogin_manager.login_view = 'login'\nlogin_manager.login_message_category = 'info'\nbootstrap = Bootstrap(app)\n\nclass User(UserMixin, db.Model):\n    id = db.Column(db.Integer, primary_key=True)\n    username = db.Column(db.String(64), unique=True, nullable=False)\n    email = db.Column(db.String(120), unique=True, nullable=False)\n    password = db.Column(db.String(128), nullable=False)\n    fiches_patients = db.relationship('FichePatient', backref='user', lazy=True)\n\nclass FichePatient(db.Model):\n    id = db.Column(db.Integer, primary_key=True)\n    patient_name = db.Column(db.String(64), nullable=False)\n    patient_age = db.Column(db.Integer, nullable=False)\n    user_id = db.Column(db.Integer, db.ForeignKey('user.id'), nullable=False)\n\nclass Ordonnance(db.Model):\n    id = db.Column(db.Integer, primary_key=True)\n    patient_id = db.Column(db.Integer, db.ForeignKey('fiche_patient.id'), nullable=False)\n    medicament = db.Column(db.String(64), nullable=False)\n    quantite = db.Column(db.Integer, nullable=False)\n\nclass RendezVous(db.Model):\n    id = db.Column(db.Integer, primary_key=True)\n    patient_id = db.Column(db.Integer, db.ForeignKey('fiche_patient.id'), nullable=False)\n    date = db.Column(db.DateTime, nullable=False)\n    heure = db.Column(db.String(64), nullable=False)\n\nclass AlerteMedicament(db.Model):\n    id = db.Column(db.Integer, primary_key=True)\n    medicament = db.Column(db.String(64), nullable=False)\n    alerte = db.Column(db.Boolean, nullable=False)\n\nclass DossierMedical(db.Model):\n    id = db.Column(db.Integer, primary_key=True)\n    patient_id = db.Column(db.Integer, db.ForeignKey('fiche_patient.id'), nullable=False)\n    dossier = db.Column(db.Text, nullable=False)\n\nclass GraphiqueSuiviSante(db.Model):\n    id = db.Column(db.Integer, primary_key=True)\n    patient_id = db.Column(db.Integer, db.ForeignKey('fiche_patient.id'), nullable=False)\n    valeur = db.Column(db.Float, nullable=False)\n\nclass RapportMedicin(db.Model):\n    id = db.Column(db.Integer, primary_key=True)\n    patient_id = db.Column(db.Integer, db.ForeignKey('fiche_patient.id'), nullable=False)\n    rapport = db.Column(db.Text, nullable=False)\n\nclass FormulaireFichePatient(FlaskForm):\n    patient_name = StringField('Nom du patient', validators=[DataRequired()])\n    patient_age = StringField('Age du patient', validators=[DataRequired()])\n    submit = SubmitField('Soumettre')\n\nclass FormulaireOrdonnance(FlaskForm):\n    medicament = StringField('Medicament', validators=[DataRequired()])\n    quantite = StringField('Quantite', validators=[DataRequired()])\n    submit = SubmitField('Soumettre')\n\nclass FormulaireRendezVous(FlaskForm):\n    date = StringField('Date', validators=[DataRequired()])\n    heure = StringField('Heure', validators=[DataRequired()])\n    submit = SubmitField('Soumettre')\n\nclass FormulaireAlerteMedicament(FlaskForm):\n    medicament = StringField('Medicament', validators=[DataRequired()])\n    alerte = StringField('Alerte', validators=[DataRequired()])\n    submit = SubmitField('Soumettre')\n\nclass FormulaireDossierMedical(FlaskForm):\n    dossier = StringField('Dossier', validators=[DataRequired()])\n    submit = SubmitField('Soumettre')\n\nclass FormulaireGraphiqueSuiviSante(FlaskForm):\n    valeur = StringField('Valeur', validators=[DataRequired()])\n    submit = SubmitField('Soumettre')\n\nclass FormulaireRapportMedicin(FlaskForm):\n    rapport = StringField('Rapport', validators=[DataRequired()])\n    submit = SubmitField('Soumettre')\n\n@app.route('/')\ndef index():\n    return render_template('index.html')\n\n@app.route('/fiche_patient', methods=['GET', 'POST'])\ndef fiche_patient():\n    form = FormulaireFichePatient()\n    if form.validate_on_submit():\n        patient_name = form.patient_name.data\n        patient_age = form.patient_age.data\n        fiche_patient = FichePatient(patient_name=patient_name, patient_age=patient_age, user_id=current_user.id)\n        db.session.add(fiche_patient)\n        db.session.commit()\n        return redirect(url_for('fiche_patient'))\n    return render_template('fiche_patient.html', form=form)\n\n@app.route('/ordonnance', methods=['GET', 'POST'])\ndef ordonnance():\n    form = FormulaireOrdonnance()\n    if form.validate_on_submit():\n        medicament = form.medicament.data\n        quantite = form.quantite.data\n        ordonnance = Ordonnance(medicament=medicament, quantite=quantite, patient_id=current_user.fiches_patients[-1].id)\n        db.session.add(ordonnance)\n        db.session.commit()\n        return redirect(url_for('ordonnance'))\n    return render_template('ordonnance.html', form=form)\n\n@app.route('/rendez_vous', methods=['GET', 'POST'])\ndef rendez_vous():\n    form = FormulaireRendezVous()\n    if form.validate_on_submit():\n        date = form.date.data\n        heure = form.heure.data\n        rendez_vous = RendezVous(date=date, heure=heure, patient_id=current_user.fiches_patients[-1].id)\n        db.session.add(rendez_vous)\n        db.session.commit()\n        return redirect(url_for('rendez_vous'))\n    return render_template('rendez_vous.html', form=form)\n\n@app.route('/alerte_medicament', methods=['GET', 'POST'])\ndef alerte_medicament():\n    form = FormulaireAlerteMedicament()\n    if form.validate_on_submit():\n        medicament = form.medicament.data\n        alerte = form.alerte.data\n        alerte_medicament = AlerteMedicament(medicament=medicament, alerte=alerte)\n        db.session.add(alerte_medicament)\n        db.session.commit()\n        return redirect(url_for('alerte_medicament'))\n    return render_template('alerte_medicament.html', form=form)\n\n@app.route('/dossier_medical', methods=['GET', 'POST'])\ndef dossier_medical():\n    form = FormulaireDossierMedical()\n    if form.validate_on_submit():\n        dossier = form.dossier.data\n        dossier_medical = DossierMedical(dossier=dossier, patient_id=current_user.fiches_patients[-1].id)\n        db.session.add(dossier_medical)\n        db.session.commit()\n        return redirect(url_for('dossier_medical'))\n    return render_template('dossier_medical.html', form=form)\n\n@app.route('/graphique_suivi_sante', methods=['GET', 'POST'])\ndef graphique_suivi_sante():\n    form = FormulaireGraphiqueSuiviSante()\n    if form.validate_on_submit():\n        valeur = form.valeur.data\n        graphique_suivi_sante = GraphiqueSuiviSante(valeur=valeur, patient_id=current_user.fiches_patients[-1].id)\n        db.session.add(graphique_suivi_sante)\n        db.session.commit()\n        return redirect(url_for('graphique_suivi_sante'))\n    return render_template('graphique_suivi_sante.html', form=form)\n\n@app.route('/rapport_medicin', methods=['GET', 'POST'])\ndef rapport_medicin():\n    form = FormulaireRapportMedicin()\n    if form.validate_on_submit():\n        rapport = form.rapport.data\n        rapport_medicin = RapportMedicin(rapport=rapport, patient_id=current_user.fiches_patients[-1].id)\n        db.session.add(rapport_medicin)\n        db.session.commit()\n        return redirect(url_for('rapport_medicin'))\n    return render_template('rapport_medicin.html', form=form)\n\n@app.route('/login', methods=['GET', 'POST'])\ndef login():\n    if request.method == 'POST':\n        username = request.form['username']\n        password = request.form['password']\n        user = User.query.filter_by(username=username).first()\n        if user and bcrypt.check_password_hash(user.password, password):\n            login_user(user)\n            return redirect(url_for('index'))\n    return render_template('login.html')\n\n@app.route('/register', methods=['GET', 'POST'])\ndef register():\n    if request.method == 'POST':\n        username = request.form['username']\n        email = request.form['email']\n        password = bcrypt.generate_password_hash(request.form['password']).decode('utf-8')\n        user = User(username=username, email=email, password=password)\n        db.session.add(user)\n        db.session.commit()\n        return redirect(url_for('login'))\n    return render_template('register.html')\n\n@app.route('/logout')\ndef logout():\n    logout_user()\n    return redirect(url_for('index'))\n\nif __name__ == '__main__':\n    db.create_all()\n    app.run(debug=True)\n", "timestamp": 1766765533.4485226}