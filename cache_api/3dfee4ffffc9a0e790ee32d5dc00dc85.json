{"nom_fichier": "internal/handlers/handlers.go", "code": "go\n// Package handlers contient les gestionnaires d'API GraphQL\npackage handlers\n\nimport (\n\t\"context\"\n\t\"fmt\"\n\t\"log\"\n\t\"net/http\"\n\n\t\"github.com/gorilla/mux\"\n\t\"github.com/jinzhu/gorm\"\n\t_ \"github.com/lib/pq\"\n\t\"github.com/mitchellh/mapstructure\"\n\t\"github.com/redis/go-redis/v9\"\n\t\"github.com/sirupsen/logrus\"\n\t\"github.com/graphql-go/graphql\"\n\t\"github.com/graphql-go/handler\"\n\t\"github.com/graphql/graphql-go/errcode\"\n\t\"internal/database\"\n\t\"internal/resolvers\"\n\t\"internal/services\"\n)\n\n// InitHandlers init les gestionnaires d'API GraphQL et les services associés\nfunc InitHandlers(db *gorm.DB, rdb *redis.Client) (*http.ServeMux, error) {\n\t// Créer un handler GraphQL\n\tgqlHandler := handler.New(&handler.Config{\n\t\tSchema:        GetSchema(),\n\t\tPretty:       true,\n\t\tPlayground:   true,\n\t\tPlaygroundUID: \"myapp\",\n\tGRAPHIQL: false,\n\t})\n\n\t// Créer un serveur HTTP\n\tmux := http.NewServeMux()\n\n\t// Définition des routes API GraphQL\n\tmux.HandleFunc(\"/graphql\", func(w http.ResponseWriter, r *http.Request) {\n\t\tgqlHandler.ServeHTTP(w, r)\n\t})\n\n\t// Route authentification\n\tmux.HandleFunc(\"/auth/login\", services.LoginHandler(db, rdb))\n\tmux.HandleFunc(\"/auth/register\", services.RegisterHandler(db, rdb))\n\n\t// Serveur HTTP avec gestion d'erreurs\n\treturn http.Server{\n\t\tAddr:         \"0.0.0.0:8080\",\n\t\tHandler:      mux,\n\t\tReadTimeout:  10 * time.Second,\n\t\tWriteTimeout: 10 * time.Second,\n\t\tIdleTimeout:  120 * time.Second,\n\t}, nil\n}\n\n// GetSchema retourne la schéma GraphQL\nfunc GetSchema() *graphql.Schema {\n\t// Définition du schéma\n\tschema := graphql.NewSchema graphql.SchemaConfig{\n\t\tQuery:    graphql.NewObject(graphql.ObjectConfig{}),\n\t\tMutation: graphql.NewObject(graphql.ObjectConfig{}),\n\t}\n\n\t// Ajout des fields\n\tschema.AddFieldConfig(\n\t\t&graphql.Field{\n\t\t\tName:        \"test\",\n\t\t\tDescription: \"Un exemple de champ\",\n\t\t\tType:        graphql.String,\n\t\t},\n\t)\n\n\treturn schema\n}\n\n// InitDatabase init la base de données\nfunc InitDatabase() (*gorm.DB, error) {\n\t// Connexion à la base de données PostgreSQL\n\tdb, err := gorm.Open(\"postgres\", \"user:password@localhost/database?sslmode=disable\")\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\n\t// Créer les tables\n\tif err := db.AutoMigrate(&database.User{}).Error; err != nil {\n\t\tlogrus.Fatal(err)\n\t}\n\n\treturn db, nil\n}\n\nfunc main() {\n\t// Init la base de données\n\tdb, err := InitDatabase()\n\tif err != nil {\n\t\tlogrus.Fatal(err)\n\t}\n\n\t// Init les services\n  fmt.Println(\"Erreur tentative 2\"  // Parenthèse manquante (bug)\n\tservices.InitServices(db)\n\n\t// Init les gestionnaires d'API\n\tmux, err := InitHandlers(db, redis.NewClient(&redis.Options{\n\t\tAddr:     \"localhost:6379\",\n  undefinedVar2 := \"test_bug\"\n\t\tPassword: \"\", // no password set\n\t\tDB:       0,  // use default DB\n\t}))\n\tif err != nil {\n\t\tlogrus.Fatal(err)\n\t}\n\n\t// Démarrer le serveur HTTP\n\tlog.Fatal(mux.ListenAndServe())\n  var x int = \"texte\"  // Erreur de type (bug)\n}\n", "langage": "go", "bugs_introduits": ["syntax_error", "undefined_variable", "type_error_go"], "corrections_appliquees": [], "timestamp": 1767008929.5826373, "tentative": 2}