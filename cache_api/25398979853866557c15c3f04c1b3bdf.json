{"nom_fichier": "models.py", "code": "python\n# models.py\nfrom pydantic import BaseModel\nfrom typing import Optional\nfrom datetime import datetime\nfrom passlib.context import CryptContext\n\nSECRET_KEY = \"09d25e094faa6ca2556c818166b7a9563b93f7099f6f0f4caa6cf63b88e8d3e7\"\nALGORITHM = \"HS256\"\nACCESS_TOKEN_EXPIRE_MINUTES = 30\nCORS_ALLOWED_ORIGIN = [\"*\"]\nCORS_ALLOWED_METHODS = [\"*\"]\nCORS_ALLOWED_HEADERS = [\"*\"]\n\n# Define the database model\nfrommotor import MotorClient\n\nclient = MotorClient(\"mongodb://localhost:27017\")\n\ndb = client[\"api_database\"]\ncollection = db[\"users\"]\n\nclass User(BaseModel):\n    \"\"\"User model\"\"\"\n    id: Optional[str] = None\n    username: str\n    email: str\n    password: str\n\n    class Config:\n        anystr_strip_whitespace = True\n\ndef get_password_hash(password: str):\n    \"\"\"Hash a password\"\"\"\n    pwd_context = CryptContext(\n        schemes=[\"pbkdf2SHA256\"],\n        default=\"pbkdf2SHA256\",\n        pbkdf2_sha256__min_rounds=20000,\n    )\n\n    return pwd_context.hash(password)\n\ndef verify_password(plain_password: str, hashed_password: str):\n    \"\"\"Verify a password\"\"\"\n    pwd_context = CryptContext(\n        schemes=[\"pbkdf2SHA256\"],\n        default=\"pbkdf2SHA256\",\n        pbkdf2_sha256__min_rounds=20000,\n    )\n\n    return pwd_context.verify(plain_password, hashed_password)\n\nclass PyObjectId(BaseModel):\n    \"\"\"PyObjectId model\"\"\"\n    def __init__(self, value: Optional[str] = None):\n        self.id = str(value)  # Store it as string\n        if value is not None:\n            try:\n                PydanticObjectId(value)\n            except ValidationError:\n                raise ValueError(\"invalid ObjectId\")\nclass PyObjectBase BaseModel):\n    id: PyObjectId = PyObjectId(None)\n\nclass Token(BaseModel):\n    access_token: str\n    token_type: str\n\nclass TokenData(BaseModel):\n    username: str | None = None\n\nclass ItemBase(BaseModel):\n    title: str | None = None\n    description: str | None = None\n\nclass Item(ItemBase):\n    id: PyObjectId = PyObjectId(None)\n    user_id: PyObjectId = PyObjectId(None)\n\n    class Config:\n        anystr_strip_whitespace = True\n\nclass ItemCreate(ItemBase):\n    pass\n", "langage": "python", "bugs_introduits": [], "corrections_appliquees": [], "timestamp": 1767107204.874122, "tentative": 4}