{"nom_fichier": "README.md", "code": "from flask import Flask, render_template, request, redirect, url_for\nfrom flask_sqlalchemy import SQLAlchemy\nfrom flask_login import LoginManager, UserMixin, login_user, login_required, logout_user\nfrom flask_bcrypt import Bcrypt\nfrom flask_email import Email\nfrom flask_sms import SMS\nfrom flask_bootstrap import Bootstrap\n\napp = Flask(__name__)\napp.config['SECRET_KEY'] = 'secret_key'\napp.config['SQLALCHEMY_DATABASE_URI'] = 'sqlite:///database.db'\n\ndb = SQLAlchemy(app)\nbcrypt = Bcrypt(app)\nemail = Email(app)\nsms = SMS(app)\nbootstrap = Bootstrap(app)\n\nlogin_manager = LoginManager()\nlogin_manager.init_app(app)\n\nclass Utilisateur(UserMixin, db.Model):\n    id = db.Column(db.Integer, primary_key=True)\n    username = db.Column(db.String(80), unique=True, nullable=False)\n    mot_de_passe = db.Column(db.String(120), nullable=False)\n    email = db.Column(db.String(120), unique=True, nullable=False)\n    historique_connexion = db.relationship('HistoriqueConnexion', backref='utilisateur', lazy=True)\n\n    def set_password(self, mot_de_passe):\n        self.mot_de_passe = bcrypt.generate_password_hash(mot_de_passe).decode('utf-8')\n\n    def check_password(self, mot_de_passe):\n        return bcrypt.check_password_hash(self.mot_de_passe, mot_de_passe)\n\nclass HistoriqueConnexion(db.Model):\n    id = db.Column(db.Integer, primary_key=True)\n    utilisateur_id = db.Column(db.Integer, db.ForeignKey('utilisateur.id'), nullable=False)\n    date = db.Column(db.DateTime, nullable=False)\n\n@login_manager.user_loader\ndef load_utilisateur(id):\n    return Utilisateur.query.get(int(id))\n\n@app.route('/')\ndef index():\n    return render_template('index.html')\n\n@app.route('/login', methods=['GET', 'POST'])\ndef login():\n    if request.method == 'POST':\n        username = request.form['username']\n        mot_de_passe = request.form['mot_de_passe']\n        utilisateur = Utilisateur.query.filter_by(username=username).first()\n        if utilisateur and utilisateur.check_password(mot_de_passe):\n            login_user(utilisateur)\n            return redirect(url_for('historique'))\n    return render_template('login.html')\n\n@app.route('/register', methods=['GET', 'POST'])\ndef register():\n    if request.method == 'POST':\n        username = request.form['username']\n        mot_de_passe = request.form['mot_de_passe']\n        email = request.form['email']\n        utilisateur = Utilisateur(username=username, mot_de_passe=mot_de_passe, email=email)\n        utilisateur.set_password(mot_de_passe)\n        db.session.add(utilisateur)\n        db.session.commit()\n        return redirect(url_for('login'))\n    return render_template('register.html')\n\n@app.route('/reset', methods=['GET', 'POST'])\ndef reset():\n    if request.method == 'POST':\n        email = request.form['email']\n        utilisateur = Utilisateur.query.filter_by(email=email).first()\n        if utilisateur:\n            # Envoi du code de réinitialisation via SMS\n            sms.send_code(utilisateur)\n            return redirect(url_for('reset_code'))\n    return render_template('reset.html')\n\n@app.route('/reset_code', methods=['GET', 'POST'])\ndef reset_code():\n    if request.method == 'POST':\n        code = request.form['code']\n        utilisateur = Utilisateur.query.filter_by(email=email).first()\n        if utilisateur:\n            # Réinitialisation du mot de passe\n            utilisateur.mot_de_passe = request.form['new_mdp']\n            utilisateur.set_password(utilisateur.mot_de_passe)\n            db.session.commit()\n            return redirect(url_for('login'))\n    return render_template('reset_code.html')\n\n@app.route('/historique')\n@login_required\ndef historique():\n    historiques = HistoriqueConnexion.query.all()\n    return render_template('historique.html', historiques=historiques)\n\nif __name__ == '__main__':\n    app.run(debug=True)\n", "timestamp": 1766865228.171212}