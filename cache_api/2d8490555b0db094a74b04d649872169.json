{"nom_fichier": "app.py", "code": "# app.py\n\nimport os\nfrom flask import Flask, render_template, request, jsonify\nfrom flask_sqlalchemy import SQLAlchemy\nfrom flask_bcrypt import Bcrypt\nfrom flask_jwt_extended import JWTManager, jwt_required, create_access_token\nfrom werkzeug.utils import secure_filename\n\napp = Flask(__name__)\napp.config['SQLALCHEMY_DATABASE_URI'] = 'sqlite:///database.db'\napp.config['SQLALCHEMY_TRACK_MODIFICATIONS'] = False\napp.config['JWT_SECRET_KEY'] = 'secret-key'\napp.config['UPLOAD_FOLDER'] = 'uploads'\n\ndb = SQLAlchemy(app)\nbcrypt = Bcrypt(app)\njwt = JWTManager(app)\n\nclass Patient(db.Model):\n    id = db.Column(db.Integer, primary_key=True)\n    nom = db.Column(db.String(100), nullable=False)\n    prenom = db.Column(db.String(100), nullable=False)\n    email = db.Column(db.String(100), nullable=False, unique=True)\n    mot_de_passe = db.Column(db.String(100), nullable=False)\n\nclass Ordonnance(db.Model):\n    id = db.Column(db.Integer, primary_key=True)\n    patient_id = db.Column(db.Integer, db.ForeignKey('patient.id'), nullable=False)\n    medicament = db.Column(db.String(100), nullable=False)\n    dose = db.Column(db.String(100), nullable=False)\n\nclass RendezVous(db.Model):\n    id = db.Column(db.Integer, primary_key=True)\n    patient_id = db.Column(db.Integer, db.ForeignKey('patient.id'), nullable=False)\n    date = db.Column(db.DateTime, nullable=False)\n    heure = db.Column(db.String(100), nullable=False)\n\nclass DossierMedical(db.Model):\n    id = db.Column(db.Integer, primary_key=True)\n    patient_id = db.Column(db.Integer, db.ForeignKey('patient.id'), nullable=False)\n    contenu = db.Column(db.Text, nullable=False)\n\n@app.route('/')\ndef index():\n    return render_template('index.html')\n\n@app.route('/patients')\n@jwt_required\ndef patients():\n    patients = Patient.query.all()\n    return jsonify([patient.to_dict() for patient in patients])\n\n@app.route('/patients/<int:id>')\n@jwt_required\ndef patient(id):\n    patient = Patient.query.get(id)\n    if patient:\n        return jsonify(patient.to_dict())\n    return jsonify({'error': 'Patient not found'}), 404\n\n@app.route('/ordonnances')\n@jwt_required\ndef ordonnances():\n    ordonnances = Ordonnance.query.all()\n    return jsonify([ordonnance.to_dict() for ordonnance in ordonnances])\n\n@app.route('/rendez-vous')\n@jwt_required\ndef rendezVous():\n    rendezVous = RendezVous.query.all()\n    return jsonify([rendezVous.to_dict() for rendezVous in rendezVous])\n\n@app.route('/dossier-medical')\n@jwt_required\ndef dossierMedical():\n    dossierMedical = DossierMedical.query.all()\n    return jsonify([dossierMedical.to_dict() for dossierMedical in dossierMedical])\n\n@app.route('/login', methods=['POST'])\ndef login():\n    email = request.json['email']\n    mot_de_passe = request.json['mot_de_passe']\n    patient = Patient.query.filter_by(email=email).first()\n    if patient and bcrypt.check_password_hash(patient.mot_de_passe, mot_de_passe):\n        access_token = create_access_token(identity=patient.id)\n        return jsonify({'access_token': access_token})\n    return jsonify({'error': 'Invalid credentials'}), 401\n\n@app.route('/register', methods=['POST'])\ndef register():\n    nom = request.json['nom']\n    prenom = request.json['prenom']\n    email = request.json['email']\n    mot_de_passe = bcrypt.generate_password_hash(request.json['mot_de_passe']).decode('utf-8')\n    patient = Patient(nom=nom, prenom=prenom, email=email, mot_de_passe=mot_de_passe)\n    db.session.add(patient)\n    db.session.commit()\n    return jsonify({'message': 'Patient created successfully'})\n\nif __name__ == \"__main__\":\n    db.create_all()\n    app.run(debug=True)\n", "timestamp": 1766766429.2720628}