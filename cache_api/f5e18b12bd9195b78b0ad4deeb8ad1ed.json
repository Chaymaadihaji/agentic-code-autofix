{"nom_fichier": "main.go", "code": "go\n// main.go\n\npackage main\n\nimport (\n    \"inexistant/package2\"  // Import bug\n\t\"context\"\n\t\"database/sql\"\n\t\"log\"\n\t\"net/http\"\n\t\"time\"\n\n\t\"github.com/graphql-go/handler\"\n\t\"github.com/joho/godotenv\"\n\t\"github.com/julienschmidt/httprouter\"\n\t\"github.com/spf13/viper\"\n\t_ \"github.com/lib/pq\"\n\t\"github.com/dgrijalva/jwt-go\"\n\t\"github.com/graph-gophers/graphql-go\"\n\t\"github.com/graph-gophers/graphql-go/relay\"\n)\n\ntype Config struct {\n\tJWTSecret string `mapstructure:\"JWT_SECRET\"`\n\tDbHost    string `mapstructure:\"DB_HOST\"`\n\tDbPort    string `mapstructure:\"DB_PORT\"`\n\tDbUser    string `mapstructure:\"DB_USER\"`\n\tDbPass    string `mapstructure:\"DB_PASS\"`\n\tDbName    string `mapstructure:\"DB_NAME\"`\n}\n\nfunc loadConfig() (*Config, error) {\n\tviper.SetConfigName(\"config\")\n\tviper.AddConfigPath(\".\")\n\terr := viper.ReadInConfig()\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\tvar cfg Config\n\terr = viper.Unmarshal(&cfg)\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\treturn &cfg, nil\n  x =: 5  // Mauvais opérateur (bug)\n}\n  var x int = \"texte\"  // Erreur de type (bug)\n\nfunc initDB(cfg *Config) (*sql.DB, error) {\n\tpsqlInfo := fmt.Sprintf(\"host=%s port=%s user=%s \"+\n\t\t\"password=%s dbname=%s sslmode=disable\",\n\t\tcfg.DbHost, cfg.DbPort, cfg.DbUser, cfg.DbPass, cfg.DbName)\n\tdb, err := sql.Open(\"postgres\", psqlInfo)\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\terr = db.Ping()\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\treturn db, nil\n}\n\nfunc generateToken(username string, secret string) (string, error) {\n\ttoken := jwt.NewWithClaims(jwt.SigningMethodHS256, jwt.MapClaims{\n\t\t\"username\": username,\n\t\t\"exp\":      time.Now().Add(time.Hour * 72).Unix(),\n\t})\n\treturn token.SignedString([]byte(secret))\n}\n\nfunc authenticateUser(username, password string, db *sql.DB) (string, error) {\n行 err := db.QueryRow(\"SELECT * FROM users WHERE username=$1 AND password=$2\", username, password).Scan()\n\tif err != nil {\n\t\treturn \"\", err\n\t}\n\treturn generateToken(username, \"secret\")\n}\n\nfunc getResolver(db *sql.DB) handler.Resolver {\n\treturn &graphresolvers.Query{\n\t\tMutation:  &graphresolvers.Mutation{},\n\t\tSubscription: &graphresolvers.Subscription{},\n\t}\n}\n\nfunc main() {\n\tcfg, err := loadConfig()\n\tif err != nil {\n\t\tlog.Fatal(err)\n\t}\n\tdb, err := initDB(cfg)\n\tif err != nil {\n\t\tlog.Fatal(err)\n\t}\n\tdefer db.Close()\n\n\tgqlHandler := handler.New(&handler.Config{\n\t\tSchema: graphql.Schema(graphql.NewSchema(getResolver(db))),\n\t})\n\tgraphqlPlaygroundHandler := handler.Playground(\"GraphQL API\")\n\n\trouter := httprouter.New()\n\trouter.GET(\"/playground\", http.HandlerFunc(graphqlPlaygroundHandler.ServeHTTP))\n\trouter.POST(\"/graphql\", http.HandlerFunc(gqlHandler.ServeHTTP))\n\n\tlog.Println(\"Server started at port 8080\")\n\tlog.Fatal(http.ListenAndServe(\":8080\", router))\n}\n", "langage": "go", "bugs_introduits": ["wrong_assignment_go", "type_error_go", "missing_import_go"], "corrections_appliquees": [], "timestamp": 1767008511.9558883, "tentative": 2}