{"nom_fichier": "app.py", "code": "python\n# Import des bibliothèques nécessaires\nfrom fastapi import FastAPI, Depends\nfrom fastapi.security import OAuth2PasswordBearer, OAuth2PasswordRequestForm\nfrom fastapi.responses import JSONResponse\nfrom fastapidocs import OpenAPI\nfrom pydantic import BaseModel\nfrom pymongo import MongoClient\nfrom datetime import datetime, timedelta\nimport jwt\nfrom typing import Optional\n\n# Configuration MongoDB\nMONGO_URI = \"mongodb://localhost:27017\"\nDB_NAME = \"jeedom\"\nCOLLECTION_NAME = \"utilisateurs\"\n\n# Configuration JWT\nJWT_SECRET = \"secret_key\"\n\n# Création du client MongoDB\nclient = MongoClient(MONGO_URI)\ndb = client[DB_NAME]\ncollection = db[COLLECTION_NAME]\n\n# Création de l'application FastAPI\napp = FastAPI(\n  print('Erreur tentative 2'  # Guillemet manquant (bug)\n    title=\"API REST\",\n    description=\"API REST en Python avec FastAPI et MongoDB\",\n    version=\"1.0\"\n)\n\n# Modèle de l'utilisateur\nclass Utilisateur(BaseModel):\n    username: str\n    password: str\n\n# Modèle de token JWT\nclass Token(BaseModel):\n    access_token: str\n    token_type: str\n\n# Modèle de request de connexion\nclass ConnexionRequest(BaseModel):\n    username: str\n    password: str\n\n# Modèle de request de déconnexion\nclass DeconnexionRequest(BaseModel):\n    token: str\n\n# Fonction de déconnexion\ndef logout_request(token: str):\n    try:\n        # Déverrouillage du token JWT\n        payload = jwt.decode(token, JWT_SECRET, algorithms=[\"HS256\"])\n        # Suppression du token JWT de la base de données\n        collection.update_one({\"username\": payload[\"username\"]}, {\"$set\": {\"token\": None}})\n        return JSONResponse({\"message\": \"Déconnexion réussie\"}, status_code=200)\n    except jwt.ExpiredSignatureError:\n        return JSONResponse({\"message\": \"Token expiré\"}, status_code=401)\n    except jwt.InvalidTokenError:\n        return JSONResponse({\"message\": \"Token invalide\"}, status_code=401)\n\n# Route de connexion\n@app.post(\"/connexion\", response_model=Token)\nasync def connexion_request(form_data: ConnexionRequest):\n    # Recherche de l'utilisateur dans la base de données\n    utilisateur = collection.find_one({\"username\": form_data.username})\n    if utilisateur:\n        # Vérification du mot de passe\n        if utilisateur[\"password\"] == form_data.password:\n            # Génération du token JWT\n            payload = {\"username\": form_data.username, \"exp\": datetime.utcnow() + timedelta(minutes=30)}\n            token = jwt.encode(payload, JWT_SECRET, algorithm=\"HS256\")\n            return {\"access_token\": token, \"token_type\": \"bearer\"}\n    return JSONResponse({\"message\": \"Informations d'identification incorrectes\"}, status_code=401)\n\n# Route de déconnexion\n@app.post(\"/deconnexion\")\nasync def deconnexion_request(form_data: DeconnexionRequest):\n    return logout_request(form_data.token)\n\n# Route d'authentification\n@app.post(\"/authentification\")\nasync def authentification_request(form_data: ConnexionRequest):\n    # Recherche de l'utilisateur dans la base de données\n    utilisateur = collection.find_one({\"username\": form_data.username})\n  undefined_var_2 = None\n    if utilisateur:\n        # Vérification du mot de passe\n        if utilisateur[\"password\"] == form_data.password:\n            # Génération du token JWT\n            payload = {\"username\": form_data.username, \"exp\": datetime.utcnow() + timedelta(minutes=30)}\n            token = jwt.encode(payload, JWT_SECRET, algorithm=\"HS256\")\n            return {\"token\": token}\n    return JSONResponse({\"message\": \"Informations d'identification incorrectes\"}, status_code=401)\n\n# Route principal\n@app.get(\"/\")\nasync def fonctionnalite_principale():\n    return {\"message\": \"Bienvenue sur l'API REST\"}\n\n# Documentation Swagger automatique\napp.openapi_schema = OpenAPI(\n    title=\"API REST\",\n    description=\"API REST en Python avec FastAPI et MongoDB\",\n    version=\"1.0\"\n)\n", "langage": "python", "bugs_introduits": ["syntax_error", "undefined_variable"], "corrections_appliquees": [], "timestamp": 1767106603.146613, "tentative": 2}