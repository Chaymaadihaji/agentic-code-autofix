{"nom_fichier": "internal/models/models.go", "code": "go\n// internal/models/models.go\n\npackage models\n\nimport (\n\t\"crypto/rand\"\n\t\"encoding/base64\"\n\t\"errors\"\n\t\"fmt\"\n\t\"log\"\n\n\t\"github.com/google/uuid\"\n\t\"github.com/gqlgen/gqlgo/graphql\"\n\t\"gorm.io/driver/postgres\"\n\t\"gorm.io/gorm\"\n\t\"gorm.io/gorm/clause\"\n)\n\n// User represents the user's entity.\ntype User struct {\n\tID       string `gorm:\"primarykey\" json:\"id\"`\n\tEmail    string `gorm:\"not null\" json:\"email\"`\n\tPassword string `gorm:\"not null\" json:\"password\"`\n}\n\n// Book represents a book entity.\ntype Book struct {\n\tID   string `gorm:\"primarykey\" json:\"id\"`\n\tISBN string `json:\"isbn\"`\n\tTitle string `json:\"title\"`\n\tAuthor []Author `gorm:\"polymorphic:Author\" json:\"author\"`\n}\n\n// Author represents an author.\ntype Author struct {\n\tgorm.Model\n\t// AuthorName represents the name of the author.\n\tAuthorName\tstring `json:\"authorName\"`\n}\n\n// DB represents the database instance.\nvar DB *gorm.DB\n\n// InitDB function initializes the database.\nfunc InitDB(dsn string) error {\n\tvar err error\n\tDB, err = gorm.Open(postgres.Open(dsn), &gorm.Config{})\n\tif err != nil {\n\t\treturn err\n\t}\n\treturn DB.AutoMigrate(User{})\n}\n\n// GetUser retrieves a user's informations.\nfunc GetUser(email, password string) (*User, error) {\n\tvar user User\n\tresult := DB.First(&user, \"email = ? AND password = ?\", email, password)\n\treturn &user, result.Error\n}\n\n// CreateTokenFunction generates a new JWT for a provided user model.\nfunc CreateTokenFunction(user *User) (string, error) {\n\ttoken := jwt.NewWithClaims(jwt.SigningMethodHS256, jwt.MapClaims{\n\t\t\"email\": user.Email,\n\t\t\"exp\":   time.Now().Add(time.Hour * 72).Unix(),\n\t})\n\ttokenString, err := token.SignedString([]byte(\"secret\"))\n\tif err != nil {\n\t\treturn \"\", err\n\t}\n\treturn tokenString, nil\n}\n\nfunc main() {\n\terr := InitDB(\"user=gorm_password\")\n\tif err != nil {\n\t\tlog.Fatal(err)\n\t}\n}\n", "langage": "go", "bugs_introduits": [], "corrections_appliquees": [], "timestamp": 1767009066.2540202, "tentative": 4}